# ![logo](https://i.imgur.com/zqJELkl.png)

<p align="center">
 <img src="https://img.shields.io/badge/License-MIT-blue.svg">
 <img src="https://badges.frapsoft.com/os/v3/open-source.svg?v=103">
 <img src="http://ForTheBadge.com/images/badges/built-with-love.svg">
 <img src="https://img.shields.io/badge/badges-awesome-green.svg">
 <img src="https://img.shields.io/badge/Stay-Safe-red?logo=data:image/svg%2bxml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgNTEwIDUxMCIgaGVpZ2h0PSI1MTIiIHZpZXdCb3g9IjAgMCA1MTAgNTEwIiB3aWR0aD0iNTEyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxnPjxnPjxwYXRoIGQ9Im0xNzQuNjEgMzAwYy0yMC41OCAwLTQwLjU2IDYuOTUtNTYuNjkgMTkuNzJsLTExMC4wOSA4NS43OTd2MTA0LjQ4M2g1My41MjlsNzYuNDcxLTY1aDEyNi44MnYtMTQ1eiIgZmlsbD0iI2ZmZGRjZSIvPjwvZz48cGF0aCBkPSJtNTAyLjE3IDI4NC43MmMwIDguOTUtMy42IDE3Ljg5LTEwLjc4IDI0LjQ2bC0xNDguNTYgMTM1LjgyaC03OC4xOHYtODVoNjguMThsMTE0LjM0LTEwMC4yMWMxMi44Mi0xMS4yMyAzMi4wNi0xMC45MiA0NC41LjczIDcgNi41NSAxMC41IDE1LjM4IDEwLjUgMjQuMnoiIGZpbGw9IiNmZmNjYmQiLz48cGF0aCBkPSJtMzMyLjgzIDM0OS42M3YxMC4zN2gtNjguMTh2LTYwaDE4LjU1YzI3LjQxIDAgNDkuNjMgMjIuMjIgNDkuNjMgNDkuNjN6IiBmaWxsPSIjZmZjY2JkIi8+PHBhdGggZD0ibTM5OS44IDc3LjN2OC4wMWMwIDIwLjY1LTguMDQgNDAuMDctMjIuNjQgNTQuNjdsLTExMi41MSAxMTIuNTF2LTIyNi42NmwzLjE4LTMuMTljMTQuNi0xNC42IDM0LjAyLTIyLjY0IDU0LjY3LTIyLjY0IDQyLjYyIDAgNzcuMyAzNC42OCA3Ny4zIDc3LjN6IiBmaWxsPSIjZDAwMDUwIi8+PHBhdGggZD0ibTI2NC42NSAyNS44M3YyMjYuNjZsLTExMi41MS0xMTIuNTFjLTE0LjYtMTQuNi0yMi42NC0zNC4wMi0yMi42NC01NC42N3YtOC4wMWMwLTQyLjYyIDM0LjY4LTc3LjMgNzcuMy03Ny4zIDIwLjY1IDAgNDAuMDYgOC4wNCA1NC42NiAyMi42NHoiIGZpbGw9IiNmZjRhNGEiLz48cGF0aCBkPSJtMjEyLjgzIDM2MC4xMnYzMGg1MS44MnYtMzB6IiBmaWxsPSIjZmZjY2JkIi8+PHBhdGggZD0ibTI2NC42NSAzNjAuMTJ2MzBoMzYuMTRsMzIuMDQtMzB6IiBmaWxsPSIjZmZiZGE5Ii8+PC9nPjwvc3ZnPg==">

</p>
 <p align="center">
     <a href="https://img.shields.io/github/stars/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=FFD700&style=for-the-badge" alt="GitHub Repo stars">
         <img src="https://img.shields.io/github/stars/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=FFD700&style=for-the-badge"></a>
     <a href="https://img.shields.io/github/forks/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=00a671&style=for-the-badge" alt="GitHub forks">
         <img src="https://img.shields.io/github/forks/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=00a671&style=for-the-badge"></a>
     <a href="https://img.shields.io/github/watchers/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=9700b2&style=for-the-badge" alt="GitHub watchers">
         <img src="https://img.shields.io/github/watchers/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=9700b2&style=for-the-badge"></a>
</p>

<h2><p align="center">
<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.zh-CN.md"><b>🇨🇳</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.es.md"><b>🇪🇸</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.ru.md"><b>🇷🇺</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.hi.md"><b>🇮🇳</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.fr.md"><b>🇫🇷</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.it.md"><b>🇮🇹</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.de.md"><b>🇩🇪</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.ar.md"><b>🇦🇪</b></a></h2>

<h2 align="center"><img src="https://raw.githubusercontent.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/main/assets/images/awcu.gif" width= "700"></h2>
 
## Features
 
#### _<a href="https://github.com/AdguardTeam/AdGuardHome/blob/master/README.md"><b>AdGuard Home</b></a>_ : Block ads on all your devices( <a href="https://github.com/AdguardTeam/AdGuardHome/blob/master/README.md#how-does-adguard-home-compare-to-pi-hole"><b>_compared to Pi-Hole_</b></a> )
#### _<a href="https://www.wireguard.com/"><b>WireGuard</b></a>_ : VPN server at home accessible from any outside network(IPv4 & IPv6)
#### _<a href="https://www.nlnetlabs.nl/projects/unbound/about/"><b>Unbound</b></a> with <a href="https://dnsprivacy.org/dns_privacy_daemon_-_stubby/about_stubby/"><b>Stubby</b></a>_ : A validating, recursive, caching DNS resolver
#### _<a href="https://www.cloudflare.com/learning/what-is-cloudflare/"><b>Cloudflare</b></a>_ : Better performance & security when browsing websites(DoT & DoH)
 
<p align="right">
<i>All software are free, open-source and&nbsp;self-hosted&nbsp;</i></br><a href="https://git.io/About"><b>About</b></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

* * *

<h3 align="left">DNS query speed with <a href="https://docs.oracle.com/en-us/iaas/Content/DNS/Tasks/testingdnsusingdig.htm"><b>BIND'S dig Tool </b></a> 🧪</h1>

<b>Résultats de google.com en millisecondes :</b>

-   Résolveurs DNS par défaut d'AdGuard -`60-70 msec`
-   Résolveurs DNS publics Cloudflare/Quad9/Google -`50-70 msec`
-   Cette installation/configuration -`5-10 msec`

<details><summary><b>Preview🎥<img src="https://media.giphy.com/media/WT5h7PgVSScLLKtMaS/giphy.gif" width=50px height=40px></b></summary>
<p>

DNS par défaut d'AdGuard<b><i>vs</i></b>cette configuration⭐ :

<https://user-images.githubusercontent.com/18756975/150230438-b767e86f-4e18-4791-b5fe-0813615a37a3.mp4>

Résolveurs DNS publics Cloudflare/Quad9/Google :

<https://user-images.githubusercontent.com/18756975/150319049-3d8acdc9-624f-4b60-8ee2-b80227522252.mp4>

</p>
 </details>

* * *

<h4><p align="center">
Last Checked⏰ : 17 April 2022</h2>

<div align="center">

|                             Projets                             |                           Statut                           |
| :-------------------------------------------------------------: | :--------------------------------------------------------: |
|                         AdGuard Accueil                         |                              ✅                             |
|                             Non lié                             |                              ✅                             |
|                             Nuageux                             |                              ✅                             |
|                              Trapu                              |                              ✅                             |
|                            WireGuard                            |                              ✅                             |

</div>
<div>
 
#
# Table of contents
 - [Requirements](#requirements)
 - [Install Raspberry Pi OS](#install-raspberry-pi-os-) <img src="https://www.vectorlogo.zone/logos/raspberrypi/raspberrypi-icon.svg" width=20px height=20px>
   - [Access Pi OS with SSH](#access-pi-os-with-ssh)
 - [Install AdGuard Home](#install-adguard-home-) <img src="https://www.vectorlogo.zone/logos/adguard/adguard-icon.svg" width=20px height=20px>
   - [Set up your devices to work with Adguard](#set-up-your-devices-to-work-with-adguard)
   - [Setting up AdGuard blocklist](#setting-up-adguard-blocklist)
     - [Add/Remove multiple URLs](#addremove-multiple-urls)
 - [Install Unbound](#install-unbound-) <img src="https://www.privacytools.io/img/apps/unbound.svg" width=20px height=20px>
 - [Install Cloudflare](#install-cloudflare-) <img src="https://www.vectorlogo.zone/logos/cloudflare/cloudflare-icon.svg" width=20px height=20px>
   - [Setup for Cloudflared (DoH)](#setup-for-cloudflared-doh)
   - [Configure Cloudflare (DoT) on Unbound](#configure-cloudflare-dot-on-unbound)
     - [Configure Stubby for Unbound](#configure-stubby-for-unbound)
   - [Configure AdGuard with Cloudflare (DoH&DoT)](#configure-adguard-with-cloudflaredohdot)
 - [Install WireGuard](#install-wireguard-) <img src="https://www.vectorlogo.zone/logos/wireguard/wireguard-icon.svg" width=20px height=20px>
   or <a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/OpenVPN-Setup.md">OpenVPN(slower)</a> <img src="https://i.imgur.com/Agstbe5.png" width=20px height=20px>
   - [Connecting VPN to Android/IOS Phone](#connecting-vpn-to-androidios-phone)
   - [Connecting VPN to Windows](#connecting-vpn-to-windows)
   - [Configure Wireguard with AdGuard/Unbound/Cloudflare](#configure-wireguard-with-adguardunboundcloudflare)
     - [Limit traffic](#limit-traffic)
     - [IPv6](#ipv6)
     - [Disable all IPv6](#disable-all-ipv6)
 - [Test Vpn](#test-vpn) <img src="https://i.imgur.com/6Yf8Zra.png" width=20px height=20px>
 - [Auto update Pi](#auto-update-pi-)
 - [Install Log2ram](#install-log2ram-)
 - [Turn Off Pi LEDs](#turn-off-pi-led-lights-)
 - [Secure your Raspberry Pi](#secure-your-raspberry-pi-)
 - [Repository Resources](#repository-resources)
 - [F.A.Q](#faq)

# 

# Conditions

Ce tutoriel est basé sur Raspberry Pi, mais vous pouvez utiliser n'importe quel Linux<a href="https://github.com/thibmaek/awesome-raspberry-pi#os-images"><b>système opérateur</b></a><i>(bit)</i>, tout matériel ou un<a href="https://www.google.com/search?q=What+is+a+VPS+used+for%3F&client=firefox-b-d&biw=1280&bih=582&sxsrf=APq-WBu-yng0bW9IWwNKsQhD6h1ZmRGncw%3A1650151372793&ei=zE9bYpL1L_OOwbkPgZ6DGA&ved=0ahUKEwiSi5rz3Jn3AhVzRzABHQHPAAMQ4dUDCA0&uact=5&oq=What+is+a+VPS+used+for%3F&gs_lcp=Cgdnd3Mtd2l6EAMyBAgAEA0yBAgAEA0yBAgAEA0yBAgAEA0yBggAEA0QHjIGCAAQFhAeMgYIABAWEB4yCAgAEAgQDRAeMggIABAIEA0QHjIICAAQCBANEB46BwgAEEcQsANKBAhBGABKBAhGGABQ8AFY8AFg_ANoAXABeACAAXCIAXCSAQMwLjGYAQCgAQKgAQHIAQjAAQE&sclient=gws-wiz"><b>SVP</b></a>.</br>(Raspberry Pi OS is most simple and recommended for Pi or for more experience users, <b>DiètePi</b>OS est également recommandé)

-   A Raspberry Pi 3 or 4 version
-   Un routeur qui prend en charge la redirection de port (Most Can)
-   MicroSD USB card reader
-   Carte MicroSD (8 Go ou plus, au moins Classe 4)
-   câble Ethernet
-   (Facultatif si vous utilisez un moniteur) MicroHDMI-(RPi 4) ou HDMI-(RPi 3)

# 

<h1 align="center"><b><i>Install Raspberry Pi OS</b></i> </h1>

Raspberry Pi OS est disponible en versions de bureau et lite (utilisez lite pour<a href="https://www.google.com/search?q=What+is+a+headless+operating+system%3F&client=firefox-b-d&sxsrf=APq-WBvlqMZasn_klYxS5HZmhKQlduKYuQ%3A1650123816301&ei=KORaYtz7EYOdwbkP74G16AE&ved=0ahUKEwjcr5-f9pj3AhWDTjABHe9ADR0Q4dUDCA0&uact=5&oq=What+is+a+headless+operating+system%3F&gs_lcp=Cgdnd3Mtd2l6EAMyCAghEBYQHRAeOgcIABBHELADSgQIQRgASgQIRhgAUMEBWMEBYNAEaAFwAXgAgAFqiAFqkgEDMC4xmAEAoAECoAEByAEIwAEB&sclient=gws-wiz"><b>sans tête</b></a>mode). Vous pouvez accéder à un Raspberry Pi avec un moniteur/clavier/souris ou vous connecter via<a href="https://www.google.com/search?q=linux+ssh+&client=firefox-b-d&sxsrf=APq-WBve72uwEMMqUAe77nZoaygcx-ROMg%3A1650123667623&ei=k-NaYtbfJbmvwbkPpf6nqAQ&ved=0ahUKEwiW9azY9Zj3AhW5VzABHSX_CUUQ4dUDCA0&uact=5&oq=linux+ssh+&gs_lcp=Cgdnd3Mtd2l6EAMyBAgjECcyBQgAEIAEMgUIABCRAjIFCAAQkQIyBQgAEIAEMgUIABCABDIFCAAQkQIyBQgAEIAEMgUIABCABDIFCAAQgAQ6BwgAEEcQsANKBAhBGABKBAhGGABQuAFY0AJg1AZoAXABeACAAXaIAeIBkgEDMC4ymAEAoAEByAEIwAEB&sclient=gws-wiz"><b>SSH</b></a>depuis une borne.

Installez balenEtcher et téléchargez l'image Pi pour écrire sur la carte microSD.

-   Téléchargez le système d'exploitation Raspberry Pi :<https://www.raspberrypi.org/software/operating-systems/>

-   Télécharger balenaEtcher :<https://www.balena.io/etcher/>

Après avoir`Etcher`installé et`Raspberry Pi OS`fichier téléchargé, vous pouvez maintenant insérer la carte SD avec lecteur de carte USB microSD dans votre ordinateur.

-   Lancez Etcher et choisissez l'image Raspberry Pi OS que vous avez téléchargée, sélectionnez votre carte microSD et cliquez sur`Flash`.

Une fois le clignotement terminé, recherchez dans "Ce PC" un nom de disque "démarrage ou clé USB" (rebranchez le lecteur de carte USB s'il n'est pas vu). Allez sur ce disque, créez un nouveau fichier texte appelé**_`ssh without 'txt' extension`_**. Désactivez "Masquer les extensions pour les types de fichiers connus" dans les options de l'explorateur de fichiers si vous ne le voyez pas.

<p align="center">
 <img src="https://i.imgur.com/eV6uMbz.jpg">

<i>Placez la carte SD dans le Raspberry Pi, branchez le câble Ethernet et démarrez</i>

## Accéder au système d'exploitation Pi avec SSH

-   Attendez une minute pour le premier démarrage de Pi

-   Open browser and log in your router's panel page

-   Trouvez la liste de tous les appareils connectés à votre réseau et copiez l'adresse IP du Raspberry Pi (il aura très probablement le nom d'hôte`raspberrypi`)

-   Ouvrez le terminal sur votre machine hôte. Vous pouvez utiliser powerShell sous Windows ou RaspController pour Android.

Tapez la commande suivante :

    ssh pi@pi's IP address

<i>Vous pouvez utiliser le bouton droit de la souris pour coller du texte dans Windows PowerShell</i>.

Tapez "oui" pour la question sur les empreintes digitales et tapez "framboise" pour le mot de passe par défaut (les mots de passe seront invisibles dans la ligne de commande). Vous pouvez taper**_`sudo passwd pi`_**pour changer le mot de passe.

<p align="center">
 <img src="https://i.imgur.com/Wf30jxG.jpg">

Run in terminal:

    sudo apt update -y && sudo apt upgrade -y

__Redémarrez lorsque vous avez terminé__

    sudo reboot

**[⬆ Retour au sommaire ⬆](#table-of-contents)**

# 

<h1 align="center"><b><i>Install AdGuard Home</b></i> </h1>

Ce script d'installation provient de<a href="https://github.com/AdguardTeam/AdGuardHome/blob/master/README.md"><b>AdGuard Accueil</b></a>projet principal. Suivez pour rester à jour.

Exécutez la commande suivante dans votre terminal :

    curl -s -S -L https://raw.githubusercontent.com/AdguardTeam/AdGuardHome/master/scripts/install.sh | sh -s -- -v

-   Lorsque l'installation est terminée, une fenêtre apparaîtra dans le terminal montrant`links` to your AdGuard home page(Get Started)

-   `IMPORTANT:`Dans l'option Écouter les interfaces, choisissez`Eth0`et sélectionnez suivant

    <p align="center">
     <img src="https://i.imgur.com/Wa00lDp.jpg" width=580px height=690px>

-   Configurez le nom d'utilisateur et le mot de passe et connectez-vous au panneau d'administration

-   `IMPORTANT:`Dans les paramètres généraux, définissez "Rétention des journaux de requêtes" sur`24 hours`. (J'ai lu que pour certaines personnes, les journaux se remplissent, ce qui ralentit Pi et nécessite un redémarrage)

## Configurez vos appareils pour qu'ils fonctionnent avec AdGuard

-   Pour Android/Apple, accédez aux paramètres avancés du Wi-Fi et sélectionnez l'option statique. Dans`DNS 1`champ entrez l'adresse "IP de Pi"

    <p align="center">
     <img src="https://i.imgur.com/nxpiqDw.jpg" width=450px height=580px>

-   Pour PC/Windows

    -   <i>Ипвч</i>

        Allez dans les paramètres réseau / modifiez les options de l'adaptateur et faites un clic droit dans les propriétés puis sélectionnez "Internet Protocol Version 4(TCP/IPv4)". Entrez l'adresse IP de Pi dans`Preferred DNS`serveur.

    -   <i>IPv6 (nécessaire pour`DoH`&`DoT`pour travailler plus tard dans le guide si vous utilisez IPv6 sur votre routeur)</i>

        Accédez à "Protocole Internet version 6 (TCP/IPv6)" Entrez`::1`

`OPTIONAL:`<i>Vous pouvez ajouter un DNS de secours dans les champs alternatifs</i>

`BE AWARE:`<i>Dans Android, l'ajout d'un DNS public dans le deuxième champ brise le blocage des publicités AdGuard</i>

<p align="center">
 <img src="https://i.imgur.com/8gsDk3z.jpg">

## Configuration de la liste de blocage AdGuard

Dans la page d'accueil d'AdGuard sous les filtres, sélectionnez la section Liste de blocage DNS pour ajouter des URL.

<p align="center">
 <img src="https://i.imgur.com/shrtJLD.png">

Vous pouvez rechercher sur Google une liste de blocage différente. Voici ma liste de blocage personnalisée[<a href="https://raw.githubusercontent.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/main/My-Blocklist.txt"><b>Cliquez ici</b></a>]avec mes URL ou créez les vôtres à partir de ces sources[<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/main/%F0%9F%A7%B1Blocklist-Sources%E2%84%B9%EF%B8%8F"><b>Cliquez ici</b></a>].

`IMPORTANT:`Certaines listes de blocage peuvent bloquer certains contenus ou sites Web importants. Pour débloquer, allez dans la section "Query Log" et vous verrez_Débloquer_option lorsque le curseur est survolé sur une requête, en plaçant les sites Web non bloqués dans l'exemple "Règles de filtrage personnalisées":`@@||bitly.com^$important`. Recherchez l'adresse IP et l'heure du client.

## Ajouter/supprimer plusieurs URL

Vous ne pouvez ajouter qu'une URL par une dans la liste de blocage DNS avec AdGuard pour le moment, mais il existe un script python pour ajouter plusieurs URL à la fois.

Ouvrez un nouveau fichier py (bulkurls.py) :

    nano bulkurls.py

Ensuite, copiez et collez les configurations de script[<a href="https://raw.githubusercontent.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/main/bulkurls.py"><b>Cliquez ici</b></a>]. Régler`your AdGuard credentials`et enregistrez (control+x puis y puis entrée).

_Si vous utilisez**DiètePi**installer`sudo apt-get install python3-pip -y && pip install requests`car il n'est pas installé par défaut._

Courir :`sudo python3 bulkurls.py`

Pour**éliminer**tu dois changer`add`dans<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/62ba01ed8ed3a5bc5294b9fe7ee38c3e83ae1b86/bulkurls.py#L150"><b>deuxième de la dernière ligne</b></a>pour`remove`dans le fichier bulkurls.py.

Aller à<https://d3ward.github.io/toolz/adblock.html>pour tester si les publicités bloquent<img src="https://i.imgur.com/Q5oO9EY.png" width=100px height=80px>

**[⬆ Retour au sommaire ⬆](#table-of-contents)**

# 

<h1 align="center"><b><i>Install Unbound</b></i> </h1>

Exécutez la commande suivante dans votre terminal :

    sudo apt install unbound -y

Pour interroger de manière récursive un hôte qui n'est pas mis en cache en tant qu'adresse, le résolveur doit commencer en haut de l'arborescence des serveurs et interroger les serveurs racine, pour savoir où aller pour le domaine de premier niveau pour l'adresse interrogée. Unbound est livré avec des conseils intégrés par défaut.

    wget -O root.hints https://www.internic.net/domain/named.root && sudo mv root.hints /var/lib/unbound/

`IMPORTANT:`Celui-ci doit être mis à jour tous les 6 mois. Pour_**mise à jour automatique**_root.hints tous les 6 mois, vous devez créer une tâche cron.

Entrez en ligne de commande`crontab -e`, il vous demandera de sélectionner un éditeur (choisissez 1) et collez ces lignes au bas de crontab et enregistrez (control + x puis y puis entrez):

    1 0 1 */6 * wget -O root.hints https://www.internic.net/domain/named.root
    2 0 1 */6 * sudo mv root.hints /var/lib/unbound/

_Si vous utilisez**DiètePi**vous devez installer resolvconf et redémarrer unbound-resolvconf.service pour définir le serveur de noms non lié sur 127.0.0.1 :_

    sudo apt-get install resolvconf -y && sudo systemctl restart unbound-resolvconf.service

<p align="center">
 <img src="https://i.imgur.com/26ro62t.jpg">

**[⬆ Retour au sommaire ⬆](#table-of-contents)**

# 

<h1 align="center"><b><i>Install Cloudflare</b></i> </h1>

## Configuration pour Cloudflared`(DoH)`

[<a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/Cloudflare-DoH-Setup.md"><b>Cliquez ici</b></a>]</h4>

## Configurer Cloudflare`(DoT)`sur Non lié

Créez un fichier de configuration indépendant en entrant dans l'invite de commande :

    sudo nano /etc/unbound/unbound.conf.d/unbound.conf

Et copiez et collez tout le texte de ce fichier unbound.conf[<a href="https://raw.githubusercontent.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/main/unbound.conf"><b>Cliquez ici</b></a>]et enregistrez (control+x puis y puis entrée).

## Configurer Stubby pour Unbound

Utilisez Unbound pour la mise en cache et stubby comme redirecteur TLS. Installez stubby :

    sudo apt install stubby -y

Supprimez et recréez le fichier stubby.yaml :

    cd /etc/stubby/ && sudo rm stubby.yml && sudo nano stubby.yml

Et copiez et collez tout le texte de ce fichier de configuration tronqué[<a href="https://raw.githubusercontent.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/main/stubby.yml"><b>Cliquez ici</b></a>]Et enregistrer. (`cd`pour revenir au dossier d'accueil lorsque vous avez terminé).

-   Redémarrez unbound & stubby et vérifiez l'état :


    sudo systemctl restart unbound stubby ; systemctl status unbound stubby -l

<p align="center">
 <img src="https://i.imgur.com/7zIpWP2.jpg" width=650px height=370px>

## Configurez AdGuard avec`Cloudflare(DoH&DoT)`

-   Dans la page d'accueil d'AdGuard, sous les paramètres, sélectionnez "Paramètres DNS"

-   Supprimez tout des options de serveur "Upstream" et "Bootstrap DNS" et entrez :

    -   Pour`DNS over TLS(DoT)`ajouter`127.0.0.1:53`dans les champs de serveur "Upstream" et "Bootstrap DNS"
    -   Pour`DNS over HTTPS(DoH)`ajouter`127.0.0.1:5053`dans les champs de serveur "Upstream" et "Bootstrap DNS"
    -   Pour`TLS forwarder(stubby)`ajouter`127.0.0.1:8053`dans les champs de serveur "Upstream" et "Bootstrap DNS"

-   `IMPORTANT:`Vous devez vérifier "<a href="https://adguard.com/en/blog/in-depth-review-adguard-home.html#dns"><b>Demande parallèle</b></a>" pour que les résolveurs DNS fonctionnent simultanément.

<p align="center">
 <img src="https://i.imgur.com/Ug4Euou.jpg" width=650px height=370px>

-   Ensuite, dans les paramètres DNS, recherchez la section de configuration du cache DNS et définissez la taille du cache sur`0`(la mise en cache est déjà gérée par le Unbound) et cliquez sur Appliquer.

<p align="center">
 <img src="https://i.imgur.com/8Q5Zb0M.jpg" width=650px height=370px>
 
<b>Click apply and test upstreams</b>(might get a error in the first testing only).

#### `IMPORTANT:`Le système Windows et les navigateurs Android ont besoin de quelques ajustements pour`stabilize`Résolveurs DNS..Linux fonctionne bien<i>(testé sur menthe)</i>

### les fenêtres

-   Installez le proxy DNS acrylique :<https://mayakron.altervista.org/support/acrylic/Home.htm>

-   Aller à`C:\Program Files (x86)\Acrylic DNS Proxy`et ouvert`AcrylicConfiguration.ini`dossier. Supprimez tout et copiez ces paramètres[<a href="https://raw.githubusercontent.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/main/AcrylicConfiguration.ini"><b>Cliquez ici</b></a>], ne changez que_**Adresse du serveur principal**_à l'adresse de votre Pi.

-   Dans le même dossier exécuter`RestartAcrylicService.bat`&`PurgeAcrylicCacheData.bat`

    `TIP:`Dépanner les commandes IP/DNS

        ipconfig /release
        ipconfig /renew
        ipconfig /flushdns

### Android

-   Quel que soit le navigateur que vous utilisez, tournez**désactivé**`Use Secure DNS`option.
-   Soyez conscient que des conflits peuvent survenir avec des roms et des noyaux rootés personnalisés avec les réglages DNS build.prop ou le module apps/Magisk.

#### _C'est ça_. Allez maintenant à<https://1.1.1.1/help>dans le navigateur et vous devriez voir ces options sortir "Oui".

-   [x] Connecté à 1.1.1.1
-   [x] DNS sur HTTPS (DoH)
-   [x] DNS sur TLS (DoT)
-   [ ] DNS sur WARP
    <p align="center">
     <img src="https://i.imgur.com/2S3IH5H.jpg" width=650px height=370px>

#### Autres sites pour vérifier la sécurité

<https://browserleaks.com/dns>- devrait montrer tous connectés à "Cloudflare"

<https://www.cloudflare.com/ssl/encrypted-sni/>- "Secure DNS / DNSSEC / TLS 1.3" devrait être une coche verte

<https://dnssec.vs.uni-due.de/>- devrait dire "Oui, votre résolveur DNS valide les signatures DNSSEC"

**[⬆ Retour au sommaire ⬆](#table-of-contents)**

# 

<h1 align="center"><b><i>Install WireGuard</b></i> </h1>

**Avant d'installer WireGuard**, si vous n'avez pas de<a href="https://www.google.com/search?client=firefox-b-d&q=static+IP"><b>I.P statique</b></a>vous devez obtenir un`Dynamic DNS Subdomain`ou bien votre adresse IP externe change dynamiquement à partir de votre FAI, vous devrez donc configurer un service DNS dynamique[**<a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/Dns-Service-Guide.md"><b>Cliquez ici</b></a>**]. Ou bien sauter l'étape.

Vous devez également configurer<a href="https://www.google.com/search?q=What+is+port+forwarding+used+for%3F&client=firefox-b-d&sxsrf=APq-WBuwPqGlPJ6N9_l6qpQ3e5sYoUxZAQ%3A1650219365125&ei=ZVlcYo6sB6SGwbkP8tGOwA8&ved=0ahUKEwjO8ryY2pv3AhUkQzABHfKoA_gQ4dUDCA0&uact=5&oq=What+is+port+forwarding+used+for%3F&gs_lcp=Cgdnd3Mtd2l6EAMyBggAEBYQHjoHCAAQRxCwAzoHCAAQsAMQQ0oECEEYAEoECEYYAFDMAVjMAWCBBWgBcAF4AIABbIgBbJIBAzAuMZgBAKABAqABAcgBCsABAQ&sclient=gws-wiz"><b>transfert de port</b></a>sur votre routeur afin que vous puissiez accéder à WireGuard en dehors de notre réseau, comme dans un hotspot de café ou vos données mobiles.
TYPE | VALEUR  
------------ \| --------------
Appareil | Nom d'hôte ou IP de Raspberry Pi
Protocole | UDP
Plage de ports | 51820-51820
Port de sortie | 51820
Autoriser l'accès à Internet (le cas échéant) | oui

Paramètre de port de mon 👇routeur👇. Le vôtre peut-être différent mais vous l'obtiendrez. N'oubliez pas que Google 🔍moteur de recherche🔎 est votre ami. Si vous ne pouvez pas vous connecter à partir d'un réseau extérieur, cela signifie que le FAI a bloqué les connexions sortantes, vous pouvez les appeler et leur demander gentiment de le faire fonctionner.

<p align="center">
 <img src="https://i.imgur.com/9LBEk1i.jpg">

* * *

👊GRAND MERCI👊 pour ce script d'installation de<a href="https://github.com/Nyr/wireguard-install"><b>Nyr</b></a>. Suivez pour rester à jour.

Exécuter dans le terminal

    wget https://git.io/wireguard -O wireguard-install.sh && sudo bash wireguard-install.sh

-   Le script va vous demander Public IPv4/hostname pour le VPN._Si_vous avez une adresse IP statique, puis continuez ou tapez le domaine DNS dynamique que vous avez créé à partir du<a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/Dns-Service-Guide.md"><b>des instructions</b></a>. Par exemple : trinibvpn.freeddns.org

-   Pour l'option de port`press enter`pour le 51820 par défaut. Pour le nom du client, mettez simplement le nom de votre choix et pour le DNS, utilisez l'option 3 (`1.1.1.1`) pour le moment. vous configurerez`AdGuard/Unbound/Cloudflare`avec le VPN après son installation terminée.

<p align="center">
 <img src="https://i.imgur.com/WUNZIK4.jpg">

-   Attendez que l'installation soit terminée et que le code QR s'affiche, ne fermez pas. Mais si vous le faites, pour`regenerate qrcode`, entrez dans le terminal mais en remplaçant juste le nom`yourclientname.conf`fichier au vôtre :


    sudo cp /root/yourclientname.conf /home/pi && sudo qrencode -t ansiutf8 < yourclientname.conf

`IMPORTANT:`Vous devrez ajouter un nouvel utilisateur/client pour chaque appareil que vous utilisez avec le VPN. Pour ajouter un nouvel utilisateur, relancez simplement le script et créez un utilisateur avec un nom de client différent.

<b>Utiliser_OpenVPN_</b>[<a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/OpenVPN-Setup.md"><b>Cliquez ici</b></a>]

# 

### Connexion VPN au téléphone Android/IOS

Installez l'application WireGuard depuis Google Play ou App Store :

WireGuard (Google Play) :<https://play.google.com/store/apps/details?id=com.wireguard.android>

WireGuard (App Store) :<https://apps.apple.com/us/app/wireguard/id1441195209>

Vous devez scanner le code QR affiché dans le terminal avec l'application WireGuard, sélectionnez le`+ button`et utilisez l'option`Scan from QR code`pour installer la configuration.

`IMPORTANT`: Permettre**module principal du noyau**dans les paramètres

<p align="left">
 <img src="https://i.imgur.com/R4qbiOQ.jpg" width=250px height=350px>

### Connexion VPN à Windows

WireGuard pour Windows :<https://download.wireguard.com/windows-client/wireguard-installer.exe>

-   Créer un`new text document`avec n'importe quel nom sur PV pour copier coller le texte du fichier de configuration du client WireGuard.

-   Pour voir le texte dans le fichier de configuration du client, tapez dans le terminal :


    sudo cat /root/yourclientname.conf

-   Mettez en surbrillance tout le texte, copiez-le et collez-le dans le fichier txt sur PC et enregistrez. Renommez ensuite l'extension de`txt`pour`conf`. Vous avez maintenant un fichier de configuration pour ce client WireGuard.

-   Vous pouvez maintenant importer le fichier de configuration dans WireGuard (option d'importation à partir du fichier).

## Configurer WireGuard avec`Adguard/Unbound/Cloudflare`

_N'oubliez pas que cela s'applique lorsque vous êtes connecté à WireGuard VPN sur un réseau extérieur ou à la maison 24 heures sur 24, 7 jours sur 7, car AdGuard/Unbound/Cloudflare est déjà configuré et exécuté manuellement sur vos appareils._(pas de problème d'avoir les deux mis en place pour mon expérience)

-   Dans l'application WireGuard, sélectionnez votre tunnel et sélectionnez modifier (crayon en haut à droite)

-   Sous Serveurs DNS, entrez`Pi's IP`et enregistrez (IPv4 & IPv6)

<p align="center">
 <img src="https://i.imgur.com/UC0vWfE.jpg" width=450px height=500px>  

### Limiter le trafic

Avec WireGuard, vous perdrez environ 50 % de la vitesse Internet en raison du processus de tunnellisation via Pi vers le routeur vers les appareils \*\*

Supprimer dans les adresses IP autorisées l'option "0.0.0.0/0, ::/0" car elle achemine tout le trafic vers votre réseau domestique qui sera lent. Vous devez envoyer du trafic via vos adresses uniquement.

-   Vous devez d'abord le remplacer par votre passerelle réseau, mais en définissant le dernier chiffre sur zéro et<a href="https://www.google.com/search?q=prefix+length+explained&client=firefox-b-d&sxsrf=ALeKk036Jc9vJl73zVXf0yyZs5UlKRlNRQ%3A1621083125589&ei=9cOfYI66I5-qwbkPkdWxkAk&oq=prefix+length+explained&gs_lcp=Cgdnd3Mtd2l6EAMyBggAEAcQHjoHCCMQsAMQJzoHCAAQRxCwA1CUJ1iUJ2CiKmgBcAJ4AIABsAGIAdQCkgEDMC4ymAEAoAEBqgEHZ3dzLXdpesgBCcABAQ&sclient=gws-wiz&ved=0ahUKEwjOiOie3cvwAhUfVTABHZFqDJIQ4dUDCA0&uact=5"><b>longueur du préfixe</b></a>à 24. Par exemple :`192.168.1.1/24`pour`192.168.1.0/24`ou comme mon routeur FAI`192.168.100.1/24`pour`192.168.100.0/24`.~~**Maintenant je ne perds que 25% de vitesse**😁 (PS. en utilisant le réseau 5g)~~

`UPDATE:`Après une mise à jour de WireGuard, je n'obtiens pas une vitesse plus rapide en faisant cela😞 .. mais cela a toujours du sens_ne pas_utiliser`"0.0.0.0/0, ::/0`avec Wi-Fi. Si quelqu'un connaît des ajustements pour obtenir un coup de pouce, faites le moi savoir.

<p align="center">
 <img src="https://i.imgur.com/x4m6Pbl.jpg" width=450px height=500px>

### LISEZ S'IL VOUS PLAÎT !! , ÊTRE CONSCIENT !!

`IMPORTANT`:_Si votre réseau possède des adresses IP pour les appareils qui se terminent par un numéro à 3 chiffres (plus de 24), par exemple : 192.168.100.`254`, vous ne pourrez pas router correctement depuis le réseau extérieur car l'application de 24 n'autorise que les numéros 1 à 24. Vous devez à la place mettre`0`pour router hors de la plage 24, par exemple :`192.168.100.0/0`_.

Ou vous pouvez changer la plage IP sur votre routeur (d'après mon expérience, vous pourriez obtenir des vitesses un peu meilleures car il n'acheminera pas les adresses IP autorisées inutiles sur la plage 24).

<p align="center">
 <img src="https://i.imgur.com/ZZ4aMUI.jpg" width=750px height=550px>

## Ипвш

Si vous utilisez IPv6, lorsque vous êtes connecté au WiFi, vous devez entrer dans WireGuard les adresses IP autorisées`fe80::1/0`aussi bien. Par example`192.168.100.0/0, fe80::1/0`

Lorsqu'il est connecté au câble Ethernet sur un PC Windows, vous devez entrer`::1`dans l'adresse IPv6 dans le serveur DNS préféré "Internet Protocol Version 6(TCP/IPv6)".

Ensuite aller à<https://ipv6leak.com/>et tu devrais voir "_Votre IPv6 ne fuit pas_".

# 

## Désactiver tout IPv6

#### Désactivez IPv6 si vous ne l'avez pas ou si vous ne le voulez pas[<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/main/Disable-All-IPv6.md"><b>Cliquez ici</b></a>]. En conséquence, si vous avez une connexion Internet faible, la désactivation d'IPv6 peut accélérer la demande DNS mais avoir moins de sécurité.

# 

## Tester le VPN

Comment savoir si WireGuard VPN fonctionne vraiment ?

Pour**les fenêtres**télécharger Wireshark :<https://www.wireshark.org/#download>

Une fois téléchargé, vous pouvez utiliser l'application pour inspecter vos paquets de données où le protocole est défini sur celui utilisé par WireGuard VPN. Lorsqu'un trafic de paquets est`encrypted`, il peut être lu comme ceci par exemple :

<p align="center">
 <img src="https://i.imgur.com/Tn4M47R.jpg">

Pour**Android**vous pouvez utiliser PCAPdroid :<https://play.google.com/store/apps/details?id=com.emanuelef.remote_capture&hl=en&gl=US>

Vous devriez voir toutes les connexions`closed`et l'état indiquant toutes les connexions DNS et non les connexions TLS dans toutes les applications. (ouvrir et utiliser des applications pour que PCAPdroid scanne)

**[⬆ Retour au sommaire ⬆](#table-of-contents)**

* * *

# 

<h1 align="center"><b><i>Auto Update Pi</b></i> </h1>

-   Ouvrez un nouveau fichier sh appelé mise à jour et copiez-collez le script[<a href="https://raw.githubusercontent.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/main/update.sh"><b>Cliquez ici</b></a>]


    sudo nano update.sh

-   Définir l'autorisation


    sudo chmod 700 update.sh

-   Ouvrez le fichier cron en entrant dans la ligne de commande`crontab -e`, copiez-collez la ligne de commande du travail ci-dessous au bas du fichier cron et enregistrez.


    0 3 * * WED sudo ./update.sh 2>&1 >/home/pi/updatelog

Pi sera désormais mis à jour tous les mercredis à 3h du matin. Ou vous pouvez aller à<https://crontab.guru/>et établissez votre propre emploi du temps.

Ajustez la date/le fuseau horaire de Pi dans le terminal :

    sudo dpkg-reconfigure tzdata

ou régler manuellement

    sudo date -s "25 DEC 2012 11:14:00"

# 

<h1 align="center"><b><i>Install Log2Ram</b></i> </h1>

L'un des avantages les plus importants du déchargement de votre RAM est qu'il améliore votre**Durée de vie potentielle de la carte SD**.
Les fichiers journaux sont l'une des choses les plus écrites par les différents logiciels que vous installez.
En poussant les fichiers sur votre RAM, vous pouvez contrôler la fréquence à laquelle ils sont écrits sur la carte SD. Vous pourrez toujours accéder à ces fichiers sur la RAM comme s'ils se trouvaient sur votre carte SD.

Copiez et collez cette ligne dans le terminal :

Manuellement

    wget https://git.io/log2ram -O Log2Ram-Script.sh && sudo chmod +x Log2Ram-Script.sh && sudo ./Log2Ram-Script.sh

ou alors

Ajouter une source de dépôt (mise à jour automatique)

    echo "deb [signed-by=/usr/share/keyrings/azlux-archive-keyring.gpg] http://packages.azlux.fr/debian/ bullseye main" | sudo tee /etc/apt/sources.list.d/azlux.list
    sudo wget -O /usr/share/keyrings/azlux-archive-keyring.gpg  https://azlux.fr/repo.gpg
    sudo apt update
    sudo apt install log2ram

# 

<h1 align="center"><b><i>Turn off Pi LED lights</b></i> </h1>

Je suppose que l'alimentation des LED aura un impact sur l'électricité et la chaleur inutiles 🤷😅. Pas besoin de toute façon si vous l'utilisez simplement comme serveur réseau. Ouvrez le fichier cron en entrant dans la ligne de commande`crontab -e`, copiez-collez la ligne de commande du travail ci-dessous au bas du fichier cron et enregistrez.

Vert

    @reboot echo none | sudo tee /sys/class/leds/led0/trigger

Rouge

    @reboot echo none | sudo tee /sys/class/leds/led1/trigger

Redémarrez Pi.

# 

<h1 align="center"><b><i>Secure your Raspberry Pi</b></i> </h1>
<p align="center">
<a href="https://gist.github.com/boseji/c9e91ff3bd0b3cfb62a5e260fe505374"><img src="https://i.imgur.com/a9JQVls.png" width=80px height=90px></a>
<p align="center">
[<a href="https://gist.github.com/boseji/c9e91ff3bd0b3cfb62a5e260fe505374"><b>click here</b></a>]

<i>(Je viens d'utiliser Fail2Ban et de changer le port SSH)</i>

**[⬆ Retour au sommaire ⬆](#table-of-contents)**

* * *

<b>TOUT PROBLÈME, CORRECTIF OU CONSEIL POUR AMÉLIORER CES PROJETS, VEUILLEZ CONTRIBUER🤖</b>

* * *

<p align="center">
<img src="https://user-images.githubusercontent.com/73097560/115834477-dbab4500-a447-11eb-908a-139a6edaec5c.gif"
<br> 
<br> 
<br> 

<p align="center">
 <img src="https://i.imgur.com/Q07E7SW.gif" width=500px height=30px>

<p align="center">
<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/stargazers"><img src="https://reporoster.com/stars/dark/trinib/AdGuard-WireGuard-Unbound-Cloudflare"></a>

<p align="center">
<img src="https://user-images.githubusercontent.com/73097560/115834477-dbab4500-a447-11eb-908a-139a6edaec5c.gif"</p>

# 

## _Ressources du référentiel_

<h5 https://www.raspberrypi.com/documentation/

<https://github.com/AdguardTeam/AdGuardHome/wiki/Getting-Started>

<https://developers.cloudflare.com/>

<https://docs.pi-hole.net/guides/dns/cloudflared/>

<https://docs.pi-hole.net/guides/dns/unbound/>

<https://nlnetlabs.nl/documentation/unbound/unbound.conf/>

<https://dnsprivacy.org/dns_privacy_clients/>

<https://github.com/anudeepND/pihole-unbound>

<https://github.com/stong/unbound.conf.d>

<https://github.com/Nyr/wireguard-install>

<https://github.com/azlux/log2ram>

* * *

## _FAQ_

Poser fréquemment des questions[<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/discussions/17"><b>Cliquez ici</b></a>]
