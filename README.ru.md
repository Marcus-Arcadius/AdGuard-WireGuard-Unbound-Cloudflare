# ![logo](https://i.imgur.com/zqJELkl.png)

<p align="center">
 <img src="https://img.shields.io/badge/License-MIT-blue.svg">
 <img src="https://badges.frapsoft.com/os/v3/open-source.svg?v=103">
 <img src="http://ForTheBadge.com/images/badges/built-with-love.svg">
 <img src="https://img.shields.io/badge/badges-awesome-green.svg">
 <img src="https://img.shields.io/badge/Stay-Safe-red?logo=data:image/svg%2bxml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgNTEwIDUxMCIgaGVpZ2h0PSI1MTIiIHZpZXdCb3g9IjAgMCA1MTAgNTEwIiB3aWR0aD0iNTEyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxnPjxnPjxwYXRoIGQ9Im0xNzQuNjEgMzAwYy0yMC41OCAwLTQwLjU2IDYuOTUtNTYuNjkgMTkuNzJsLTExMC4wOSA4NS43OTd2MTA0LjQ4M2g1My41MjlsNzYuNDcxLTY1aDEyNi44MnYtMTQ1eiIgZmlsbD0iI2ZmZGRjZSIvPjwvZz48cGF0aCBkPSJtNTAyLjE3IDI4NC43MmMwIDguOTUtMy42IDE3Ljg5LTEwLjc4IDI0LjQ2bC0xNDguNTYgMTM1LjgyaC03OC4xOHYtODVoNjguMThsMTE0LjM0LTEwMC4yMWMxMi44Mi0xMS4yMyAzMi4wNi0xMC45MiA0NC41LjczIDcgNi41NSAxMC41IDE1LjM4IDEwLjUgMjQuMnoiIGZpbGw9IiNmZmNjYmQiLz48cGF0aCBkPSJtMzMyLjgzIDM0OS42M3YxMC4zN2gtNjguMTh2LTYwaDE4LjU1YzI3LjQxIDAgNDkuNjMgMjIuMjIgNDkuNjMgNDkuNjN6IiBmaWxsPSIjZmZjY2JkIi8+PHBhdGggZD0ibTM5OS44IDc3LjN2OC4wMWMwIDIwLjY1LTguMDQgNDAuMDctMjIuNjQgNTQuNjdsLTExMi41MSAxMTIuNTF2LTIyNi42NmwzLjE4LTMuMTljMTQuNi0xNC42IDM0LjAyLTIyLjY0IDU0LjY3LTIyLjY0IDQyLjYyIDAgNzcuMyAzNC42OCA3Ny4zIDc3LjN6IiBmaWxsPSIjZDAwMDUwIi8+PHBhdGggZD0ibTI2NC42NSAyNS44M3YyMjYuNjZsLTExMi41MS0xMTIuNTFjLTE0LjYtMTQuNi0yMi42NC0zNC4wMi0yMi42NC01NC42N3YtOC4wMWMwLTQyLjYyIDM0LjY4LTc3LjMgNzcuMy03Ny4zIDIwLjY1IDAgNDAuMDYgOC4wNCA1NC42NiAyMi42NHoiIGZpbGw9IiNmZjRhNGEiLz48cGF0aCBkPSJtMjEyLjgzIDM2MC4xMnYzMGg1MS44MnYtMzB6IiBmaWxsPSIjZmZjY2JkIi8+PHBhdGggZD0ibTI2NC42NSAzNjAuMTJ2MzBoMzYuMTRsMzIuMDQtMzB6IiBmaWxsPSIjZmZiZGE5Ii8+PC9nPjwvc3ZnPg==">

</p>
 <p align="center">
     <a href="https://img.shields.io/github/stars/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=FFD700&style=for-the-badge" alt="GitHub Repo stars">
         <img src="https://img.shields.io/github/stars/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=FFD700&style=for-the-badge"></a>
     <a href="https://img.shields.io/github/forks/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=00a671&style=for-the-badge" alt="GitHub forks">
         <img src="https://img.shields.io/github/forks/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=00a671&style=for-the-badge"></a>
     <a href="https://img.shields.io/github/watchers/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=9700b2&style=for-the-badge" alt="GitHub watchers">
         <img src="https://img.shields.io/github/watchers/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=9700b2&style=for-the-badge"></a>
</p>

<h2><p align="center">
<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.zh-CN.md"><b>🇨🇳</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.es.md"><b>🇪🇸</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.ru.md"><b>🇷🇺</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.hi.md"><b>🇮🇳</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.fr.md"><b>🇫🇷</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.it.md"><b>🇮🇹</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.de.md"><b>🇩🇪</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.ar.md"><b>🇦🇪</b></a></h2>

<p align="center"><img src="https://raw.githubusercontent.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/main/assets/images/awcu.gif" width= "700">

# 

## Функции

#### _<a href="https://github.com/AdguardTeam/AdGuardHome/blob/master/README.md"><b>Главная страница AdGuard</b></a>_: заблокировать рекламу на всех ваших устройствах(<a href="https://github.com/AdguardTeam/AdGuardHome/blob/master/README.md#how-does-adguard-home-compare-to-pi-hole"><b>_по сравнению с Пи-Хоул_</b></a>)

#### _<a href="https://www.wireguard.com/"><b>WireGuard</b></a>_: VPN-сервер дома доступен из любой внешней сети (IPv4 и IPv6)

#### _<a href="https://www.nlnetlabs.nl/projects/unbound/about/"><b>Свободный</b></a>_с[Стабби](https://dnsprivacy.org/dns_privacy_daemon_-_stubby/about_stubby/): Проверяющий, рекурсивный, кэширующий преобразователь DNS

#### _<a href="https://www.cloudflare.com/learning/what-is-cloudflare/"><b>Облачная вспышка</b></a>_: Лучшая производительность и безопасность при просмотре веб-сайтов (DoT и DoH).

# 

<i>Все программное обеспечение является бесплатным, с открытым исходным кодом и самостоятельный </i></br><a href="https://git.io/About"><b>О</b></a>                              

* * *

### Скорость запроса DNS с<a href="https://docs.oracle.com/en-us/iaas/Content/DNS/Tasks/testingdnsusingdig.htm"><b>Инструмент для раскопок BIND'S</b></a>🧪

<b>Результаты с google.com в миллисекундах:</b>

-   DNS-преобразователи AdGuard по умолчанию —`60-70 msec`
-   Общедоступные DNS-преобразователи Cloudflare/Quad9/Google —`50-70 msec`
-   Эта установка/конфигурация -`5-10 msec`

<details><summary><b>Preview🎥<img src="https://media.giphy.com/media/WT5h7PgVSScLLKtMaS/giphy.gif" width=50px height=40px></b></summary>
<p>

DNS AdGuard по умолчанию<b><i>против</i></b>эта установка⭐ :

[хттпс://усер-итагес.гитнубосерконтент.ком/18756975/150230438-б767е86ф-че18-4791-б5фе-0813615а37аз.мпч](https://user-images.githubusercontent.com/18756975/150230438-b767e86f-4e18-4791-b5fe-0813615a37a3.mp4)

Публичные резолверы Cloudflare/Quad9/Google DNS:

[хттпс://усер-итагес.гитнубосерконтент.ком/18756975/150319049-3д8акдс9-624ф-4б60-8е2-б80227522252.мпч](https://user-images.githubusercontent.com/18756975/150319049-3d8acdc9-624f-4b60-8ee2-b80227522252.mp4)

</p>
</details>

* * *

### Последняя проверка⏰ : 17 апреля 2022 г.</h2>

<div align="center">

|                             Проекты                             |                           Статус                           |
| :-------------------------------------------------------------: | :--------------------------------------------------------: |
|                     Главная страница AdGuard                    |                              ✅                             |
|                            Свободный                            |                              ✅                             |
|                         Облачная вспышка                        |                              ✅                             |
|                              Стабби                             |                              ✅                             |
|                            WireGuard                            |                              ✅                             |

</div>

# Оглавление

-   [Требования](#requirements)
-   [Установите ОС Raspberry Pi](#install-raspberry-pi-os)<img src="https://www.vectorlogo.zone/logos/raspberrypi/raspberrypi-icon.svg" width=20px height=20px>
    -   [Доступ к ОС Pi с помощью SSH](#access-pi-os-with-ssh)
-   [Установить AdGuard Главная](#install-adguard-home)<img src="https://www.vectorlogo.zone/logos/adguard/adguard-icon.svg" width=20px height=20px>
    -   [Настройте свои устройства для работы с Adguard](#set-up-your-devices-to-work-with-adguard)
    -   [Настройка черного списка AdGuard](#setting-up-adguard-blocklist)
        -   [Добавить/удалить несколько URL-адресов](#addremove-multiple-urls)
-   [Установить без привязки](#install-unbound)<img src="https://www.privacytools.io/img/apps/unbound.svg" width=20px height=20px>
-   [Установить CloudFlare](#install-cloudflare)<img src="https://www.vectorlogo.zone/logos/cloudflare/cloudflare-icon.svg" width=20px height=20px>
    -   [Настройка для Cloudflared (DoH)](#setup-for-cloudflared-doh)
    -   [Настройте Cloudflare (DoT) на Unbound](#configure-cloudflare-dot-on-unbound)
        -   [Настроить Stubby для несвязанных](#configure-stubby-for-unbound)
        -   [Настройте AdGuard с Cloudflare (DoH&DoT)](#configure-adguard-with-cloudflaredohdot)
-   [Установить WireGuard](#install-wireguard)<img src="https://www.vectorlogo.zone/logos/wireguard/wireguard-icon.svg" width=20px height=20px>или<a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/OpenVPN-Setup.md">OpenVPN (медленнее)</a><img src="https://i.imgur.com/Agstbe5.png" width=20px height=20px>
-   [Подключение VPN к телефону Android/IOS](#connecting-vpn-to-androidios-phone)
-   [Подключение VPN к Windows](#connecting-vpn-to-windows)
-   [Настройте Wireguard с помощью AdGuard/Unbound/Cloudflare](#configure-wireguard-with-adguardunboundcloudflare)
    -   [Ограничить трафик](#limit-traffic)
    -   [Ипвш](#ipv6)
    -   [Отключить все IPv6](#disable-all-ipv6)
-   [Тестовый VPN](#test-vpn)<img src="https://i.imgur.com/6Yf8Zra.png" width=20px height=20px>
-   [Автоматическое обновление Пи](#auto-update-pi)
-   [Установить Log2ram](#install-log2ram)
-   [Выключите светодиоды Pi](#turn-off-pi-led-lights)
-   [Защитите свой Raspberry Pi](#secure-your-raspberry-pi)
-   [Ресурсы репозитория](#repository-resources)
-   [ЧАСТО ЗАДАВАЕМЫЕ ВОПРОСЫ](#faq)

# 

# Требования

Это руководство основано на Raspberry Pi, но вы можете использовать любой Linux.<a href="https://github.com/thibmaek/awesome-raspberry-pi#os-images"><b>Операционная система</b></a><i>(кусочек)</i>, любое оборудование или<a href="https://www.google.com/search?q=What+is+a+VPS+used+for%3F&client=firefox-b-d&biw=1280&bih=582&sxsrf=APq-WBu-yng0bW9IWwNKsQhD6h1ZmRGncw%3A1650151372793&ei=zE9bYpL1L_OOwbkPgZ6DGA&ved=0ahUKEwiSi5rz3Jn3AhVzRzABHQHPAAMQ4dUDCA0&uact=5&oq=What+is+a+VPS+used+for%3F&gs_lcp=Cgdnd3Mtd2l6EAMyBAgAEA0yBAgAEA0yBAgAEA0yBAgAEA0yBggAEA0QHjIGCAAQFhAeMgYIABAWEB4yCAgAEAgQDRAeMggIABAIEA0QHjIICAAQCBANEB46BwgAEEcQsANKBAhBGABKBAhGGABQ8AFY8AFg_ANoAXABeACAAXCIAXCSAQMwLjGYAQCgAQKgAQHIAQjAAQE&sclient=gws-wiz"><b>VPS</b></a>.</br>(ОС Raspberry Pi наиболее проста и рекомендуется для Pi или для более опытных пользователей,<b>Диета Пи</b>ОС также рекомендуется)

-   Версия Raspberry Pi 3 или 4
-   Маршрутизатор, поддерживающий переадресацию портов (наиболее подходящий)
-   USB-кардридер MicroSD
-   Карта MicroSD (8 ГБ или больше, не ниже класса 4)
-   сетевой кабель
-   (Необязательно при использовании монитора) MicroHDMI-(RPi 4) или HDMI-(RPi 3)

# 

# <i>Установите ОС Raspberry Pi</b></i>

ОС Raspberry Pi поставляется в настольной и облегченной версиях (используйте облегченную для<a href="https://www.google.com/search?q=What+is+a+headless+operating+system%3F&client=firefox-b-d&sxsrf=APq-WBvlqMZasn_klYxS5HZmhKQlduKYuQ%3A1650123816301&ei=KORaYtz7EYOdwbkP74G16AE&ved=0ahUKEwjcr5-f9pj3AhWDTjABHe9ADR0Q4dUDCA0&uact=5&oq=What+is+a+headless+operating+system%3F&gs_lcp=Cgdnd3Mtd2l6EAMyCAghEBYQHRAeOgcIABBHELADSgQIQRgASgQIRhgAUMEBWMEBYNAEaAFwAXgAgAFqiAFqkgEDMC4xmAEAoAECoAEByAEIwAEB&sclient=gws-wiz"><b>без головы</b></a>Режим). Вы можете получить доступ к Raspberry Pi с помощью монитора/клавиатуры/мыши или подключиться через<a href="https://www.google.com/search?q=linux+ssh+&client=firefox-b-d&sxsrf=APq-WBve72uwEMMqUAe77nZoaygcx-ROMg%3A1650123667623&ei=k-NaYtbfJbmvwbkPpf6nqAQ&ved=0ahUKEwiW9azY9Zj3AhW5VzABHSX_CUUQ4dUDCA0&uact=5&oq=linux+ssh+&gs_lcp=Cgdnd3Mtd2l6EAMyBAgjECcyBQgAEIAEMgUIABCRAjIFCAAQkQIyBQgAEIAEMgUIABCABDIFCAAQkQIyBQgAEIAEMgUIABCABDIFCAAQgAQ6BwgAEEcQsANKBAhBGABKBAhGGABQuAFY0AJg1AZoAXABeACAAXaIAeIBkgEDMC4ymAEAoAEByAEIwAEB&sclient=gws-wiz"><b>SSH</b></a>из терминала.

Установите balenEtcher и загрузите образ Pi для записи на карту microSD.

-   Загрузите ОС Raspberry Pi:[хттпс://ввв.распберрыпы.орг/софтваре/оператинг-системс/](https://www.raspberrypi.org/software/operating-systems/)

-   Скачать balenaEtcher:[хттпс://ввв.балена.ио/этчер/](https://www.balena.io/etcher/)

После того, как у вас есть`Etcher`установлен и`Raspberry Pi OS`файл загружен, теперь вы можете вставить SD-карту с устройством чтения карт памяти microSD USB в свой компьютер.

-   Запустите Etcher и выберите загруженный образ ОС Raspberry Pi, выберите карту microSD и нажмите`Flash`.

После завершения прошивки найдите в «Этот компьютер» имя диска «загрузочный или USB-накопитель» (повторно подключите устройство чтения карт памяти USB, если его не видно). Перейдите на этот диск, создайте новый текстовый файл с именем**_`ssh without 'txt' extension`_**. Отключите «Скрыть расширения для известных типов файлов» в настройках проводника, если вы его не видите.

<p align="center">
 <img src="https://i.imgur.com/eV6uMbz.jpg">

<i>Вставьте SD-карту в Raspberry Pi, подключите кабель Ethernet и загрузитесь.</i>

## Доступ к ОС Pi с помощью SSH

-   Подождите минуту, пока Pi загрузится.

-   Откройте браузер и войдите на страницу панели вашего маршрутизатора.

-   Найдите список всех устройств, подключенных к вашей сети, и скопируйте IP-адрес Raspberry Pi (скорее всего, он будет иметь имя хоста`raspberrypi`)

-   Откройте терминал на вашем хост-компьютере. Вы можете использовать PowerShell для Windows или RaspController для Android.

Введите следующую команду:

    ssh pi@pi's IP address

<i>Вы можете использовать правую кнопку мыши для вставки текста в Windows PowerShell.</i>.

Введите «да» для вопроса об отпечатке пальца и введите «малина» для пароля по умолчанию (пароли будут невидимы в командной строке). Вы можете ввести**_`sudo passwd pi`_**изменить пароль.

<p align="center">
 <img src="https://i.imgur.com/Wf30jxG.jpg">

Запустите в терминале:

    sudo apt update -y && sudo apt upgrade -y

__Перезагрузитесь, когда закончите__

    sudo reboot

**[⬆ Вернуться к содержанию ⬆](#table-of-contents)**

# 

# <i>Установить AdGuard Главная</b></i>

Этот сценарий установки взят из<a href="https://github.com/AdguardTeam/AdGuardHome/blob/master/README.md"><b>Главная страница AdGuard</b></a>основной проект. Следите, чтобы быть в курсе.

Запустите следующую команду в своем терминале:

    curl -s -S -L https://raw.githubusercontent.com/AdguardTeam/AdGuardHome/master/scripts/install.sh | sh -s -- -v

-   Когда установка будет завершена, в терминале появится окно, показывающее`links`на главную страницу AdGuard(Начало работы)

-   `IMPORTANT:`В опции Listen Interfaces выберите`Eth0`и выберите следующий

    <p align="center">
     <img src="https://i.imgur.com/Wa00lDp.jpg" width=580px height=690px>

-   Настройте логин и пароль и войдите в админ-панель

-   `IMPORTANT:`В общих настройках установите «Сохранение журналов запросов» на`24 hours`. (Я читал, что у некоторых людей журналы заполняются, что замедляет работу Pi и требует перезагрузки)

## Настройте свои устройства для работы с AdGuard

-   Для Android/Apple перейдите в дополнительные настройки WiFi и выберите статический вариант. В`DNS 1`поле введите «IP-адрес Pi»

    <p align="center">
     <img src="https://i.imgur.com/nxpiqDw.jpg" width=450px height=580px>

-   Для ПК/Windows

    -   <i>Ипвч</i>

        Перейдите в настройки сети / измените параметры адаптера и щелкните правой кнопкой мыши в свойствах, затем выберите «Протокол Интернета версии 4 (TCP / IPv4)». Введите IP-адрес Pi в`Preferred DNS`сервер.

    -   <i>IPv6 (необходим для`DoH`&`DoT`чтобы работать позже в руководстве, если вы используете IPv6 на вашем маршрутизаторе)</i>

        Перейдите к «Протокол Интернета версии 6 (TCP/IPv6)».`::1`

`OPTIONAL:`<i>Вы можете добавить резервный DNS в альтернативные поля</i>

`BE AWARE:`<i>В Android добавление общедоступного DNS во второе поле прерывает блокировку рекламы AdGuard.</i>

<p align="center">
 <img src="https://i.imgur.com/8gsDk3z.jpg">

## Настройка черного списка AdGuard

На главной странице AdGuard в разделе фильтров выберите раздел черного списка DNS для добавления URL-адресов.

<p align="center">
 <img src="https://i.imgur.com/shrtJLD.png">

Вы можете поискать в Google другой черный список. Вот мой собственный черный список[<a href="https://raw.githubusercontent.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/main/My-Blocklist.txt"><b>кликните сюда</b></a>]с моими URL-адресами или создайте свой собственный из этих источников[<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/main/%F0%9F%A7%B1Blocklist-Sources%E2%84%B9%EF%B8%8F"><b>кликните сюда</b></a>].

`IMPORTANT:`Некоторые черные списки могут блокировать важное содержимое или веб-сайты. Для разблокировки перейдите в раздел "Журнал запросов" и увидите_разблокировать_опция при наведении курсора на запрос, помещая незаблокированные сайты в список «Пользовательские правила фильтрации» пример:`@@||bitly.com^$important`. Ищите клиентский IP и время.

## Добавить/удалить несколько URL-адресов

На данный момент вы можете добавлять только один URL-адрес в черный список DNS с помощью AdGuard, но есть скрипт python для одновременного добавления нескольких URL-адресов.

Откройте новый py-файл (bulkurls.py):

    nano bulkurls.py

Затем скопируйте и вставьте конфигурации скрипта[<a href="https://raw.githubusercontent.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/main/bulkurls.py"><b>кликните сюда</b></a>]. Набор`your AdGuard credentials`и сохраните (control+x, затем y, затем введите).

_При использовании**Диета Пи**установить`sudo apt-get install python3-pip -y && pip install requests`потому что он не устанавливается по умолчанию._

Бежать :`sudo python3 bulkurls.py`

К**удалять**тебе нужно изменить`add`в<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/62ba01ed8ed3a5bc5294b9fe7ee38c3e83ae1b86/bulkurls.py#L150"><b>вторая в последней строке</b></a>к`remove`в файле bulkurls.py.

Идти к[хттпс://дзвард.гитхов.ио/тулз/адблокк.хтмл](https://d3ward.github.io/toolz/adblock.html)чтобы проверить, блокирует ли реклама<img src="https://i.imgur.com/Q5oO9EY.png" width=100px height=80px>

**[⬆ Вернуться к содержанию ⬆](#table-of-contents)**

# 

# <i>Установить без привязки</b></i>

Запустите следующую команду в своем терминале:

    sudo apt install unbound -y

Для рекурсивного запроса хоста, который не кэширован как адрес, распознаватель должен начать с вершины дерева серверов и запросить корневые серверы, чтобы узнать, куда идти для домена верхнего уровня для запрашиваемого адреса. Unbound поставляется со встроенными подсказками по умолчанию.

    wget -O root.hints https://www.internic.net/domain/named.root && sudo mv root.hints /var/lib/unbound/

`IMPORTANT:`Это необходимо обновлять каждые 6 месяцев. К_**автоматическое обновление**_root.hints каждые 6 месяцев вам нужно создавать задание cron.

Введите в командной строке`crontab -e`, он попросит выбрать редактор (выберите 1) и вставьте эти строки внизу crontab и сохраните (control + x, затем y, затем введите):

    1 0 1 */6 * wget -O root.hints https://www.internic.net/domain/named.root
    2 0 1 */6 * sudo mv root.hints /var/lib/unbound/

_При использовании**Диета Пи**вам нужно установить resolvconf и перезапустить unbound-resolvconf.service, чтобы установить несвязанный сервер имен на 127.0.0.1 :_

    sudo apt-get install resolvconf -y && sudo systemctl restart unbound-resolvconf.service

<p align="center">
 <img src="https://i.imgur.com/26ro62t.jpg">

**[⬆ Вернуться к содержанию ⬆](#table-of-contents)**

# 

# <i>Установить CloudFlare</b></i>

## Настройка для Cloudflared`(DoH)`

[<a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/Cloudflare-DoH-Setup.md"><b>кликните сюда</b></a>]</h4>

## Настроить Cloudflare`(DoT)`на несвязанном

Создайте несвязанный файл конфигурации, введя в командной строке:

    sudo nano /etc/unbound/unbound.conf.d/unbound.conf

И скопируйте и вставьте весь текст из этого файла unbound.conf[<a href="https://raw.githubusercontent.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/main/unbound.conf"><b>кликните сюда</b></a>]и сохраните (control+x, затем y, затем введите).

## Настроить Stubby для несвязанных

Используйте Unbound для кэширования и stubby в качестве сервера пересылки TLS. Установить заглушку:

    sudo apt install stubby -y

Удалите и заново создайте файл stubby.yaml:

    cd /etc/stubby/ && sudo rm stubby.yml && sudo nano stubby.yml

И скопируйте и вставьте весь текст из этого короткого конфигурационного файла.[<a href="https://raw.githubusercontent.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/main/stubby.yml"><b>кликните сюда</b></a>]и сохранить. (`cd`чтобы вернуться в домашнюю папку, когда закончите).

-   Перезапустите unbound & stubby и проверьте статус:


    sudo systemctl restart unbound stubby ; systemctl status unbound stubby -l

<p align="center">
 <img src="https://i.imgur.com/7zIpWP2.jpg" width=650px height=370px>

## Настройте AdGuard с помощью`Cloudflare(DoH&DoT)`

-   На главной странице AdGuard в настройках выберите «Настройки DNS».

-   Удалите все из параметров сервера «Upstream» и «Bootstrap DNS» и введите:

    -   За`DNS over TLS(DoT)`добавлять`127.0.0.1:53`в полях серверов "Upstream" и "Bootstrap DNS"
    -   За`DNS over HTTPS(DoH)`добавлять`127.0.0.1:5053`в полях серверов "Upstream" и "Bootstrap DNS"
    -   За`TLS forwarder(stubby)`добавлять`127.0.0.1:8053`в полях серверов "Upstream" и "Bootstrap DNS"

-   `IMPORTANT:`Вам нужно проверить"<a href="https://adguard.com/en/blog/in-depth-review-adguard-home.html#dns"><b>Параллельный запрос</b></a>" возможность одновременной работы преобразователей DNS.

<p align="center">
 <img src="https://i.imgur.com/Ug4Euou.jpg" width=650px height=370px>

-   Затем в настройках DNS найдите раздел конфигурации кеша DNS и установите размер кеша на`0`(кеширование уже обрабатывается Unbound) и нажмите «Применить».

<p align="center">
 <img src="https://i.imgur.com/8Q5Zb0M.jpg" width=650px height=370px>
 
<b>Click apply and test upstreams</b>(might get a error in the first testing only).

#### `IMPORTANT:`Системе Windows и браузерам Android требуется некоторая настройка, чтобы`stabilize`Преобразователи DNS. Linux работает нормально<i>(проверено на монетном дворе)</i>

### Окна

-   Установите акриловый DNS-прокси:[хттпс://маякрон.альтервиста.орг/суппорт/акрилик/Хьоме.хтм](https://mayakron.altervista.org/support/acrylic/Home.htm)

-   Идти к`C:\Program Files (x86)\Acrylic DNS Proxy`и открыть`AcrylicConfiguration.ini`файл. Удалите все и скопируйте эти настройки[<a href="https://raw.githubusercontent.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/main/AcrylicConfiguration.ini"><b>кликните сюда</b></a>], только изменить_**Адрес Первичного Сервера**_на адрес вашего Пи.

-   В той же папке запустить`RestartAcrylicService.bat`&`PurgeAcrylicCacheData.bat`

    `TIP:`Устранение неполадок команд IP/DNS

        ipconfig /release
        ipconfig /renew
        ipconfig /flushdns

### Андроид

-   В любом браузере, который вы используете, включите**выключенный**`Use Secure DNS`вариант.
-   Имейте в виду, что могут возникать конфликты с пользовательскими корневыми прошивками и ядрами с настройками DNS build.prop или приложениями / модулем Magisk.

#### _Вот и все_. Теперь перейдите к[хттпс://1.1.1.1/хелп](https://1.1.1.1/help)в браузере, и вы должны увидеть, что эти параметры выводят «Да».

-   [x] Подключен к 1.1.1.1
-   [x] DNS через HTTPS (DoH)
-   [x] DNS через TLS (DoT)
-   [ ] DNS через WARP
    <p align="center">
     <img src="https://i.imgur.com/2S3IH5H.jpg" width=650px height=370px>

#### Другие сайты для проверки безопасности

[хттпс://бровсерлакс.ком/днс](https://browserleaks.com/dns)- должно показывать все, что подключено к "Cloudflare"

[хттпс://ввв.клоудфларе.ком/ссл/энкриптед-сны/](https://www.cloudflare.com/ssl/encrypted-sni/)- «Безопасный DNS / DNSSEC / TLS 1.3» должен быть зеленой галочкой.

[хттпс://днссек.вс.они-дуе.де/](https://dnssec.vs.uni-due.de/)- должен сказать "Да, ваш преобразователь DNS проверяет подписи DNSSEC"

**[⬆ Вернуться к содержанию ⬆](#table-of-contents)**

# 

# <i>Установить WireGuard</b></i>

**Перед установкой WireGuard**, если у вас нет<a href="https://www.google.com/search?client=firefox-b-d&q=static+IP"><b>Статический IP</b></a>вам нужно получить бесплатно`Dynamic DNS Subdomain`иначе ваш внешний IP-адрес динамически меняется от вашего интернет-провайдера, поэтому вам необходимо настроить динамическую службу DNS.[**<a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/Dns-Service-Guide.md"><b>кликните сюда</b></a>**]. Или пропустить шаг.

Вам также необходимо настроить<a href="https://www.google.com/search?q=What+is+port+forwarding+used+for%3F&client=firefox-b-d&sxsrf=APq-WBuwPqGlPJ6N9_l6qpQ3e5sYoUxZAQ%3A1650219365125&ei=ZVlcYo6sB6SGwbkP8tGOwA8&ved=0ahUKEwjO8ryY2pv3AhUkQzABHfKoA_gQ4dUDCA0&uact=5&oq=What+is+port+forwarding+used+for%3F&gs_lcp=Cgdnd3Mtd2l6EAMyBggAEBYQHjoHCAAQRxCwAzoHCAAQsAMQQ0oECEEYAEoECEYYAFDMAVjMAWCBBWgBcAF4AIABbIgBbJIBAzAuMZgBAKABAqABAcgBCsABAQ&sclient=gws-wiz"><b>Перенаправление порта</b></a>на вашем маршрутизаторе, чтобы вы могли получить доступ к WireGuard за пределами нашей сети, например, в точке доступа в кафе или через мобильные данные.
ТИП | ЦЕННОСТЬ  
------------ \| -------------
Устройство | Имя хоста или IP-адрес Raspberry Pi
Протокол | UDP
Диапазон портов | 51820-51820
Исходящий порт | 51820
Разрешить доступ в Интернет(если есть) | да

Настройка порта моего 👇роутера👇. У вас может быть по-другому, но вы получите это. Помните, Google 🔍поисковая система🔎 — ваш друг. Если вы не можете подключиться из внешней сети, что означает, что интернет-провайдер заблокировал исходящие соединения, вы можете позвонить им и вежливо попросить, чтобы он заработал.

<p align="center">
 <img src="https://i.imgur.com/9LBEk1i.jpg">

* * *

👊БОЛЬШОЕ СПАСИБО👊 за этот скрипт установки от<a href="https://github.com/Nyr/wireguard-install"><b>Ныр</b></a>. Следите, чтобы быть в курсе.

Запустить в терминале

    wget https://git.io/wireguard -O wireguard-install.sh && sudo bash wireguard-install.sh

-   Скрипт запросит у вас общедоступный IPv4/имя хоста для VPN._Если_у вас есть статический IP-адрес, затем продолжите или введите динамический домен DNS, который вы создали из<a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/Dns-Service-Guide.md"><b>инструкции</b></a>. Например: trinibvpn.freeddns.org

-   Для варианта порта`press enter`по умолчанию 51820. Для имени клиента просто введите любое имя, которое вы хотите, а для DNS используйте вариант 3 (`1.1.1.1`) теперь. Вы будете настраивать`AdGuard/Unbound/Cloudflare`с VPN после его завершения.

<p align="center">
 <img src="https://i.imgur.com/WUNZIK4.jpg">

-   Дождитесь завершения установки и показа QR-кода, не закрывайте. Но если вы это сделаете, чтобы`regenerate qrcode`, введите в терминал, но заменив только имя`yourclientname.conf`файл на свой:


    sudo cp /root/yourclientname.conf /home/pi && sudo qrencode -t ansiutf8 < yourclientname.conf

`IMPORTANT:`Вам нужно будет добавить нового пользователя/клиента для каждого устройства, которое вы используете с VPN. Чтобы добавить нового пользователя, просто перезапустите скрипт и создайте пользователя с другим именем клиента.

<b>Использовать_OpenVPN_</b>[<a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/OpenVPN-Setup.md"><b>кликните сюда</b></a>]

# 

### Подключение VPN к телефону Android/IOS

Установите приложение WireGuard из Google Play или App Store:

WireGuard (Google Play):[хттпс://плай.гоогле.ком/сторе/аппс/детаилс?ид=ком.вырегуард.андроид](https://play.google.com/store/apps/details?id=com.wireguard.android)

WireGuard (магазин приложений):[хттпс://аппс.аппле.ком/ус/апп/вырегуард/д1441195209](https://apps.apple.com/us/app/wireguard/id1441195209)

Вам необходимо отсканировать QR-код, показанный в терминале с помощью приложения WireGuard, выбрать`+ button`и воспользуйтесь опцией`Scan from QR code`для установки конфигурации.

`IMPORTANT`: Давать возможность**серверная часть модуля ядра**в настройках

<p align="left">
 <img src="https://i.imgur.com/R4qbiOQ.jpg" width=250px height=350px>

### Подключение VPN к Windows

WireGuard для окон:[хттпс://довнлоад.вырегуард.ком/виндовс-клиент/вырегуард-инсталлер.ехе](https://download.wireguard.com/windows-client/wireguard-installer.exe)

-   Создать`new text document`с любым именем на PV, чтобы скопировать текст из файла конфигурации клиента WireGuard.

-   Чтобы увидеть текст в файле конфигурации клиента, введите в терминале:


    sudo cat /root/yourclientname.conf

-   Выделите весь текст, скопируйте и вставьте его в текстовый файл на ПК и сохраните. Затем переименуйте расширение из`txt`к`conf`. Теперь у вас есть файл конфигурации для этого клиента WireGuard.

-   Теперь вы можете импортировать файл конфигурации в WireGuard (опция импорта из файла).

## Настройте WireGuard с помощью`Adguard/Unbound/Cloudflare`

_Помните, что это для тех случаев, когда вы подключены к WireGuard VPN во внешней сети или дома 24/7, потому что AdGuard/Unbound/Cloudflare уже настроены и запущены на ваших устройствах вручную._(нет проблем с настройкой обоих для моего опыта)

-   В приложении WireGuard выберите свой туннель и нажмите «Изменить» (карандаш вверху справа).

-   В разделе DNS-серверы введите`Pi's IP`и сохраните (IPv4 и IPv6)

<p align="center">
 <img src="https://i.imgur.com/UC0vWfE.jpg" width=450px height=500px>  

### Ограничить трафик

С WireGuard вы потеряете около 50% скорости интернета из-за процесса туннелирования через Pi на роутер к устройствам\*\*

Удалите в разрешенных IP-адресах опцию «0.0.0.0/0, ::/0», потому что она направляет весь трафик в вашу домашнюю сеть, которая будет медленной. Вам нужно отправлять трафик только через ваши адреса.

-   Сначала вам нужно заменить его вашим сетевым шлюзом, но установить последний номер на ноль и<a href="https://www.google.com/search?q=prefix+length+explained&client=firefox-b-d&sxsrf=ALeKk036Jc9vJl73zVXf0yyZs5UlKRlNRQ%3A1621083125589&ei=9cOfYI66I5-qwbkPkdWxkAk&oq=prefix+length+explained&gs_lcp=Cgdnd3Mtd2l6EAMyBggAEAcQHjoHCCMQsAMQJzoHCAAQRxCwA1CUJ1iUJ2CiKmgBcAJ4AIABsAGIAdQCkgEDMC4ymAEAoAEBqgEHZ3dzLXdpesgBCcABAQ&sclient=gws-wiz&ved=0ahUKEwjOiOie3cvwAhUfVTABHZFqDJIQ4dUDCA0&uact=5"><b>длина префикса</b></a>до 24. Например:`192.168.1.1/24`к`192.168.1.0/24`или как мой маршрутизатор ISP`192.168.100.1/24`к`192.168.100.0/24`.~~**Теперь я теряю только 25% скорости**😁 (PS. В сети 5g)~~

`UPDATE:`После обновления WireGuard я не получаю более высокую скорость, делая это 😞 .. но это все еще имеет смысл_нет_использовать`"0.0.0.0/0, ::/0`с Wi-Fi. Если кто-нибудь знает какие-нибудь хитрости, чтобы получить повышение, дайте мне знать.

<p align="center">
 <img src="https://i.imgur.com/x4m6Pbl.jpg" width=450px height=500px>

### ПОЖАЛУЙСТА, ПРОЧИТАЙТЕ !! , БУДЬТЕ ОСТОРОЖНЫ!!

`IMPORTANT`:_Если в вашей сети есть IP-адреса для устройств, которые заканчиваются трехзначным числом (более 24), например: 192.168.100.`254`, вы не сможете правильно маршрутизировать из внешней сети, потому что применение 24 позволяет использовать только числа от 1 до 24. Вместо этого вам нужно поставить`0`для маршрутизации из диапазона 24, например:`192.168.100.0/0`_.

Или вы можете изменить диапазон IP-адресов на своем маршрутизаторе (по моему опыту, вы можете получить немного лучшую скорость, потому что он не будет маршрутизировать ненужные разрешенные IP-адреса в диапазоне 24).

<p align="center">
 <img src="https://i.imgur.com/ZZ4aMUI.jpg" width=750px height=550px>

## Ипвш

Если вы используете IPv6, при подключении к Wi-Fi вам необходимо ввести в WireGuard разрешенные IP-адреса.`fe80::1/0`также. Например`192.168.100.0/0, fe80::1/0`

При подключении к кабелю Ethernet на ПК с Windows необходимо ввести`::1`в адресе IPv6 в предпочитаемом DNS-сервере «Протокол Интернета версии 6 (TCP/IPv6)».

Затем перейдите к[хттпс://ипвшлеак.ком/](https://ipv6leak.com/)и вы должны увидеть "_Ваш IPv6 не протекает_".

# 

## Отключить все IPv6

#### Отключите IPv6, если у вас его нет или он вам не нужен[<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/main/Disable-All-IPv6.md"><b>кликните сюда</b></a>]. В результате, если у вас слабый интернет, отключение IPv6 может ускорить запрос DNS, но снизить безопасность.

# 

## Тест VPN

Как узнать, действительно ли работает WireGuard VPN?

За**окна**скачать Wireshark:[хттпс://ввв.верещарк.орг/#довнлоад](https://www.wireshark.org/#download)

После загрузки вы можете использовать приложение для проверки пакетов данных, в которых установлен протокол, используемый WireGuard VPN. Когда пакетный трафик`encrypted`, его можно прочитать, например, так:

<p align="center">
 <img src="https://i.imgur.com/Tn4M47R.jpg">

За**андроид**вы можете использовать PCAPdroid:[хттпс://плай.гоогле.ком/сторе/аппс/детаилс?ид=ком.эмануэлеф.ремоте\_каптуре&хл=ен&гл=УС](https://play.google.com/store/apps/details?id=com.emanuelef.remote_capture&hl=en&gl=US)

Вы должны увидеть все соединения`closed`и статус, показывающий все DNS, а не TLS-соединения во всех приложениях. (откройте и используйте приложения для сканирования PCAPdroid)

**[⬆ Вернуться к содержанию ⬆](#table-of-contents)**

* * *

# 

# <i>Автоматическое обновление Пи</b></i>

Откройте новый файл sh с именем update и скопируйте и вставьте скрипт.[<a href="https://raw.githubusercontent.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/main/update.sh"><b>кликните сюда</b></a>]

    sudo nano update.sh

Установить разрешение

    sudo chmod 700 update.sh

Откройте файл cron, введя в командной строке`crontab -e`, скопируйте и вставьте командную строку задания внизу файла cron и сохраните.

    0 3 * * WED sudo ./update.sh 2>&1 >/home/pi/updatelog

Теперь Pi будет обновляться каждую среду в 3 часа ночи. Или вы можете пойти в[хттпс://кронтаб.гуру/](https://crontab.guru/)и установить свой собственный график работы.

Настройте дату/часовой пояс Pi в терминале:

    sudo dpkg-reconfigure tzdata

или установить вручную

    sudo date -s "25 DEC 2012 11:14:00"

# 

# <i>Установить Лог2Рам</b></i>

Одним из наиболее значительных преимуществ разгрузки оперативной памяти является то, что она улучшает**Потенциальный срок службы SD-карты**.
Файлы журналов — это одна из тех вещей, которые чаще всего записываются различными программами, которые вы устанавливаете.
Перемещая файлы в оперативную память, вы можете контролировать, как часто они записываются на SD-карту. Вы по-прежнему сможете получить доступ к этим файлам в ОЗУ, как если бы они находились на вашей SD-карте.

Скопируйте и вставьте эту строку в терминал:

Вручную

    wget https://git.io/log2ram -O Log2Ram-Script.sh && sudo chmod +x Log2Ram-Script.sh && sudo ./Log2Ram-Script.sh

или

Добавить источник репо (автоматическое обновление)

    echo "deb [signed-by=/usr/share/keyrings/azlux-archive-keyring.gpg] http://packages.azlux.fr/debian/ bullseye main" | sudo tee /etc/apt/sources.list.d/azlux.list
    sudo wget -O /usr/share/keyrings/azlux-archive-keyring.gpg  https://azlux.fr/repo.gpg
    sudo apt update
    sudo apt install log2ram

# 

# <i>Выключите светодиодные индикаторы Pi</b></i>

Я предполагаю, что мощность светодиодов повлияет на ненужное электричество и тепло 🤷😅. В любом случае, в этом нет необходимости, если вы просто используете его как сетевой сервер. Откройте файл cron, введя в командной строке`crontab -e`, скопируйте и вставьте командную строку задания внизу файла cron и сохраните.

Зеленый

    @reboot echo none | sudo tee /sys/class/leds/led0/trigger

Красный

    @reboot echo none | sudo tee /sys/class/leds/led1/trigger

Перезагрузите Пи.

# 

# <i>Защитите свой Raspberry Pi</b></i>

<p align="center">
<a href="https://gist.github.com/boseji/c9e91ff3bd0b3cfb62a5e260fe505374"><img src="https://i.imgur.com/a9JQVls.png" width=80px height=90px></a>

[<a href="https://gist.github.com/boseji/c9e91ff3bd0b3cfb62a5e260fe505374"><b>кликните сюда</b></a>]

<i>(Я просто использую Fail2Ban и меняю порт SSH)</i>

**[⬆ Вернуться к содержанию ⬆](#table-of-contents)**

* * *

<b>ЛЮБЫЕ ПРОБЛЕМЫ, ИСПРАВЛЕНИЯ ИЛИ СОВЕТЫ, ЧТОБЫ СДЕЛАТЬ ЭТИ ПРОЕКТЫ ЛУЧШЕ, ПОЖАЛУЙСТА, ВНОСИТЕ 🤖</b>

* * *

<p align="center">
<img src="https://user-images.githubusercontent.com/73097560/115834477-dbab4500-a447-11eb-908a-139a6edaec5c.gif"
<br> 
<br> 
<br> 

<p align="center">
 <img src="https://i.imgur.com/Q07E7SW.gif" width=500px height=30px>

<p align="center">
<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/stargazers"><img src="https://reporoster.com/stars/dark/trinib/AdGuard-WireGuard-Unbound-Cloudflare"></a>

<p align="center">
<img src="https://user-images.githubusercontent.com/73097560/115834477-dbab4500-a447-11eb-908a-139a6edaec5c.gif"</p>

# 

## _Ресурсы репозитория_

<h5 https://www.raspberrypi.com/documentation/

[хттпс://гитхов.ком/АдгуардТеам/АдГуардХьоме/вики/Геттинг-Стартед](https://github.com/AdguardTeam/AdGuardHome/wiki/Getting-Started)

[хттпс://девелоперс.клоудфларе.ком/](https://developers.cloudflare.com/)

[хттпс://докс.пи-холе.нет/гуидесс/днс/клоудфларед/](https://docs.pi-hole.net/guides/dns/cloudflared/)

[хттпс://докс.пи-холе.нет/гуидесс/днс/инбунд/](https://docs.pi-hole.net/guides/dns/unbound/)

[хттпс://нлнетьлабс.нл/документатион/инбунд/инбунд.конф/](https://nlnetlabs.nl/documentation/unbound/unbound.conf/)

[хттпс://днсприваций.орг/днс\_приваций\_клиентс/](https://dnsprivacy.org/dns_privacy_clients/)

[хттпс://гитхов.ком/анодеепНД/пиньоле-инбунд](https://github.com/anudeepND/pihole-unbound)

[хттпс://гитхов.ком/стонг/инбунд.конф.д](https://github.com/stong/unbound.conf.d)

[хттпс://гитхов.ком/Нир/вырегуард-инсталл](https://github.com/Nyr/wireguard-install)

[хттпс://гитхов.ком/азлох/лог2рам](https://github.com/azlux/log2ram)

* * *

## _ЧАСТО ЗАДАВАЕМЫЕ ВОПРОСЫ_

Часто задавайте вопросы[<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/discussions/17"><b>кликните сюда</b></a>]
