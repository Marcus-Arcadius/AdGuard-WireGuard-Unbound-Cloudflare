# ![logo](https://i.imgur.com/zqJELkl.png)

<p align="center">
 <img src="https://img.shields.io/badge/License-MIT-blue.svg">
 <img src="https://badges.frapsoft.com/os/v3/open-source.svg?v=103">
 <img src="http://ForTheBadge.com/images/badges/built-with-love.svg">
 <img src="https://img.shields.io/badge/badges-awesome-green.svg">
 <img src="https://img.shields.io/badge/Stay-Safe-red?logo=data:image/svg%2bxml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgNTEwIDUxMCIgaGVpZ2h0PSI1MTIiIHZpZXdCb3g9IjAgMCA1MTAgNTEwIiB3aWR0aD0iNTEyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxnPjxnPjxwYXRoIGQ9Im0xNzQuNjEgMzAwYy0yMC41OCAwLTQwLjU2IDYuOTUtNTYuNjkgMTkuNzJsLTExMC4wOSA4NS43OTd2MTA0LjQ4M2g1My41MjlsNzYuNDcxLTY1aDEyNi44MnYtMTQ1eiIgZmlsbD0iI2ZmZGRjZSIvPjwvZz48cGF0aCBkPSJtNTAyLjE3IDI4NC43MmMwIDguOTUtMy42IDE3Ljg5LTEwLjc4IDI0LjQ2bC0xNDguNTYgMTM1LjgyaC03OC4xOHYtODVoNjguMThsMTE0LjM0LTEwMC4yMWMxMi44Mi0xMS4yMyAzMi4wNi0xMC45MiA0NC41LjczIDcgNi41NSAxMC41IDE1LjM4IDEwLjUgMjQuMnoiIGZpbGw9IiNmZmNjYmQiLz48cGF0aCBkPSJtMzMyLjgzIDM0OS42M3YxMC4zN2gtNjguMTh2LTYwaDE4LjU1YzI3LjQxIDAgNDkuNjMgMjIuMjIgNDkuNjMgNDkuNjN6IiBmaWxsPSIjZmZjY2JkIi8+PHBhdGggZD0ibTM5OS44IDc3LjN2OC4wMWMwIDIwLjY1LTguMDQgNDAuMDctMjIuNjQgNTQuNjdsLTExMi41MSAxMTIuNTF2LTIyNi42NmwzLjE4LTMuMTljMTQuNi0xNC42IDM0LjAyLTIyLjY0IDU0LjY3LTIyLjY0IDQyLjYyIDAgNzcuMyAzNC42OCA3Ny4zIDc3LjN6IiBmaWxsPSIjZDAwMDUwIi8+PHBhdGggZD0ibTI2NC42NSAyNS44M3YyMjYuNjZsLTExMi41MS0xMTIuNTFjLTE0LjYtMTQuNi0yMi42NC0zNC4wMi0yMi42NC01NC42N3YtOC4wMWMwLTQyLjYyIDM0LjY4LTc3LjMgNzcuMy03Ny4zIDIwLjY1IDAgNDAuMDYgOC4wNCA1NC42NiAyMi42NHoiIGZpbGw9IiNmZjRhNGEiLz48cGF0aCBkPSJtMjEyLjgzIDM2MC4xMnYzMGg1MS44MnYtMzB6IiBmaWxsPSIjZmZjY2JkIi8+PHBhdGggZD0ibTI2NC42NSAzNjAuMTJ2MzBoMzYuMTRsMzIuMDQtMzB6IiBmaWxsPSIjZmZiZGE5Ii8+PC9nPjwvc3ZnPg==">

</p>
 <p align="center">
     <a href="https://img.shields.io/github/stars/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=FFD700&style=for-the-badge" alt="GitHub Repo stars">
         <img src="https://img.shields.io/github/stars/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=FFD700&style=for-the-badge"></a>
     <a href="https://img.shields.io/github/forks/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=00a671&style=for-the-badge" alt="GitHub forks">
         <img src="https://img.shields.io/github/forks/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=00a671&style=for-the-badge"></a>
     <a href="https://img.shields.io/github/watchers/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=9700b2&style=for-the-badge" alt="GitHub watchers">
         <img src="https://img.shields.io/github/watchers/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=9700b2&style=for-the-badge"></a>
</p>

<h2><p align="center">
<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.zh-CN.md"><b>🇨🇳</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.es.md"><b>🇪🇸</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.ru.md"><b>🇷🇺</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.hi.md"><b>🇮🇳</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.fr.md"><b>🇫🇷</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.it.md"><b>🇮🇹</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.de.md"><b>🇩🇪</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.ar.md"><b>🇦🇪</b></a></h2>

<p align="center"><img src="https://raw.githubusercontent.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/main/assets/images/awcu.gif" width= "700">

# 

## Recursos

#### _<a href="https://github.com/AdguardTeam/AdGuardHome/blob/master/README.md"><b>Página inicial do AdGuard</b></a>_: Bloqueie anúncios em todos os seus dispositivos(<a href="https://github.com/AdguardTeam/AdGuardHome/blob/master/README.md#how-does-adguard-home-compare-to-pi-hole"><b>_comparado ao Pi-Hole_</b></a>)

#### _<a href="https://www.wireguard.com/"><b>WireGuard</b></a>_: Servidor VPN em casa acessível a partir de qualquer rede externa (IPv4 e IPv6)

#### <a href="https://www.nlnetlabs.nl/projects/unbound/about/"><b><i>Não vinculado</i></b></a>com[<i>Atarracado</i>](https://dnsprivacy.org/dns_privacy_daemon_-_stubby/about_stubby/): Um resolvedor de DNS de validação, recursivo e com cache

#### _<a href="https://www.cloudflare.com/learning/what-is-cloudflare/"><b>Cloudflare</b></a>_: Melhor desempenho e segurança ao navegar em sites (DoT e DoH)

<i>Todos os softwares são gratuitos, de código aberto e auto-hospedado </i></br><a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/wiki/About"><b>Sobre</b></a>\|<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/discussions/17"><b>Perguntas frequentes</b></a>\|<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/wiki"><b>Wiki</b></a>                         

# 

### Velocidade de consulta DNS com<a href="https://docs.oracle.com/en-us/iaas/Content/DNS/Tasks/testingdnsusingdig.htm"><b>Ferramenta de escavação do BIND</b></a>🧪

<b>Resultados de google.com em milissegundos:</b>

-   Resolvedores de DNS padrão do AdGuard -`60-70 msec`
-   Public Cloudflare/Quad9/Google DNS Resolvers -`50-70 msec`
-   Esta instalação/configuração -`5-10 msec`

<details><summary><b>Preview🎥<img src="https://media.giphy.com/media/WT5h7PgVSScLLKtMaS/giphy.gif" width=50px height=40px></b></summary>
<p>

DNS padrão do AdGuard<b><i>vs</i></b>esta configuração⭐ :

<https://user-images.githubusercontent.com/18756975/150230438-b767e86f-4e18-4791-b5fe-0813615a37a3.mp4>

Public Cloudflare/Quad9/Google DNS resolvers :

<https://user-images.githubusercontent.com/18756975/150319049-3d8acdc9-624f-4b60-8ee2-b80227522252.mp4>

</p>
</details>

# 

### Última verificação⏰ : 17 de abril de 2022</h2>

<div align="center">

|                             Projetos                             |                           Status                           |
| :--------------------------------------------------------------: | :--------------------------------------------------------: |
|                     Página inicial do AdGuard                    |                              ✅                             |
|                           Não vinculado                          |                              ✅                             |
|                            Cloudflare                            |                              ✅                             |
|                            Atarracado                            |                              ✅                             |
|                             WireGuard                            |                              ✅                             |

</div>

# Índice

-   [Requisitos](#requirements)
-   [Install Raspberry Pi OS](#install-raspberry-pi-os)<img src="https://www.vectorlogo.zone/logos/raspberrypi/raspberrypi-icon.svg" width=20px height=20px>
    -   [Acesse o Pi OS com SSH](#access-pi-os-with-ssh)
-   [Instalar AdGuard Home](#install-adguard-home)<img src="https://www.vectorlogo.zone/logos/adguard/adguard-icon.svg" width=20px height=20px>
    -   [Configure seus dispositivos para trabalhar com o Adguard](#set-up-your-devices-to-work-with-adguard)
    -   [Configurando a lista de bloqueio do AdGuard](#setting-up-adguard-blocklist)
        -   [Adicionar/remover vários URLs](#addremove-multiple-urls)
-   [Instalar não vinculado](#install-unbound)<img src="https://www.privacytools.io/img/apps/unbound.svg" width=20px height=20px>
-   [Instalar Cloudflare](#install-cloudflare)<img src="https://www.vectorlogo.zone/logos/cloudflare/cloudflare-icon.svg" width=20px height=20px>
    -   [Configuração para Cloudflared (DoH)](#setup-for-cloudflared-doh)
    -   [Configurar Cloudflare (DoT) em Unbound](#configure-cloudflare-dot-on-unbound)
        -   [Configurar Stubby para Unbound](#configure-stubby-for-unbound)
        -   [Configurar AdGuard com Cloudflare (DoH&DoT)](#configure-adguard-with-cloudflaredohdot)
-   [Instalar o WireGuard](#install-wireguard)<img src="https://www.vectorlogo.zone/logos/wireguard/wireguard-icon.svg" width=20px height=20px>ou<a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/OpenVPN-Setup.md">OpenVPN (mais lento)</a><img src="https://i.imgur.com/Agstbe5.png" width=20px height=20px>
-   [Conectando VPN ao telefone Android/IOS](#connecting-vpn-to-androidios-phone)
-   [Conectando VPN ao Windows](#connecting-vpn-to-windows)
-   [Configurar Wireguard com AdGuard/Unbound/Cloudflare](#configure-wireguard-with-adguardunboundcloudflare)
    -   [Limitar o tráfego](#limit-traffic)
    -   [Ипвш](#ipv6)
    -   [Desabilitar todos os IPv6](#disable-all-ipv6)
-   [Teste de VPN](#test-vpn)<img src="https://i.imgur.com/6Yf8Zra.png" width=20px height=20px>
-   [Recursos do Repositório](#repository-resources)

# 

# Requisitos

Este tutorial é baseado no Raspberry Pi, mas você pode usar qualquer Linux<a href="https://github.com/thibmaek/awesome-raspberry-pi#os-images"><b>sistema operacional</b></a><i>(pedaço)</i>, qualquer hardware ou um<a href="https://www.google.com/search?q=What+is+a+VPS+used+for%3F&client=firefox-b-d&biw=1280&bih=582&sxsrf=APq-WBu-yng0bW9IWwNKsQhD6h1ZmRGncw%3A1650151372793&ei=zE9bYpL1L_OOwbkPgZ6DGA&ved=0ahUKEwiSi5rz3Jn3AhVzRzABHQHPAAMQ4dUDCA0&uact=5&oq=What+is+a+VPS+used+for%3F&gs_lcp=Cgdnd3Mtd2l6EAMyBAgAEA0yBAgAEA0yBAgAEA0yBAgAEA0yBggAEA0QHjIGCAAQFhAeMgYIABAWEB4yCAgAEAgQDRAeMggIABAIEA0QHjIICAAQCBANEB46BwgAEEcQsANKBAhBGABKBAhGGABQ8AFY8AFg_ANoAXABeACAAXCIAXCSAQMwLjGYAQCgAQKgAQHIAQjAAQE&sclient=gws-wiz"><b>VPS</b></a>.</br>(Raspberry Pi OS é mais simples e recomendado para Pi ou para usuários mais experientes,<b>DietPi</b>OS também é recomendado)

-   Uma versão Raspberry Pi 3 ou 4
-   Um roteador que suporta o encaminhamento de porta (Most Can)
-   Leitor de cartão microSD USB
-   Cartão MicroSD (8 GB ou maior, pelo menos Classe 4)
-   Cabo Ethernet
-   (Opcional se estiver usando monitor) MicroHDMI-(RPi 4) ou HDMI-(RPi 3)

# 

# <i>Install Raspberry Pi OS</b></i>

Raspberry Pi OS vem nas versões desktop e lite (use lite para<a href="https://www.google.com/search?q=What+is+a+headless+operating+system%3F&client=firefox-b-d&sxsrf=APq-WBvlqMZasn_klYxS5HZmhKQlduKYuQ%3A1650123816301&ei=KORaYtz7EYOdwbkP74G16AE&ved=0ahUKEwjcr5-f9pj3AhWDTjABHe9ADR0Q4dUDCA0&uact=5&oq=What+is+a+headless+operating+system%3F&gs_lcp=Cgdnd3Mtd2l6EAMyCAghEBYQHRAeOgcIABBHELADSgQIQRgASgQIRhgAUMEBWMEBYNAEaAFwAXgAgAFqiAFqkgEDMC4xmAEAoAECoAEByAEIwAEB&sclient=gws-wiz"><b>sem cabeça</b></a>modo). Você pode acessar um Raspberry Pi com um monitor/teclado/mouse ou conectar via<a href="https://www.google.com/search?q=What+is+SSH+in+Linux%3F&client=firefox-b-d&sxsrf=APq-WBsiHvek7g0OrBHWDbEy-x7m-B6O3Q%3A1650481751310&ei=V1pgYoHNEs-uwbkPtI25mAI&ved=0ahUKEwjB1PrTq6P3AhVPVzABHbRGDiMQ4dUDCA0&uact=5&oq=What+is+SSH+in+Linux%3F&gs_lcp=Cgdnd3Mtd2l6EAMyBggAEBYQHjIGCAAQFhAeMgYIABAWEB4yBggAEBYQHjIGCAAQFhAeMgYIABAWEB4yBggAEBYQHjIGCAAQFhAeMgYIABAWEB4yBggAEBYQHjoHCCMQsAMQJzoHCAAQRxCwAzoHCAAQsAMQQzoKCAAQ5AIQsAMYAToPCC4Q1AIQyAMQsAMQQxgCSgQIQRgASgQIRhgBUM8IWM8IYJAMaAFwAXgAgAFxiAFxkgEDMC4xmAEAoAECoAEByAERwAEB2gEGCAEQARgJ2gEGCAIQARgI&sclient=gws-wiz"><b>ssh</b></a>de um terminal.

Instale o balenEtcher e baixe a imagem Pi para escrever no cartão microSD.

-   Download Raspberry Pi OS:<https://www.raspberrypi.org/software/operating-systems/>

-   Baixe o BalenaEtcher:<https://www.balena.io/etcher/>

Depois que você tiver`Etcher`instalado e`Raspberry Pi OS`arquivo baixado, agora você pode inserir o cartão SD com leitor de cartão microSD USB em seu computador.

-   Inicie o Etcher e escolha a imagem do Raspberry Pi OS que você baixou, selecione seu cartão microSD e clique`Flash`.

Depois que o flash for concluído, procure em "Este PC" por um nome de disco "boot ou unidade USB" (reconecte o leitor de cartão USB se não for visto). Vá para esse disco, crie um novo arquivo de texto chamado**_`ssh without 'txt' extension`_**. Desative “Ocultar extensões para tipos de arquivo conhecidos” nas opções do explorador de arquivos, caso não o veja.

<p align="center">
 <img src="https://i.imgur.com/eV6uMbz.jpg">

<i>Coloque o cartão SD no Raspberry Pi, conecte o cabo Ethernet e inicialize</i>

## Acesse o Pi OS com SSH

-   Aguarde um minuto para a primeira inicialização do Pi

-   Abra o navegador e faça login na página do painel do seu roteador

-   Encontre a lista de todos os dispositivos conectados à sua rede e copie o endereço IP do Raspberry Pi (provavelmente terá o nome do host`raspberrypi`)

-   Abra o terminal em sua máquina host. Você pode usar o powerShell no Windows ou RaspController para Android.

Digite o seguinte comando:

    ssh pi@pi's IP address

<i>Você pode usar o botão direito do mouse para colar texto no Windows powerShell</i>.

Digite "yes" para a pergunta de impressão digital e digite "raspberry" para a senha padrão (as senhas serão invisíveis na linha de comando). Você pode digitar**_`sudo passwd pi`_**para alterar a senha depois.

<p align="center">
 <img src="https://i.imgur.com/Wf30jxG.jpg">

Execute no terminal:

    sudo apt update -y && sudo apt upgrade -y

__Reinicie quando terminar__

    sudo reboot

**[⬆ Voltar ao conteúdo ⬆](#table-of-contents)**

# 

# <i>Instalar AdGuard Home</b></i>

Este script de instalação é de<a href="https://github.com/AdguardTeam/AdGuardHome/blob/master/README.md"><b>Página inicial do AdGuard</b></a>projeto principal. Siga para se manter atualizado.

Execute o seguinte comando no seu terminal:

    curl -s -S -L https://raw.githubusercontent.com/AdguardTeam/AdGuardHome/master/scripts/install.sh | sh -s -- -v

-   Quando a instalação estiver concluída, uma janela aparecerá no terminal mostrando`links`para sua página inicial do AdGuard (Começar)

-   `IMPORTANT:`Na opção Ouvir Interfaces escolha`Eth0`e selecione próximo

    <p align="center">
     <img src="https://i.imgur.com/Wa00lDp.jpg" width=580px height=690px>

-   Configure nome de usuário e senha e faça login no painel de administração

-   `IMPORTANT:`Nas configurações gerais, defina "Retenção de logs de consulta" como`24 hours`. (Eu li que, para algumas pessoas, os logs são preenchidos, o que diminui a velocidade do Pi e precisa de uma reinicialização)

## Configure seus dispositivos para trabalhar com o AdGuard

-   Para Android/Apple, vá para configurações avançadas de WiFi e selecione a opção estática. Dentro`DNS 1`campo digite o endereço "IP do Pi"

    <p align="center">
     <img src="https://i.imgur.com/nxpiqDw.jpg" width=450px height=580px>

-   Para PC/Windows

    -   <i>Ипвч</i>

        Vá para configurações de rede / altere as opções do adaptador e clique com o botão direito do mouse em propriedades e selecione "Internet Protocol Version 4(TCP/IPv4)". Digite o endereço IP do Pi em`Preferred DNS`servidor.

    -   <i>IPv6 (necessário para`DoH`&`DoT`para trabalhar mais tarde no guia se estiver usando IPv6 em seu roteador)</i>

        Vá para "Protocolo de Internet Versão 6 (TCP/IPv6)" Digite`::1`

`OPTIONAL:`<i>Você pode adicionar um DNS de backup nos campos alternativos</i>

`BE AWARE:`<i>No Android, adicionar um DNS público no segundo campo interrompe o bloqueio de anúncios do AdGuard</i>

<p align="center">
 <img src="https://i.imgur.com/8gsDk3z.jpg">

## Configurando a lista de bloqueio do AdGuard

Na página inicial do AdGuard em filtros, selecione a seção de lista de bloqueio de DNS para adicionar URLs.

<p align="center">
 <img src="https://i.imgur.com/shrtJLD.png">

Minha lista de bloqueio, por exemplo[<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/main/My-Blocklist.txt"><b>Clique aqui</b></a>]

**_Fontes de listas de bloqueio finais_**:</br><a href="https://github.com/T145/black-mirror"><img src="https://raw.githubusercontent.com/T145/black-mirror/master/.github/images/logo.png" width=220px height=60px></a>  
<a href="https://github.com/T145/black-mirror"><b>espelho preto</b></a>-_Listas negras de hosts maliciosos mantidas automaticamente e listas brancas de falsos positivos_</br>👊 MUITO OBRIGADO 👊 a<a href="https://github.com/T145"><b>T 145</b></a>

`IMPORTANT:`Algumas listas de bloqueio podem bloquear alguns conteúdos ou sites importantes. Para desbloquear vá na seção "Query Log" e verá_desbloquear_opção quando o cursor passa sobre uma consulta, colocando sites desbloqueados no exemplo de "Regras de filtragem personalizadas":`@@||bitly.com^$important`. Procure pelo IP e horário do cliente.

## Adicionar/remover vários URLs

Você só pode adicionar um por um URL na lista de bloqueio de DNS com o AdGuard por enquanto, mas há um script python para adicionar vários URLs de uma só vez.

Abra um novo arquivo py (bulkurls.py):

    nano bulkurls.py

Em seguida, copie e cole as configurações de script[<a href="https://raw.githubusercontent.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/main/bulkurls.py"><b>Clique aqui</b></a>]. Definir`your AdGuard credentials`e salve (control+x então y então enter).

_Se estiver usando**DietPi**instalar`sudo apt-get install python3-pip -y && pip install requests`por não instalar por padrão._

Para correr :`sudo python3 bulkurls.py`

Para**remover**você precisa mudar`add`dentro<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/62ba01ed8ed3a5bc5294b9fe7ee38c3e83ae1b86/bulkurls.py#L150"><b>segundo da última linha</b></a>para`remove`no arquivo bulkurls.py.

Vamos para<https://d3ward.github.io/toolz/adblock.html>para testar se os anúncios estão bloqueando<img src="https://i.imgur.com/Q5oO9EY.png" width=100px height=80px>

**[⬆ Voltar ao conteúdo ⬆](#table-of-contents)**

# 

# <i>Instalar não vinculado</b></i>

Execute o seguinte comando no seu terminal:

    sudo apt install unbound -y

Para consultar recursivamente um host que não está armazenado em cache como um endereço, o resolvedor precisa iniciar no topo da árvore do servidor e consultar os servidores raiz, para saber onde ir para o domínio de nível superior do endereço que está sendo consultado. Unbound vem com dicas internas padrão.

    wget -O root.hints https://www.internic.net/domain/named.root && sudo mv root.hints /var/lib/unbound/

`IMPORTANT:`Isso precisa ser atualizado a cada 6 meses. Para_**atualização automática**_root.hints a cada 6 meses você precisa criar um cron job.

Entre na linha de comando`crontab -e`, ele pedirá para selecionar um editor (escolha 1) e cole essas linhas na parte inferior do crontab e salve (control+x então y e digite):

    1 0 1 */6 * wget -O root.hints https://www.internic.net/domain/named.root
    2 0 1 */6 * sudo mv root.hints /var/lib/unbound/

_Se estiver usando**DietPi**você precisa instalar o resolvconf e reiniciar o unbound-resolvconf.service para definir o servidor de nomes não vinculado como 127.0.0.1 :_

    sudo apt-get install resolvconf -y && sudo systemctl restart unbound-resolvconf.service

<p align="center">
 <img src="https://i.imgur.com/26ro62t.jpg">

**[⬆ Voltar ao conteúdo ⬆](#table-of-contents)**

# 

# <i>Instalar Cloudflare</b></i>

## Configuração para Cloudflared`(DoH)`

[<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/wiki/Install-Cloudflared-service-with-DNS-over-HTTPS-proxy"><b>Clique aqui</b></a>]</h4>

## Configurar Cloudflare`(DoT)`em Não consolidado

Crie um arquivo de configuração não vinculado digitando no prompt de comando:

    sudo nano /etc/unbound/unbound.conf.d/unbound.conf

E copie e cole todo o texto deste arquivo unbound.conf[<a href="https://raw.githubusercontent.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/main/unbound.conf"><b>Clique aqui</b></a>]e salve (control+x então y então enter).

## Configurar Stubby para Unbound

Use Unbound para armazenamento em cache e stubby como um encaminhador TLS. Instale atarracado:

    sudo apt install stubby -y

Remova e recrie o arquivo stubby.yaml:

    cd /etc/stubby/ && sudo rm stubby.yml && sudo nano stubby.yml

E copie e cole todo o texto deste arquivo de configuração atarracado[<a href="https://raw.githubusercontent.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/main/stubby.yml"><b>Clique aqui</b></a>]e salve. (`cd`para retornar à pasta inicial quando terminar).

Reinicie unbound & stubby e verifique o status:

    sudo systemctl restart unbound stubby ; systemctl status unbound stubby -l

<p align="center">
 <img src="https://i.imgur.com/7zIpWP2.jpg" width=650px height=370px>

## Configure o AdGuard com`Cloudflare(DoH&DoT)`

-   Na página inicial do AdGuard, em configurações, selecione "Configurações de DNS"

-   Exclua tudo das opções de servidor "Upstream" e "Bootstrap DNS" e digite:

    -   Por`DNS over TLS(DoT)`adicionar`127.0.0.1:53`nos campos de servidor "Upstream" e "Bootstrap DNS"
    -   Por`DNS over HTTPS(DoH)`adicionar`127.0.0.1:5053`nos campos de servidor "Upstream" e "Bootstrap DNS"
    -   Por`TLS forwarder(stubby)`adicionar`127.0.0.1:8053`nos campos de servidor "Upstream" e "Bootstrap DNS"

-   `IMPORTANT:`Você precisa verificar "<a href="https://adguard.com/en/blog/in-depth-review-adguard-home.html#dns"><b>Solicitação paralela</b></a>" para que os resolvedores de DNS funcionem simultaneamente.

<p align="center">
 <img src="https://i.imgur.com/Ug4Euou.jpg" width=650px height=370px>

-   Em seguida, na configuração de DNS, procure a seção de configuração de cache DNS e defina o tamanho do cache para`0`(o armazenamento em cache já é tratado pelo Unbound) e clique em aplicar.

<p align="center">
 <img src="https://i.imgur.com/8Q5Zb0M.jpg" width=650px height=370px>
 
<b>Click apply and test upstreams</b>(might get a error in the first testing only).

#### `IMPORTANT:`O sistema Windows e os navegadores Android precisam de alguns ajustes para`stabilize`Resolvedores de DNS..Linux funciona bem<i>(testado em hortelã)</i>

### janelas

-   Instale o Proxy DNS Acrílico:<https://mayakron.altervista.org/support/acrylic/Home.htm>

-   Vamos para`C:\Program Files (x86)\Acrylic DNS Proxy`e abra`AcrylicConfiguration.ini`Arquivo. Apague tudo e copie essas configurações[<a href="https://raw.githubusercontent.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/main/AcrylicConfiguration.ini"><b>Clique aqui</b></a>], apenas altere_**Endereço do servidor primário**_para o endereço do seu Pi.

-   Na mesma pasta execute`RestartAcrylicService.bat`&`PurgeAcrylicCacheData.bat`

    `TIP:`Solucionar problemas de comandos IP/DNS

        ipconfig /release
        ipconfig /renew
        ipconfig /flushdns

### Android

-   Em qualquer navegador que você usa, ligue**fora**`Use Secure DNS`opção.
-   Esteja ciente de que os conflitos podem ocorrer com roms e kernels com root personalizados com ajustes de DNS build.prop ou aplicativos/módulo Magisk.

#### _É isso_. Agora vá para<https://1.1.1.1/help>no navegador e você deve ver essas opções como saída 'Sim'.

-   [x] Conectado a 1.1.1.1
-   [x] DNS sobre HTTPS (DoH)
-   [x] DNS sobre TLS (DoT)
-   [ ] DNS sobre WARP
    <p align="center">
     <img src="https://i.imgur.com/2S3IH5H.jpg" width=650px height=370px>

#### Outros sites para verificar a segurança

<https://browserleaks.com/dns>- deve mostrar todos conectados ao "Cloudflare"

<https://www.cloudflare.com/ssl/encrypted-sni/>- "Secure DNS / DNSSEC / TLS 1.3" deve estar com um visto verde

<https://dnssec.vs.uni-due.de/>- deve dizer "Sim, seu resolvedor de DNS valida assinaturas DNSSEC"

**[⬆ Voltar ao conteúdo ⬆](#table-of-contents)**

# 

# <i>Instalar o WireGuard</b></i>

**Antes de instalar o WireGuard**, se você não tiver um<a href="https://www.google.com/search?client=firefox-b-d&q=static+IP"><b>I.P. estático</b></a>você precisa obter gratuitamente`Dynamic DNS Subdomain`ou então seu endereço IP externo muda dinamicamente do seu ISP, então você precisará configurar um serviço DNS dinâmico[**<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/wiki/Create-a-Dynamic-DNS-Hostname-Service"><b>Clique aqui</b></a>**]. Ou então pule a etapa.

Você também precisa configurar<a href="https://www.google.com/search?q=What+is+port+forwarding+used+for%3F&client=firefox-b-d&sxsrf=APq-WBuwPqGlPJ6N9_l6qpQ3e5sYoUxZAQ%3A1650219365125&ei=ZVlcYo6sB6SGwbkP8tGOwA8&ved=0ahUKEwjO8ryY2pv3AhUkQzABHfKoA_gQ4dUDCA0&uact=5&oq=What+is+port+forwarding+used+for%3F&gs_lcp=Cgdnd3Mtd2l6EAMyBggAEBYQHjoHCAAQRxCwAzoHCAAQsAMQQ0oECEEYAEoECEYYAFDMAVjMAWCBBWgBcAF4AIABbIgBbJIBAzAuMZgBAKABAqABAcgBCsABAQ&sclient=gws-wiz"><b>encaminhamento de porta</b></a>no seu roteador para que você possa acessar a rede WireGuard em qualquer lugar, como um hotspot de uma cafeteria e até mesmo de tethering de dados móveis.
TIPO | VALOR  
------------ \| -------------
Dispositivo | Nome de host ou IP do Raspberry Pi
Protocolo | UDP
Faixa de portas | 51820-51820
Porto de saída | 51820
Permitir acesso à Internet (se tiver) | sim

Configuração da porta do meu 👇roteador👇. O seu pode ser diferente, mas você vai conseguir. Lembre-se de que o 🔍mecanismo de pesquisa🔎 do Google é seu amigo. Se você não conseguir se conectar de uma rede externa, o que significa que o ISP bloqueou as conexões de saída, você pode ligar para eles e pedir gentilmente para fazê-lo funcionar.

<p align="center">
 <img src="https://i.imgur.com/9LBEk1i.jpg">

* * *

👊MUITO OBRIGADO👊 por este script de instalação de<a href="https://github.com/Nyr/wireguard-install"><b>Nova</b></a>. Siga para se manter atualizado.

Executar no terminal

    wget https://git.io/wireguard -O wireguard-install.sh && sudo bash wireguard-install.sh

-   O script solicitará IPv4/nome de host público para a VPN._Se_você tem IP estático, então continue ou digite o domínio DNS dinâmico que você criou a partir do<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/wiki/Create-a-Dynamic-DNS-Hostname-Service"><b>instruções</b></a>. Por exemplo: trinibvpn.freeddns.org

-   Para opção de porta`press enter`para o padrão 51820. Para o nome do cliente, basta colocar o nome que quiser, e para o DNS use a opção 3 (`1.1.1.1`) por enquanto. Você vai configurar`AdGuard/Unbound/Cloudflare`com a VPN após sua instalação concluída.

<p align="center">
 <img src="https://i.imgur.com/WUNZIK4.jpg">

-   Aguarde até que a instalação termine e o código QR apareça, não feche. Mas se você fizer isso, para`regenerate qrcode`, digite no terminal, mas substituindo apenas o nome`yourclientname.conf`arquivo para o seu:


    sudo cp /root/yourclientname.conf /home/pi && sudo qrencode -t ansiutf8 < yourclientname.conf

`IMPORTANT:`Você precisará adicionar um novo usuário/cliente para cada dispositivo usado com a VPN. Para adicionar um novo usuário, basta executar novamente o script e criar um usuário com um nome de cliente diferente.

<b>Usar_OpenVPN_</b>[<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/wiki/Install-OpenVPN"><b>Clique aqui</b></a>]

# 

### Conectando VPN ao telefone Android/IOS

Instale o aplicativo WireGuard do Google Play ou App Store:

WireGuard (Google Play):<https://play.google.com/store/apps/details?id=com.wireguard.android>

WireGuard (App Store):<https://apps.apple.com/us/app/wireguard/id1441195209>

Você precisa digitalizar o código QR mostrado no terminal com o aplicativo WireGuard, selecione o`+ button`e use a opção`Scan from QR code`para instalar a configuração.

`IMPORTANT`: Habilitar**back-end do módulo do kernel**nas configurações

<p align="left">
 <img src="https://i.imgur.com/R4qbiOQ.jpg" width=250px height=350px>

### Conectando VPN ao Windows

WireGuard para janelas:<https://download.wireguard.com/windows-client/wireguard-installer.exe>

-   Criar uma`new text document`com qualquer nome no PV para copiar e colar o texto do arquivo de configuração do cliente WireGuard.

-   Para ver o texto no arquivo de configuração do cliente, digite terminal:


    sudo cat /root/yourclientname.conf

-   Realce todo o texto, copie e cole no arquivo txt no PC e salve. Em seguida, renomeie a extensão de`txt`para`conf`. Agora você tem o arquivo de configuração para esse cliente WireGuard.

-   Agora você pode importar o arquivo de configuração para o WireGuard (opção importar do arquivo).

## Configure o WireGuard com`Adguard/Unbound/Cloudflare`

_Lembre-se que isso é para quando você estiver conectado ao WireGuard VPN em uma rede externa ou em casa 24 horas por dia, 7 dias por semana, porque você já tem o AdGuard/Unbound/Cloudflare configurado e em execução em seus dispositivos manualmente._(não há problema em ter ambos configurados para minha experiência)

-   No aplicativo WireGuard, selecione seu túnel e selecione editar (lápis no canto superior direito)

-   Em servidores DNS, insira`Pi's IP`e salve (IPv4 e IPv6)

<p align="center">
 <img src="https://i.imgur.com/UC0vWfE.jpg" width=450px height=500px>  

### Limitar o tráfego

Com o WireGuard, você perderá cerca de 50% da velocidade da internet, pois o processo de encapsulamento do Pi para o roteador para os dispositivos\*\*

Excluir nos IPs permitidos a opção "0.0.0.0/0, ::/0" porque ela roteia todo o tráfego para sua rede doméstica, o que será lento. Você precisa enviar tráfego apenas através de seus endereços.

-   Primeiro você precisa substituí-lo pelo seu gateway de rede, mas definindo o último número como zero e<a href="https://www.google.com/search?q=prefix+length+explained&client=firefox-b-d&sxsrf=ALeKk036Jc9vJl73zVXf0yyZs5UlKRlNRQ%3A1621083125589&ei=9cOfYI66I5-qwbkPkdWxkAk&oq=prefix+length+explained&gs_lcp=Cgdnd3Mtd2l6EAMyBggAEAcQHjoHCCMQsAMQJzoHCAAQRxCwA1CUJ1iUJ2CiKmgBcAJ4AIABsAGIAdQCkgEDMC4ymAEAoAEBqgEHZ3dzLXdpesgBCcABAQ&sclient=gws-wiz&ved=0ahUKEwjOiOie3cvwAhUfVTABHZFqDJIQ4dUDCA0&uact=5"><b>comprimento do prefixo</b></a>a 24. Por exemplo:`192.168.1.1/24`para`192.168.1.0/24`ou como meu roteador ISP`192.168.100.1/24`para`192.168.100.0/24`.~~**Agora eu só perco 25% de velocidade**😁 (PS. usando rede 5g)~~

`UPDATE:`Após uma atualização do WireGuard, não consigo uma velocidade mais rápida fazendo isso😞 .. mas ainda faz sentido_não_usar`"0.0.0.0/0, ::/0`com Wi-Fi. Se alguém souber de algum ajuste para obter um impulso, me avise.

<p align="center">
 <img src="https://i.imgur.com/x4m6Pbl.jpg" width=450px height=500px>

### POR FAVOR LEIA !! , ESTAR CIENTE !!

`IMPORTANT`:_Se sua rede possui endereços IP para dispositivos que terminam com um número de 3 dígitos (mais de 24), por exemplo: 192.168.100.`254`, você não poderá rotear corretamente a partir da rede externa porque a aplicação de 24 permite apenas os números de 1 a 24. Em vez disso, você precisa colocar`0`para rotear fora do intervalo 24, por exemplo:`192.168.100.0/0`_.

Ou você pode alterar o intervalo de IP no seu roteador (na minha experiência, você pode obter velocidades um pouco melhores porque ele não roteará endereços IP permitidos desnecessários no intervalo de 24).

<p align="center">
 <img src="https://i.imgur.com/ZZ4aMUI.jpg" width=750px height=550px>

## Ипвш

Se você estiver usando IPv6, quando estiver conectado ao WiFi, precisará inserir os IPs permitidos do WireGuard`fe80::1/0`também. Por exemplo`192.168.100.0/0, fe80::1/0`

Quando conectado ao cabo Ethernet em um PC com Windows, você precisa inserir`::1`no endereço IPv6 no servidor DNS preferencial "Internet Protocol Version 6(TCP/IPv6)".

Então vá para<https://ipv6leak.com/>e você deve ver "_Seu IPv6 não está vazando_".

# 

## Desabilitar todos os IPv6

#### Desative o IPv6 se você não tiver ou não quiser[<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/wiki/Disable-all-IPv6"><b>Clique aqui</b></a>]. Como resultado, se você tiver uma internet fraca, desabilitar o IPv6 pode acelerar a solicitação de dns, mas terá menos segurança.

# 

## Testar VPN

Como você sabe se o WireGuard VPN está realmente funcionando?

Por**janelas**Baixe o Wireshark:<https://www.wireshark.org/#download>

Uma vez baixado, você pode usar o aplicativo para inspecionar seus pacotes de dados onde o protocolo está definido para o usado pelo WireGuard VPN. Quando um tráfego de pacotes é`encrypted`, pode ser lido assim, por exemplo:

<p align="center">
 <img src="https://i.imgur.com/Tn4M47R.jpg">

Por**andróide**você pode usar o PCAPdroid:<https://play.google.com/store/apps/details?id=com.emanuelef.remote_capture&hl=en&gl=US>

Você deve ver todas as conexões`closed`e status mostrando todas as conexões DNS e não todas as conexões TLS em todos os aplicativos. (abra e use aplicativos para PCAPdroid para escanear)

**[⬆ Voltar ao conteúdo ⬆](#table-of-contents)**

* * *

<b>QUALQUER PROBLEMA, CORREÇÃO OU DICAS PARA MELHORAR ESSES PROJETOS, CONTRIBUA 🤖</b>

<p align="center">
<img src="https://user-images.githubusercontent.com/73097560/115834477-dbab4500-a447-11eb-908a-139a6edaec5c.gif"
<br> 
<br> 
<br> 

<p align="center">
 <img src="https://i.imgur.com/Q07E7SW.gif" width=500px height=30px>

<p align="center">
<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/stargazers"><img src="https://reporoster.com/stars/dark/trinib/AdGuard-WireGuard-Unbound-Cloudflare"></a>

<p align="center">
<img src="https://user-images.githubusercontent.com/73097560/115834477-dbab4500-a447-11eb-908a-139a6edaec5c.gif"</p>

# 

## _Recursos do Repositório_

<h5 https://www.raspberrypi.com/documentation/

<https://github.com/AdguardTeam/AdGuardHome/wiki/Getting-Started>

<https://developers.cloudflare.com/>

<https://docs.pi-hole.net/guides/dns/cloudflared/>

<https://docs.pi-hole.net/guides/dns/unbound/>

<https://nlnetlabs.nl/documentation/unbound/unbound.conf/>

<https://dnsprivacy.org/dns_privacy_clients/>

<https://github.com/anudeepND/pihole-unbound>

<https://github.com/stong/unbound.conf.d>

<https://github.com/Nyr/wireguard-install>

<https://github.com/T145/black-mirror>
