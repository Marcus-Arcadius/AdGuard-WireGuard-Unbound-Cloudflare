# ![logo](https://i.imgur.com/zqJELkl.png)

<p align="center">
 <img src="https://img.shields.io/badge/License-MIT-blue.svg">
 <img src="https://badges.frapsoft.com/os/v3/open-source.svg?v=103">
 <img src="http://ForTheBadge.com/images/badges/built-with-love.svg">
 <img src="https://img.shields.io/badge/badges-awesome-green.svg">
 <img src="https://img.shields.io/badge/Stay-Safe-red?logo=data:image/svg%2bxml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgNTEwIDUxMCIgaGVpZ2h0PSI1MTIiIHZpZXdCb3g9IjAgMCA1MTAgNTEwIiB3aWR0aD0iNTEyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxnPjxnPjxwYXRoIGQ9Im0xNzQuNjEgMzAwYy0yMC41OCAwLTQwLjU2IDYuOTUtNTYuNjkgMTkuNzJsLTExMC4wOSA4NS43OTd2MTA0LjQ4M2g1My41MjlsNzYuNDcxLTY1aDEyNi44MnYtMTQ1eiIgZmlsbD0iI2ZmZGRjZSIvPjwvZz48cGF0aCBkPSJtNTAyLjE3IDI4NC43MmMwIDguOTUtMy42IDE3Ljg5LTEwLjc4IDI0LjQ2bC0xNDguNTYgMTM1LjgyaC03OC4xOHYtODVoNjguMThsMTE0LjM0LTEwMC4yMWMxMi44Mi0xMS4yMyAzMi4wNi0xMC45MiA0NC41LjczIDcgNi41NSAxMC41IDE1LjM4IDEwLjUgMjQuMnoiIGZpbGw9IiNmZmNjYmQiLz48cGF0aCBkPSJtMzMyLjgzIDM0OS42M3YxMC4zN2gtNjguMTh2LTYwaDE4LjU1YzI3LjQxIDAgNDkuNjMgMjIuMjIgNDkuNjMgNDkuNjN6IiBmaWxsPSIjZmZjY2JkIi8+PHBhdGggZD0ibTM5OS44IDc3LjN2OC4wMWMwIDIwLjY1LTguMDQgNDAuMDctMjIuNjQgNTQuNjdsLTExMi41MSAxMTIuNTF2LTIyNi42NmwzLjE4LTMuMTljMTQuNi0xNC42IDM0LjAyLTIyLjY0IDU0LjY3LTIyLjY0IDQyLjYyIDAgNzcuMyAzNC42OCA3Ny4zIDc3LjN6IiBmaWxsPSIjZDAwMDUwIi8+PHBhdGggZD0ibTI2NC42NSAyNS44M3YyMjYuNjZsLTExMi41MS0xMTIuNTFjLTE0LjYtMTQuNi0yMi42NC0zNC4wMi0yMi42NC01NC42N3YtOC4wMWMwLTQyLjYyIDM0LjY4LTc3LjMgNzcuMy03Ny4zIDIwLjY1IDAgNDAuMDYgOC4wNCA1NC42NiAyMi42NHoiIGZpbGw9IiNmZjRhNGEiLz48cGF0aCBkPSJtMjEyLjgzIDM2MC4xMnYzMGg1MS44MnYtMzB6IiBmaWxsPSIjZmZjY2JkIi8+PHBhdGggZD0ibTI2NC42NSAzNjAuMTJ2MzBoMzYuMTRsMzIuMDQtMzB6IiBmaWxsPSIjZmZiZGE5Ii8+PC9nPjwvc3ZnPg==">

</p>
 <p align="center">
     <a href="https://img.shields.io/github/stars/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=FFD700&style=for-the-badge" alt="GitHub Repo stars">
         <img src="https://img.shields.io/github/stars/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=FFD700&style=for-the-badge"></a>
     <a href="https://img.shields.io/github/forks/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=00a671&style=for-the-badge" alt="GitHub forks">
         <img src="https://img.shields.io/github/forks/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=00a671&style=for-the-badge"></a>
     <a href="https://img.shields.io/github/watchers/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=9700b2&style=for-the-badge" alt="GitHub watchers">
         <img src="https://img.shields.io/github/watchers/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=9700b2&style=for-the-badge"></a>
</p>

<h2><p align="center">
<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.zh-CN.md"><b>🇨🇳</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.es.md"><b>🇪🇸</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.ru.md"><b>🇷🇺</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.hi.md"><b>🇮🇳</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.fr.md"><b>🇫🇷</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.it.md"><b>🇮🇹</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.de.md"><b>🇩🇪</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.ar.md"><b>🇦🇪</b></a></h2>

<p align="center"><img src="https://raw.githubusercontent.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/main/assets/images/awcu.gif" width= "700">

# 

## Caratteristiche

#### _<a href="https://github.com/AdguardTeam/AdGuardHome/blob/master/README.md"><b>AdGuard Casa</b></a>_: Blocca gli annunci su tutti i tuoi dispositivi(<a href="https://github.com/AdguardTeam/AdGuardHome/blob/master/README.md#how-does-adguard-home-compare-to-pi-hole"><b>_rispetto a Pi-Hole_</b></a>)

#### _<a href="https://www.wireguard.com/"><b>WireGuard</b></a>_: Server VPN a casa accessibile da qualsiasi rete esterna (IPv4 e IPv6)

#### <a href="https://www.nlnetlabs.nl/projects/unbound/about/"><b><i>Non vincolato</i></b></a>insieme a[<i>Tozzo</i>](https://dnsprivacy.org/dns_privacy_daemon_-_stubby/about_stubby/): un risolutore DNS di convalida, ricorsivo e di memorizzazione nella cache

#### _<a href="https://www.cloudflare.com/learning/what-is-cloudflare/"><b>Cloudflare</b></a>_: Prestazioni e sicurezza migliori durante la navigazione nei siti Web (DoT e DoH)

<p align="right">
<i>All software are free, open-source and&nbsp;self-hosted&nbsp;</i></br><a href="https://git.io/About"><b>About</b></a> | <a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/discussions/17"><b>F.A.Q</b></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

* * *

### Velocità di query DNS con<a href="https://docs.oracle.com/en-us/iaas/Content/DNS/Tasks/testingdnsusingdig.htm"><b>Strumento di scavo di BIND</b></a>🧪

<b>Risultati da google.com in millisecondi:</b>

-   Risolutori DNS predefiniti di AdGuard -`60-70 msec`
-   Risolutori DNS Cloudflare/Quad9/Google pubblici -`50-70 msec`
-   Questa impostazione/configurazione -`5-10 msec`

<details><summary><b>Preview🎥<img src="https://media.giphy.com/media/WT5h7PgVSScLLKtMaS/giphy.gif" width=50px height=40px></b></summary>
<p>

DNS predefinito di AdGuard<b><i>contro</i></b>questa configurazione⭐ :

<https://user-images.githubusercontent.com/18756975/150230438-b767e86f-4e18-4791-b5fe-0813615a37a3.mp4>

Risolutori DNS pubblici Cloudflare/Quad9/Google:

<https://user-images.githubusercontent.com/18756975/150319049-3d8acdc9-624f-4b60-8ee2-b80227522252.mp4>

</p>
</details>

* * *

### Ultimo controllo⏰ : 17 aprile 2022</h2>

<div align="center">

|                             Progetti                             |                           Stato                           |
| :--------------------------------------------------------------: | :-------------------------------------------------------: |
|                           AdGuard Casa                           |                             ✅                             |
|                           Non vincolato                          |                             ✅                             |
|                            Cloudflare                            |                             ✅                             |
|                               Tozzo                              |                             ✅                             |
|                             WireGuard                            |                             ✅                             |

</div>

# Sommario

-   [Requisiti](#requirements)
-   [Installa il sistema operativo Raspberry Pi](#install-raspberry-pi-os)<img src="https://www.vectorlogo.zone/logos/raspberrypi/raspberrypi-icon.svg" width=20px height=20px>
    -   [Accedi a Pi OS con SSH](#access-pi-os-with-ssh)
-   [Installa AdGuard Home](#install-adguard-home)<img src="https://www.vectorlogo.zone/logos/adguard/adguard-icon.svg" width=20px height=20px>
    -   [Configura i tuoi dispositivi per funzionare con Adguard](#set-up-your-devices-to-work-with-adguard)
    -   [Impostazione della blocklist di AdGuard](#setting-up-adguard-blocklist)
        -   [Aggiungi/Rimuovi più URL](#addremove-multiple-urls)
-   [Installa Unbound](#install-unbound)<img src="https://www.privacytools.io/img/apps/unbound.svg" width=20px height=20px>
-   [Installa Cloudflare](#install-cloudflare)<img src="https://www.vectorlogo.zone/logos/cloudflare/cloudflare-icon.svg" width=20px height=20px>
    -   [Configurazione per Cloudflared (DoH)](#setup-for-cloudflared-doh)
    -   [Configura Cloudflare (DoT) su Unbound](#configure-cloudflare-dot-on-unbound)
        -   [Configura Stubby per Non vincolato](#configure-stubby-for-unbound)
        -   [Configura AdGuard con Cloudflare (DoH&DoT)](#configure-adguard-with-cloudflaredohdot)
-   [Installa WireGuard](#install-wireguard)<img src="https://www.vectorlogo.zone/logos/wireguard/wireguard-icon.svg" width=20px height=20px>o<a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/OpenVPN-Setup.md">OpenVPN (più lento)</a><img src="https://i.imgur.com/Agstbe5.png" width=20px height=20px>
-   [Connessione VPN al telefono Android/IOS](#connecting-vpn-to-androidios-phone)
-   [Connessione VPN a Windows](#connecting-vpn-to-windows)
-   [Configura Wireguard con AdGuard/Unbound/Cloudflare](#configure-wireguard-with-adguardunboundcloudflare)
    -   [Limita il traffico](#limit-traffic)
    -   [Ипвш](#ipv6)
    -   [Disabilita tutti gli IPv6](#disable-all-ipv6)
-   [Prova VPN](#test-vpn)<img src="https://i.imgur.com/6Yf8Zra.png" width=20px height=20px>
-   [Auto update Pi](#auto-update-pi)
-   [Installa Log2ram](#install-log2ram)
-   [Spegni i LED Pi](#turn-off-pi-led-lights)
-   [Proteggi il tuo Raspberry Pi](#secure-your-raspberry-pi)
-   [Risorse del repository](#repository-resources)

# 

# Requisiti

Questo tutorial è basato su Raspberry Pi, ma puoi usare qualsiasi Linux<a href="https://github.com/thibmaek/awesome-raspberry-pi#os-images"><b>sistema operativo</b></a><i>(po)</i>, qualsiasi hardware o a<a href="https://www.google.com/search?q=What+is+a+VPS+used+for%3F&client=firefox-b-d&biw=1280&bih=582&sxsrf=APq-WBu-yng0bW9IWwNKsQhD6h1ZmRGncw%3A1650151372793&ei=zE9bYpL1L_OOwbkPgZ6DGA&ved=0ahUKEwiSi5rz3Jn3AhVzRzABHQHPAAMQ4dUDCA0&uact=5&oq=What+is+a+VPS+used+for%3F&gs_lcp=Cgdnd3Mtd2l6EAMyBAgAEA0yBAgAEA0yBAgAEA0yBAgAEA0yBggAEA0QHjIGCAAQFhAeMgYIABAWEB4yCAgAEAgQDRAeMggIABAIEA0QHjIICAAQCBANEB46BwgAEEcQsANKBAhBGABKBAhGGABQ8AFY8AFg_ANoAXABeACAAXCIAXCSAQMwLjGYAQCgAQKgAQHIAQjAAQE&sclient=gws-wiz"><b>VPS</b></a>.</br>(Raspberry Pi OS è il più semplice e consigliato per Pi o per utenti più esperti,<b>DietPi</b>Si consiglia anche il sistema operativo)

-   Una versione Raspberry Pi 3 o 4
-   Un router che supporta il port forwarding (Most Can)
-   Lettore di schede USB MicroSD
-   Scheda MicroSD (8 GB o superiore, almeno Classe 4)
-   cavo Ethernet
-   (Opzionale se si utilizza il monitor) MicroHDMI-(RPi 4) o HDMI-(RPi 3)

# 

# <i>Installa il sistema operativo Raspberry Pi</b></i>

Raspberry Pi OS è disponibile nelle versioni desktop e lite (usa lite per<a href="https://www.google.com/search?q=What+is+a+headless+operating+system%3F&client=firefox-b-d&sxsrf=APq-WBvlqMZasn_klYxS5HZmhKQlduKYuQ%3A1650123816301&ei=KORaYtz7EYOdwbkP74G16AE&ved=0ahUKEwjcr5-f9pj3AhWDTjABHe9ADR0Q4dUDCA0&uact=5&oq=What+is+a+headless+operating+system%3F&gs_lcp=Cgdnd3Mtd2l6EAMyCAghEBYQHRAeOgcIABBHELADSgQIQRgASgQIRhgAUMEBWMEBYNAEaAFwAXgAgAFqiAFqkgEDMC4xmAEAoAECoAEByAEIwAEB&sclient=gws-wiz"><b>senza testa</b></a>modalità). Puoi accedere a un Raspberry Pi con un monitor/tastiera/mouse o connetterti tramite<a href="https://www.google.com/search?q=linux+ssh+&client=firefox-b-d&sxsrf=APq-WBve72uwEMMqUAe77nZoaygcx-ROMg%3A1650123667623&ei=k-NaYtbfJbmvwbkPpf6nqAQ&ved=0ahUKEwiW9azY9Zj3AhW5VzABHSX_CUUQ4dUDCA0&uact=5&oq=linux+ssh+&gs_lcp=Cgdnd3Mtd2l6EAMyBAgjECcyBQgAEIAEMgUIABCRAjIFCAAQkQIyBQgAEIAEMgUIABCABDIFCAAQkQIyBQgAEIAEMgUIABCABDIFCAAQgAQ6BwgAEEcQsANKBAhBGABKBAhGGABQuAFY0AJg1AZoAXABeACAAXaIAeIBkgEDMC4ymAEAoAEByAEIwAEB&sclient=gws-wiz"><b>ssh</b></a>da un terminale.

Installa balenEtcher e scarica l'immagine Pi da scrivere sulla scheda microSD.

-   Scarica il sistema operativo Raspberry Pi:<https://www.raspberrypi.org/software/operating-systems/>

-   Download balenaEtcher:<https://www.balena.io/etcher/>

Dopo che hai`Etcher`installato e`Raspberry Pi OS`file scaricato, ora puoi inserire la scheda SD con lettore di schede USB microSD nel tuo computer.

-   Avvia Etcher e scegli l'immagine del sistema operativo Raspberry Pi che hai scaricato, seleziona la tua scheda microSD e fai clic`Flash`.

Al termine del flashing, cerca in "Questo PC" il nome del disco "avvio o unità USB" (ricollega il lettore di schede USB se non viene visualizzato). Vai su quel disco, crea un nuovo file di testo chiamato**_`ssh without 'txt' extension`_**. Disattiva "Nascondi estensioni per tipi di file conosciuti" nelle opzioni di Esplora file se non lo vedi.

<p align="center">
 <img src="https://i.imgur.com/eV6uMbz.jpg">

<i>Inserisci la scheda SD nel Raspberry Pi, collega il cavo Ethernet e avvia</i>

## Accedi a Pi OS con SSH

-   Attendi un minuto per il primo avvio di Pi

-   Apri il browser e accedi alla pagina del pannello del tuo router

-   Trova l'elenco di tutti i dispositivi collegati alla tua rete e copia l'indirizzo IP del Raspberry Pi (molto probabilmente avrà il nome host`raspberrypi`)

-   Apri il terminale sul tuo computer host. Puoi usare powerShell su Windows o RaspController per Android.

Digita il seguente comando:

    ssh pi@pi's IP address

<i>È possibile utilizzare il pulsante destro del mouse per incollare il testo in Windows PowerShell</i>.

Digita "yes" per la domanda sull'impronta digitale e digita "raspberry" per la password predefinita (le password saranno invisibili nella riga di comando). Puoi digitare**_`sudo passwd pi`_**per cambiare la password dopo.

<p align="center">
 <img src="https://i.imgur.com/Wf30jxG.jpg">

Esegui nel terminale:

    sudo apt update -y && sudo apt upgrade -y

__Riavvia al termine__

    sudo reboot

**[⬆ Torna ai contenuti ⬆](#table-of-contents)**

# 

# <i>Installa AdGuard Home</b></i>

Questo script di installazione proviene da<a href="https://github.com/AdguardTeam/AdGuardHome/blob/master/README.md"><b>AdGuard Casa</b></a>progetto principale. Segui per restare aggiornato.

Esegui il seguente comando nel tuo terminale:

    curl -s -S -L https://raw.githubusercontent.com/AdguardTeam/AdGuardHome/master/scripts/install.sh | sh -s -- -v

-   Al termine dell'installazione, verrà visualizzata una finestra nella visualizzazione del terminale`links`alla tua home page di AdGuard (Inizia)

-   `IMPORTANT:`Nell'opzione Ascolta interfacce scegli`Eth0`e seleziona Avanti

    <p align="center">
     <img src="https://i.imgur.com/Wa00lDp.jpg" width=580px height=690px>

-   Imposta nome utente e password e accedi al pannello di amministrazione

-   `IMPORTANT:`Nelle impostazioni generali, imposta "Conservazione registri query" su`24 hours`. (Ho letto che per alcune persone i registri si riempiono il che rallenta Pi e necessita di un riavvio)

## Configura i tuoi dispositivi per funzionare con AdGuard

-   Per Android/Apple, vai su Impostazioni avanzate Wi-Fi e seleziona l'opzione statica. In`DNS 1`campo inserire l'indirizzo "Pi's IP".

    <p align="center">
     <img src="https://i.imgur.com/nxpiqDw.jpg" width=450px height=580px>

-   Per PC/Finestre

    -   <i>Ипвч</i>

        Vai alle impostazioni di rete/modifica le opzioni dell'adattatore e fai clic con il pulsante destro del mouse nelle proprietà, quindi seleziona "Protocollo Internet versione 4 (TCP/IPv4)". Inserisci l'indirizzo IP di Pi in`Preferred DNS`server.

    -   <i>IPv6 (necessario per`DoH`&`DoT`per lavorare in seguito nella guida se si utilizza IPv6 sul router)</i>

        Vai a "Protocollo Internet versione 6 (TCP/IPv6)" Invio`::1`

`OPTIONAL:`<i>Puoi aggiungere un DNS di backup nei campi alternativi</i>

`BE AWARE:`<i>In Android, l'aggiunta di un DNS pubblico nel secondo campo interrompe il blocco degli annunci di AdGuard</i>

<p align="center">
 <img src="https://i.imgur.com/8gsDk3z.jpg">

## Impostazione della blocklist di AdGuard

Nella home page di AdGuard, sotto i filtri, seleziona la sezione DNS blocklist per aggiungere gli URL.

<p align="center">
 <img src="https://i.imgur.com/shrtJLD.png">

Puoi cercare su Google diverse blocklist. Ecco la mia blocklist personalizzata per esempio[<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/main/My-Blocklist.txt"><b>clicca qui</b></a>]. Costruisci il tuo da un elenco di principali fonti di blocklist che ho raccolto[<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/main/%F0%9F%A7%B1Blocklist-Sources%E2%84%B9%EF%B8%8F"><b>clicca qui</b></a>]. Oppure controlla:</br><a href="https://github.com/T145/black-mirror"><b>Specchio nero</b></a>-_**_Blacklist di host dannosi gestite automaticamente e whitelist di falsi positivi_**_</br>👊GRANDE GRAZIE👊a<a href="https://github.com/T145"><b>T 145</b></a>

`IMPORTANT:`Alcuni elenchi di blocco possono bloccare alcuni contenuti o siti Web importanti. Per sbloccare vai nella sezione "Registro query" e vedrai_sbloccare_opzione quando il cursore viene posizionato su una query, inserendo i siti Web sbloccati nell'esempio "Regole di filtro personalizzate":`@@||bitly.com^$important`. Cerca l'IP e l'ora del client.

## Aggiungi/Rimuovi più URL

Per ora puoi aggiungere solo uno per uno URL nella blocklist DNS con AdGuard, ma esiste uno script Python per aggiungere più URL contemporaneamente.

Apri il nuovo file py (bulkurls.py):

    nano bulkurls.py

Quindi copia e incolla le configurazioni degli script[<a href="https://raw.githubusercontent.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/main/bulkurls.py"><b>clicca qui</b></a>]. Impostare`your AdGuard credentials`e salva (Ctrl+x poi y poi invio).

_Se si utilizza**DietPi**installare`sudo apt-get install python3-pip -y && pip install requests`per la sua non installazione di default._

Correre :`sudo python3 bulkurls.py`

A**rimuovere**devi cambiare`add`in<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/62ba01ed8ed3a5bc5294b9fe7ee38c3e83ae1b86/bulkurls.py#L150"><b>penultima riga</b></a>a`remove`nel file bulkurls.py.

Vai a<https://d3ward.github.io/toolz/adblock.html>per verificare se gli annunci stanno bloccando<img src="https://i.imgur.com/Q5oO9EY.png" width=100px height=80px>

**[⬆ Torna ai contenuti ⬆](#table-of-contents)**

# 

# <i>Installa Unbound</b></i>

Esegui il seguente comando nel tuo terminale:

    sudo apt install unbound -y

Per eseguire query ricorsive su un host che non è memorizzato nella cache come indirizzo, il risolutore deve iniziare dalla parte superiore dell'albero dei server e interrogare i server radice, per sapere dove andare per il dominio di primo livello per l'indirizzo richiesto. Unbound viene fornito con suggerimenti predefiniti predefiniti.

    wget -O root.hints https://www.internic.net/domain/named.root && sudo mv root.hints /var/lib/unbound/

`IMPORTANT:`Questo deve essere aggiornato ogni 6 mesi. A_**auto update**_root.hints ogni 6 mesi devi creare un cron job.

Entra nella riga di comando`crontab -e`, chiederà di selezionare un editor (scegli 1) e incollare queste righe nella parte inferiore di crontab e salvare (control+x poi y poi invio):

    1 0 1 */6 * wget -O root.hints https://www.internic.net/domain/named.root
    2 0 1 */6 * sudo mv root.hints /var/lib/unbound/

_Se si utilizza**DietPi**è necessario installare resolvconf e riavviare unbound-resolvconf.service per impostare il server dei nomi non associato su 127.0.0.1 :_

    sudo apt-get install resolvconf -y && sudo systemctl restart unbound-resolvconf.service

<p align="center">
 <img src="https://i.imgur.com/26ro62t.jpg">

**[⬆ Torna ai contenuti ⬆](#table-of-contents)**

# 

# <i>Installa Cloudflare</b></i>

## Configurazione per Cloudflared`(DoH)`

[<a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/Cloudflare-DoH-Setup.md"><b>clicca qui</b></a>]</h4>

## Configura Cloudflare`(DoT)`su Libero

Crea un file di configurazione non associato inserendo nel prompt dei comandi:

    sudo nano /etc/unbound/unbound.conf.d/unbound.conf

E copia e incolla tutto il testo da questo file unbound.conf[<a href="https://raw.githubusercontent.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/main/unbound.conf"><b>clicca qui</b></a>]e salva (Ctrl+x poi y poi invio).

## Configura Stubby per Non vincolato

Usa Unbound per la memorizzazione nella cache e stubby come inoltro TLS. Installa stubby:

    sudo apt install stubby -y

Rimuovere e ricreare il file stubby.yaml:

    cd /etc/stubby/ && sudo rm stubby.yml && sudo nano stubby.yml

E copia e incolla tutto il testo da questo file di configurazione tozzo[<a href="https://raw.githubusercontent.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/main/stubby.yml"><b>clicca qui</b></a>]e risparmia. (`cd`per tornare alla cartella Inizio al termine).

-   Riavvia unbound & stubby e controlla lo stato:


    sudo systemctl restart unbound stubby ; systemctl status unbound stubby -l

<p align="center">
 <img src="https://i.imgur.com/7zIpWP2.jpg" width=650px height=370px>

## Configura AdGuard con`Cloudflare(DoH&DoT)`

-   Nella home page di AdGuard, sotto le impostazioni, seleziona "Impostazioni DNS"

-   Elimina tutto dalle opzioni del server "Upstream" e "Bootstrap DNS" e inserisci:

    -   Per`DNS over TLS(DoT)`Inserisci`127.0.0.1:53`in entrambi i campi del server "Upstream" e "Bootstrap DNS".
    -   Per`DNS over HTTPS(DoH)`Inserisci`127.0.0.1:5053`in entrambi i campi del server "Upstream" e "Bootstrap DNS".
    -   Per`TLS forwarder(stubby)`Inserisci`127.0.0.1:8053`in entrambi i campi del server "Upstream" e "Bootstrap DNS".

-   `IMPORTANT:`Devi controllare"<a href="https://adguard.com/en/blog/in-depth-review-adguard-home.html#dns"><b>Richiesta parallela</b></a>" opzione per il funzionamento simultaneo dei resolver DNS.

<p align="center">
 <img src="https://i.imgur.com/Ug4Euou.jpg" width=650px height=370px>

-   Quindi nelle impostazioni DNS cerca la sezione di configurazione della cache DNS e imposta la dimensione della cache su`0`(la memorizzazione nella cache è già gestita dall'Unbound) e fare clic su applica.

<p align="center">
 <img src="https://i.imgur.com/8Q5Zb0M.jpg" width=650px height=370px>
 
<b>Click apply and test upstreams</b>(might get a error in the first testing only).

#### `IMPORTANT:`Il sistema Windows e i browser Android necessitano di alcune modifiche`stabilize`Risolutori DNS..Linux funziona bene<i>(testato alla menta)</i>

### finestre

-   Installa proxy DNS acrilico:<https://mayakron.altervista.org/support/acrylic/Home.htm>

-   Vai a`C:\Program Files (x86)\Acrylic DNS Proxy`e aperto`AcrylicConfiguration.ini`file. Elimina tutto e copia queste impostazioni[<a href="https://raw.githubusercontent.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/main/AcrylicConfiguration.ini"><b>clicca qui</b></a>], cambia solo_**Indirizzi del server primario**_all'indirizzo del tuo Pi.

-   Nella stessa cartella esegui`RestartAcrylicService.bat`&`PurgeAcrylicCacheData.bat`

    `TIP:`Risoluzione dei problemi relativi ai comandi IP/DNS

        ipconfig /release
        ipconfig /renew
        ipconfig /flushdns

### Androide

-   In qualunque browser utilizzi, gira**spento**`Use Secure DNS`opzione.
-   Tieni presente che possono verificarsi conflitti con rom e kernel personalizzati con root con modifiche DNS build.prop o app/modulo Magisk.

#### _Questo è tutto_. Ora vai a<https://1.1.1.1/help>nel browser e dovresti vedere queste opzioni in uscita 'Sì'.

-   [x] Collegato a 1.1.1.1
-   [x] DNS su HTTPS (DoH)
-   [x] DNS su TLS (DoT)
-   [ ] DNS su WARP
    <p align="center">
     <img src="https://i.imgur.com/2S3IH5H.jpg" width=650px height=370px>

#### Altri siti per verificare la sicurezza

<https://browserleaks.com/dns>- dovrebbe mostrare tutto connesso a "Cloudflare"

<https://www.cloudflare.com/ssl/encrypted-sni/>- "Secure DNS / DNSSEC / TLS 1.3" dovrebbe essere tutto un segno di spunta verde

<https://dnssec.vs.uni-due.de/>- dovrebbe dire "Sì, il tuo risolutore DNS convalida le firme DNSSEC"

**[⬆ Torna ai contenuti ⬆](#table-of-contents)**

# 

# <i>Installa WireGuard</b></i>

**Prima di installare WireGuard**, se non hai a<a href="https://www.google.com/search?client=firefox-b-d&q=static+IP"><b>IP statico</b></a>devi ottenere un omaggio`Dynamic DNS Subdomain`oppure il tuo indirizzo IP esterno cambia dinamicamente dal tuo ISP, quindi dovrai configurare un servizio DNS dinamico[**<a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/Dns-Service-Guide.md"><b>clicca qui</b></a>**]. Oppure salta il passaggio.

Devi anche configurare<a href="https://www.google.com/search?q=What+is+port+forwarding+used+for%3F&client=firefox-b-d&sxsrf=APq-WBuwPqGlPJ6N9_l6qpQ3e5sYoUxZAQ%3A1650219365125&ei=ZVlcYo6sB6SGwbkP8tGOwA8&ved=0ahUKEwjO8ryY2pv3AhUkQzABHfKoA_gQ4dUDCA0&uact=5&oq=What+is+port+forwarding+used+for%3F&gs_lcp=Cgdnd3Mtd2l6EAMyBggAEBYQHjoHCAAQRxCwAzoHCAAQsAMQQ0oECEEYAEoECEYYAFDMAVjMAWCBBWgBcAF4AIABbIgBbJIBAzAuMZgBAKABAqABAcgBCsABAQ&sclient=gws-wiz"><b>Port forwarding</b></a>sul tuo router in modo da poter accedere a WireGuard al di fuori della nostra rete come in un hotspot di un bar o ai tuoi dati mobili.
TIPO | VALORE  
------------ \| -------------
Dispositivo | Nome host o IP di Raspberry Pi
protocollo | UDP
Intervallo di porte | 51820-51820
Porto in uscita | 51820
Consenti l'accesso a Internet (se disponibile) | sì

Impostazione della mia porta 👇router👇. Il tuo forse è diverso ma lo capirai. Ricorda che Google 🔍motore di ricerca🔎 è tuo amico. Se non riesci a connetterti da una rete esterna, significa che l'ISP ha bloccato le connessioni in uscita, puoi chiamarli e chiedere gentilmente di farlo funzionare.

<p align="center">
 <img src="https://i.imgur.com/9LBEk1i.jpg">

* * *

👊GRANDE GRAZIE👊 per questo script di installazione da<a href="https://github.com/Nyr/wireguard-install"><b>Nyr</b></a>. Segui per restare aggiornato.

Esegui nel terminale

    wget https://git.io/wireguard -O wireguard-install.sh && sudo bash wireguard-install.sh

-   Lo script ti chiederà IPv4/nome host pubblico per la VPN._Se_hai un IP statico, quindi continua oppure digita il dominio DNS dinamico che hai creato da<a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/Dns-Service-Guide.md"><b>Istruzioni</b></a>. Ad esempio: trinibvpn.freeddns.org

-   Per opzione porta`press enter`per default 51820. Per il nome del client, inserisci il nome che desideri e per il DNS usa l'opzione 3 (`1.1.1.1`) per adesso. Tu configurerai`AdGuard/Unbound/Cloudflare`con la VPN al termine dell'installazione.

<p align="center">
 <img src="https://i.imgur.com/WUNZIK4.jpg">

-   Attendi fino al termine dell'installazione e alla visualizzazione del codice QR, non chiudere. Ma se lo fai, a`regenerate qrcode`, inserisci nel terminale ma sostituendo solo il nome`yourclientname.conf`file al tuo:


    sudo cp /root/yourclientname.conf /home/pi && sudo qrencode -t ansiutf8 < yourclientname.conf

`IMPORTANT:`Dovrai aggiungere un nuovo utente/client per ogni dispositivo che utilizzi con la VPN. Per aggiungere un nuovo utente, riesegui semplicemente lo script e crea un utente con un nome client diverso.

<b>Utilizzo_Apri VPN_</b>[<a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/OpenVPN-Setup.md"><b>clicca qui</b></a>]

# 

### Connessione VPN al telefono Android/IOS

Installa l'app WireGuard da Google Play o App Store:

WireGuard (Google Play):<https://play.google.com/store/apps/details?id=com.wireguard.android>

WireGuard (App Store):<https://apps.apple.com/us/app/wireguard/id1441195209>

È necessario scansionare il codice QR mostrato nel terminale con l'app WireGuard, selezionare il`+ button`e usa l'opzione`Scan from QR code`per installare la configurazione.

`IMPORTANT`: Abilitare**back-end del modulo del kernel**nelle impostazioni

<p align="left">
 <img src="https://i.imgur.com/R4qbiOQ.jpg" width=250px height=350px>

### Connessione VPN a Windows

WireGuard per Windows:<https://download.wireguard.com/windows-client/wireguard-installer.exe>

-   Creare un`new text document`con qualsiasi nome su PV per copiare e incollare il testo dal file di configurazione del client WireGuard.

-   Per vedere il testo nel file di configurazione del client, digita nel terminale:


    sudo cat /root/yourclientname.conf

-   Evidenzia tutto il testo, copialo e incollalo nel file txt su PC e salva. Quindi rinomina l'estensione da`txt`a`conf`. Ora hai il file di configurazione per quel client WireGuard.

-   Ora puoi importare il file di configurazione su WireGuard (opzione importa da file).

## Configura WireGuard con`Adguard/Unbound/Cloudflare`

_Ricorda che questo è per quando sei connesso a WireGuard VPN su una rete esterna o a casa 24 ore su 24, 7 giorni su 7, perché hai già AdGuard/Unbound/Cloudflare configurato e in esecuzione manualmente sui tuoi dispositivi._(nessun problema con entrambi impostati per la mia esperienza)

-   Nell'app WireGuard, seleziona il tuo tunnel e seleziona Modifica (matita in alto a destra)

-   In Server DNS accedi`Pi's IP`e salva (IPv4 e IPv6)

<p align="center">
 <img src="https://i.imgur.com/UC0vWfE.jpg" width=450px height=500px>  

### Limita il traffico

Con WireGuard perderai circa il 50% della velocità di Internet causando il processo di tunneling tramite Pi al router verso i dispositivi\*\*

Elimina l'opzione "0.0.0.0/0, ::/0" degli IP consentiti perché instrada tutto il traffico alla rete domestica che sarà lenta. Devi inviare traffico solo attraverso i tuoi indirizzi.

-   Per prima cosa devi sostituirlo con il tuo gateway di rete ma impostando l'ultimo numero su zero e<a href="https://www.google.com/search?q=prefix+length+explained&client=firefox-b-d&sxsrf=ALeKk036Jc9vJl73zVXf0yyZs5UlKRlNRQ%3A1621083125589&ei=9cOfYI66I5-qwbkPkdWxkAk&oq=prefix+length+explained&gs_lcp=Cgdnd3Mtd2l6EAMyBggAEAcQHjoHCCMQsAMQJzoHCAAQRxCwA1CUJ1iUJ2CiKmgBcAJ4AIABsAGIAdQCkgEDMC4ymAEAoAEBqgEHZ3dzLXdpesgBCcABAQ&sclient=gws-wiz&ved=0ahUKEwjOiOie3cvwAhUfVTABHZFqDJIQ4dUDCA0&uact=5"><b>lunghezza del prefisso</b></a>a 24. Ad esempio:`192.168.1.1/24`a`192.168.1.0/24`o come il mio router ISP`192.168.100.1/24`a`192.168.100.0/24`.~~**Ora perdo solo il 25% di velocità**😁 (PS. utilizzando la rete 5g)~~

`UPDATE:`Dopo un aggiornamento di WireGuard non ottengo una velocità maggiore in questo modo😞 .. ma ha comunque senso_non_usare`"0.0.0.0/0, ::/0`con Wi-Fi. Se qualcuno conosce qualche ritocco per ottenere una spinta, me lo faccia sapere.

<p align="center">
 <img src="https://i.imgur.com/x4m6Pbl.jpg" width=450px height=500px>

### SI PREGA DI LEGGERE !! , ATTENZIONE!!

`IMPORTANT`:_Se la tua rete ha indirizzi IP per dispositivi che terminano con un numero di 3 cifre (più di 24), ad esempio: 192.168.100.`254`, non sarai in grado di instradare correttamente dalla rete esterna perché l'applicazione di 24 consente solo i numeri da 1 a 24. Devi invece inserire`0`per instradare fuori dall'intervallo 24, ad esempio:`192.168.100.0/0`_.

Oppure puoi cambiare l'intervallo IP sul tuo router (secondo la mia esperienza potresti ottenere velocità leggermente migliori perché non instraderà indirizzi IP consentiti non necessari nell'intervallo 24).

<p align="center">
 <img src="https://i.imgur.com/ZZ4aMUI.jpg" width=750px height=550px>

## Ипвш

Se stai usando IPv6, quando sei connesso al WiFi devi inserire gli IP consentiti da WireGuard`fe80::1/0`anche. Per esempio`192.168.100.0/0, fe80::1/0`

Quando si è collegati al cavo Ethernet su un PC Windows, è necessario accedere`::1`nell'indirizzo IPv6 nel server DNS preferito "Protocollo Internet versione 6(TCP/IPv6)".

Allora vai a<https://ipv6leak.com/>e dovresti vedere "_Il tuo IPv6 non perde_".

# 

## Disabilita tutti gli IPv6

#### Disabilita IPv6 se non lo hai o non lo vuoi[<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/main/Disable-All-IPv6.md"><b>clicca qui</b></a>]. Di conseguenza, se hai una connessione Internet debole, la disabilitazione di IPv6 può accelerare la richiesta DNS ma avere meno sicurezza.

# 

## Prova VPN

Come fai a sapere se WireGuard VPN funziona davvero?

Per**finestre**scarica Wireshark:<https://www.wireshark.org/#download>

Una volta scaricato, puoi utilizzare l'applicazione per ispezionare i tuoi pacchetti di dati in cui il protocollo è impostato su quello utilizzato da WireGuard VPN. Quando un traffico a pacchetto è`encrypted`, può essere letto in questo modo ad esempio:

<p align="center">
 <img src="https://i.imgur.com/Tn4M47R.jpg">

Per**androide**puoi usare PCAPdroid:<https://play.google.com/store/apps/details?id=com.emanuelef.remote_capture&hl=en&gl=US>

Dovresti vedere tutte le connessioni`closed`e lo stato che mostra tutti i DNS e non le connessioni TLS in tutte le app. (apri e usa le app per la scansione di PCAPdroid)

**[⬆ Torna ai contenuti ⬆](#table-of-contents)**

* * *

# 

# <i>Auto Update Pi</b></i>

Apri il nuovo file sh chiamato update e copia incolla lo script[<a href="https://raw.githubusercontent.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/main/update.sh"><b>clicca qui</b></a>]

    sudo nano update.sh

Imposta il permesso

    sudo chmod 700 update.sh

Apri il file cron inserendo nella riga di comando`crontab -e`, copia incolla la riga di comando del lavoro in basso nella parte inferiore del file cron e salva.

    0 3 * * WED sudo ./update.sh 2>&1 >/home/pi/updatelog

Pi ora si aggiornerà ogni mercoledì alle 3 del mattino. Oppure puoi andare a<https://crontab.guru/>e imposta il tuo programma orario.

Regola la data/il fuso orario di Pi e inserisci nel terminale:

    sudo dpkg-reconfigure tzdata

o impostare manualmente

    sudo date -s "25 DEC 2012 11:14:00"

# 

# <i>Installa Log2Ram</b></i>

Uno dei vantaggi più significativi dell'offload della RAM è che migliora il tuo**Durata potenziale della scheda SD**.
I file di registro sono una delle cose scritte di più dai vari software che installi.
Inserendo i file nella RAM, puoi controllare la frequenza con cui vengono scritti sulla scheda SD. Sarai comunque in grado di accedere a questi file sulla RAM come se si trovassero sulla tua scheda SD.

Copia e incolla questa riga nel terminale:

Manualmente

    wget https://git.io/log2ram -O Log2Ram-Script.sh && sudo chmod +x Log2Ram-Script.sh && sudo ./Log2Ram-Script.sh

o

Aggiungi sorgente repository (aggiornamento automatico)

    echo "deb [signed-by=/usr/share/keyrings/azlux-archive-keyring.gpg] http://packages.azlux.fr/debian/ bullseye main" | sudo tee /etc/apt/sources.list.d/azlux.list
    sudo wget -O /usr/share/keyrings/azlux-archive-keyring.gpg  https://azlux.fr/repo.gpg
    sudo apt update
    sudo apt install log2ram

# 

# <i>Spegni le luci LED Pi</b></i>

Immagino che l'alimentazione dei LED influirà sull'elettricità e sul calore non necessari 🤷😅. Non ce n'è bisogno comunque se lo usi solo come server di rete. Apri il file cron inserendo nella riga di comando`crontab -e`, copia incolla la riga di comando del lavoro in basso nella parte inferiore del file cron e salva.

Verde

    @reboot echo none | sudo tee /sys/class/leds/led0/trigger

Rosso

    @reboot echo none | sudo tee /sys/class/leds/led1/trigger

Riavvia Pi.

# 

# <i>Proteggi il tuo Raspberry Pi</b></i>

<p align="center">
<a href="https://gist.github.com/boseji/c9e91ff3bd0b3cfb62a5e260fe505374"><img src="https://i.imgur.com/a9JQVls.png" width=80px height=90px></a>

[<a href="https://gist.github.com/boseji/c9e91ff3bd0b3cfb62a5e260fe505374"><b>clicca qui</b></a>]

<i>(Uso solo Fail2Ban e cambio la porta SSH)</i>

**[⬆ Torna ai contenuti ⬆](#table-of-contents)**

* * *

<b>QUALSIASI PROBLEMA, RIPARAZIONE O CONSIGLIO PER MIGLIORARE QUESTI PROGETTI SI PREGA DI CONTRIBUIRE🤖</b>

* * *

<p align="center">
<img src="https://user-images.githubusercontent.com/73097560/115834477-dbab4500-a447-11eb-908a-139a6edaec5c.gif"
<br> 
<br> 
<br> 

<p align="center">
 <img src="https://i.imgur.com/Q07E7SW.gif" width=500px height=30px>

<p align="center">
<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/stargazers"><img src="https://reporoster.com/stars/dark/trinib/AdGuard-WireGuard-Unbound-Cloudflare"></a>

<p align="center">
<img src="https://user-images.githubusercontent.com/73097560/115834477-dbab4500-a447-11eb-908a-139a6edaec5c.gif"</p>

# 

## _Risorse del repository_

<h5 https://www.raspberrypi.com/documentation/

<https://github.com/AdguardTeam/AdGuardHome/wiki/Getting-Started>

<https://developers.cloudflare.com/>

<https://docs.pi-hole.net/guides/dns/cloudflared/>

<https://docs.pi-hole.net/guides/dns/unbound/>

<https://nlnetlabs.nl/documentation/unbound/unbound.conf/>

<https://dnsprivacy.org/dns_privacy_clients/>

<https://github.com/anudeepND/pihole-unbound>

<https://github.com/stong/unbound.conf.d>

<https://github.com/Nyr/wireguard-install>

<https://github.com/azlux/log2ram>

<https://github.com/T145/black-mirror>

* * *
