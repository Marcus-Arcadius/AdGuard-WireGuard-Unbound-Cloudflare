# ![logo](https://i.imgur.com/zqJELkl.png)

<p align="center">
 <img src="https://img.shields.io/badge/License-MIT-blue.svg">
 <img src="https://badges.frapsoft.com/os/v3/open-source.svg?v=103">
 <img src="http://ForTheBadge.com/images/badges/built-with-love.svg">
 <img src="https://img.shields.io/badge/badges-awesome-green.svg">
 <img src="https://img.shields.io/badge/Stay-Safe-red?logo=data:image/svg%2bxml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgNTEwIDUxMCIgaGVpZ2h0PSI1MTIiIHZpZXdCb3g9IjAgMCA1MTAgNTEwIiB3aWR0aD0iNTEyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxnPjxnPjxwYXRoIGQ9Im0xNzQuNjEgMzAwYy0yMC41OCAwLTQwLjU2IDYuOTUtNTYuNjkgMTkuNzJsLTExMC4wOSA4NS43OTd2MTA0LjQ4M2g1My41MjlsNzYuNDcxLTY1aDEyNi44MnYtMTQ1eiIgZmlsbD0iI2ZmZGRjZSIvPjwvZz48cGF0aCBkPSJtNTAyLjE3IDI4NC43MmMwIDguOTUtMy42IDE3Ljg5LTEwLjc4IDI0LjQ2bC0xNDguNTYgMTM1LjgyaC03OC4xOHYtODVoNjguMThsMTE0LjM0LTEwMC4yMWMxMi44Mi0xMS4yMyAzMi4wNi0xMC45MiA0NC41LjczIDcgNi41NSAxMC41IDE1LjM4IDEwLjUgMjQuMnoiIGZpbGw9IiNmZmNjYmQiLz48cGF0aCBkPSJtMzMyLjgzIDM0OS42M3YxMC4zN2gtNjguMTh2LTYwaDE4LjU1YzI3LjQxIDAgNDkuNjMgMjIuMjIgNDkuNjMgNDkuNjN6IiBmaWxsPSIjZmZjY2JkIi8+PHBhdGggZD0ibTM5OS44IDc3LjN2OC4wMWMwIDIwLjY1LTguMDQgNDAuMDctMjIuNjQgNTQuNjdsLTExMi41MSAxMTIuNTF2LTIyNi42NmwzLjE4LTMuMTljMTQuNi0xNC42IDM0LjAyLTIyLjY0IDU0LjY3LTIyLjY0IDQyLjYyIDAgNzcuMyAzNC42OCA3Ny4zIDc3LjN6IiBmaWxsPSIjZDAwMDUwIi8+PHBhdGggZD0ibTI2NC42NSAyNS44M3YyMjYuNjZsLTExMi41MS0xMTIuNTFjLTE0LjYtMTQuNi0yMi42NC0zNC4wMi0yMi42NC01NC42N3YtOC4wMWMwLTQyLjYyIDM0LjY4LTc3LjMgNzcuMy03Ny4zIDIwLjY1IDAgNDAuMDYgOC4wNCA1NC42NiAyMi42NHoiIGZpbGw9IiNmZjRhNGEiLz48cGF0aCBkPSJtMjEyLjgzIDM2MC4xMnYzMGg1MS44MnYtMzB6IiBmaWxsPSIjZmZjY2JkIi8+PHBhdGggZD0ibTI2NC42NSAzNjAuMTJ2MzBoMzYuMTRsMzIuMDQtMzB6IiBmaWxsPSIjZmZiZGE5Ii8+PC9nPjwvc3ZnPg==">

</p>
 <p align="center">
     <a href="https://img.shields.io/github/stars/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=FFD700&style=for-the-badge" alt="GitHub Repo stars">
         <img src="https://img.shields.io/github/stars/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=FFD700&style=for-the-badge"></a>
     <a href="https://img.shields.io/github/forks/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=00a671&style=for-the-badge" alt="GitHub forks">
         <img src="https://img.shields.io/github/forks/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=00a671&style=for-the-badge"></a>
     <a href="https://img.shields.io/github/watchers/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=9700b2&style=for-the-badge" alt="GitHub watchers">
         <img src="https://img.shields.io/github/watchers/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=9700b2&style=for-the-badge"></a>
</p>

<h2><p align="center">
<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.zh-CN.md"><b>🇨🇳</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.es.md"><b>🇪🇸</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.ru.md"><b>🇷🇺</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.hi.md"><b>🇮🇳</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.fr.md"><b>🇫🇷</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.it.md"><b>🇮🇹</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.de.md"><b>🇩🇪</b></a>&nbsp;<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/lang/README.ar.md"><b>🇦🇪</b></a></h2>

<p align="center"><img src="https://raw.githubusercontent.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/main/assets/images/awcu.gif" width= "700">

# 

## Características

#### _<a href="https://github.com/AdguardTeam/AdGuardHome/blob/master/README.md"><b>Inicio de AdGuard</b></a>_: Bloquee anuncios en todos sus dispositivos(<a href="https://github.com/AdguardTeam/AdGuardHome/blob/master/README.md#how-does-adguard-home-compare-to-pi-hole"><b>_en comparación con Pi-Hole_</b></a>)

#### _<a href="https://www.wireguard.com/"><b>Guardia de alambre</b></a>_: servidor VPN en casa accesible desde cualquier red externa (IPv4 e IPv6)

#### <a href="https://www.nlnetlabs.nl/projects/unbound/about/"><b><i>Sin consolidar</i></b></a>con[<i>Achaparrado</i>](https://dnsprivacy.org/dns_privacy_daemon_-_stubby/about_stubby/): Un solucionador de DNS validador, recursivo y de almacenamiento en caché

#### _<a href="https://www.cloudflare.com/learning/what-is-cloudflare/"><b>Llamarada de nube</b></a>_: Mejor rendimiento y seguridad al navegar por sitios web (DoT y DoH)

<i>Todo el software es gratuito, de código abierto y alojado en sí mismo </i></br><a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/wiki/About"><b>Acerca de</b></a>\|<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/discussions/17"><b>Preguntas más frecuentes</b></a>\|<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/wiki"><b>wiki</b></a>                         

# 

### Velocidad de consulta de DNS con<a href="https://docs.oracle.com/en-us/iaas/Content/DNS/Tasks/testingdnsusingdig.htm"><b>Herramienta de excavación BIND</b></a>🧪

<b>Resultados de google.com en milisegundos:</b>

-   Resolutores de DNS predeterminados de AdGuard:`60-70 msec`
-   Solucionadores de DNS públicos de Cloudflare/Quad9/Google -`50-70 msec`
-   Esta instalación/configuración -`5-10 msec`

<details><summary><b>Preview🎥<img src="https://media.giphy.com/media/WT5h7PgVSScLLKtMaS/giphy.gif" width=50px height=40px></b></summary>
<p>

DNS predeterminado de AdGuard<b><i>contra</i></b>esta configuración⭐:

<https://user-images.githubusercontent.com/18756975/150230438-b767e86f-4e18-4791-b5fe-0813615a37a3.mp4>

Solucionadores de DNS públicos de Cloudflare/Quad9/Google:

<https://user-images.githubusercontent.com/18756975/150319049-3d8acdc9-624f-4b60-8ee2-b80227522252.mp4>

</p>
</details>

# 

### Última comprobación⏰: 17 de abril de 2022</h2>

<div align="center">

|                             Proyectos                             |                           Estado                           |
| :---------------------------------------------------------------: | :--------------------------------------------------------: |
|                         Inicio de AdGuard                         |                              ✅                             |
|                           Sin consolidar                          |                              ✅                             |
|                         Llamarada de nube                         |                              ✅                             |
|                            Achaparrado                            |                              ✅                             |
|                         Guardia de alambre                        |                              ✅                             |

</div>

# Tabla de contenido

-   [Requisitos](#requirements)
-   [Instalar el sistema operativo Raspberry Pi](#install-raspberry-pi-os)<img src="https://www.vectorlogo.zone/logos/raspberrypi/raspberrypi-icon.svg" width=20px height=20px>
    -   [Acceda a Pi OS con SSH](#access-pi-os-with-ssh)
-   [Instalar AdGuard Inicio](#install-adguard-home)<img src="https://www.vectorlogo.zone/logos/adguard/adguard-icon.svg" width=20px height=20px>
    -   [Configura tus dispositivos para que funcionen con Adguard](#set-up-your-devices-to-work-with-adguard)
    -   [Configuración de la lista de bloqueo de AdGuard](#setting-up-adguard-blocklist)
        -   [Agregar/eliminar varias URL](#addremove-multiple-urls)
-   [Instalar sin consolidar](#install-unbound)<img src="https://www.privacytools.io/img/apps/unbound.svg" width=20px height=20px>
-   [Instalar Cloudflare](#install-cloudflare)<img src="https://www.vectorlogo.zone/logos/cloudflare/cloudflare-icon.svg" width=20px height=20px>
    -   [Configuración para Cloudflared (DoH)](#setup-for-cloudflared-doh)
    -   [Configurar Cloudflare (DoT) en Unbound](#configure-cloudflare-dot-on-unbound)
        -   [Configurar Stubby para Sin consolidar](#configure-stubby-for-unbound)
        -   [Configurar AdGuard con Cloudflare (DoH&DoT)](#configure-adguard-with-cloudflaredohdot)
-   [Instalar WireGuard](#install-wireguard)<img src="https://www.vectorlogo.zone/logos/wireguard/wireguard-icon.svg" width=20px height=20px>o<a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/OpenVPN-Setup.md">OpenVPN (más lento)</a><img src="https://i.imgur.com/Agstbe5.png" width=20px height=20px>
-   [Conexión de VPN a un teléfono Android/IOS](#connecting-vpn-to-androidios-phone)
-   [Conexión de VPN a Windows](#connecting-vpn-to-windows)
-   [Configurar Wireguard con AdGuard/Unbound/Cloudflare](#configure-wireguard-with-adguardunboundcloudflare)
    -   [Limitar el tráfico](#limit-traffic)
    -   [Ипвш](#ipv6)
    -   [Deshabilitar todo IPv6](#disable-all-ipv6)
-   [VPN de prueba](#test-vpn)<img src="https://i.imgur.com/6Yf8Zra.png" width=20px height=20px>
-   [Recursos del repositorio](#repository-resources)

# 

# Requisitos

Este tutorial está basado en Raspberry Pi, pero puedes usar cualquier Linux<a href="https://github.com/thibmaek/awesome-raspberry-pi#os-images"><b>Sistema operativo</b></a><i>(poco)</i>, cualquier hardware o un<a href="https://www.google.com/search?q=What+is+a+VPS+used+for%3F&client=firefox-b-d&biw=1280&bih=582&sxsrf=APq-WBu-yng0bW9IWwNKsQhD6h1ZmRGncw%3A1650151372793&ei=zE9bYpL1L_OOwbkPgZ6DGA&ved=0ahUKEwiSi5rz3Jn3AhVzRzABHQHPAAMQ4dUDCA0&uact=5&oq=What+is+a+VPS+used+for%3F&gs_lcp=Cgdnd3Mtd2l6EAMyBAgAEA0yBAgAEA0yBAgAEA0yBAgAEA0yBggAEA0QHjIGCAAQFhAeMgYIABAWEB4yCAgAEAgQDRAeMggIABAIEA0QHjIICAAQCBANEB46BwgAEEcQsANKBAhBGABKBAhGGABQ8AFY8AFg_ANoAXABeACAAXCIAXCSAQMwLjGYAQCgAQKgAQHIAQjAAQE&sclient=gws-wiz"><b>VPS</b></a>.</br>(Raspberry Pi OS es más simple y recomendado para Pi o para usuarios con más experiencia,<b>DietPi</b>También se recomienda el sistema operativo)

-   Una versión Raspberry Pi 3 o 4
-   Un enrutador que admita el reenvío de puertos (Most Can)
-   Lector de tarjetas microSD USB
-   Tarjeta MicroSD (8 GB o más, al menos Clase 4)
-   Cable de ethernet
-   (Opcional si usa un monitor) MicroHDMI-(RPi 4) o HDMI-(RPi 3)

# 

# <i>Instalar el sistema operativo Raspberry Pi</b></i>

Raspberry Pi OS viene en versiones de escritorio y lite (use lite para<a href="https://www.google.com/search?q=What+is+a+headless+operating+system%3F&client=firefox-b-d&sxsrf=APq-WBvlqMZasn_klYxS5HZmhKQlduKYuQ%3A1650123816301&ei=KORaYtz7EYOdwbkP74G16AE&ved=0ahUKEwjcr5-f9pj3AhWDTjABHe9ADR0Q4dUDCA0&uact=5&oq=What+is+a+headless+operating+system%3F&gs_lcp=Cgdnd3Mtd2l6EAMyCAghEBYQHRAeOgcIABBHELADSgQIQRgASgQIRhgAUMEBWMEBYNAEaAFwAXgAgAFqiAFqkgEDMC4xmAEAoAECoAEByAEIwAEB&sclient=gws-wiz"><b>sin cabeza</b></a>modo). Puede acceder a una Raspberry Pi con un monitor/teclado/ratón o conectarse a través de<a href="https://www.google.com/search?q=What+is+SSH+in+Linux%3F&client=firefox-b-d&sxsrf=APq-WBsiHvek7g0OrBHWDbEy-x7m-B6O3Q%3A1650481751310&ei=V1pgYoHNEs-uwbkPtI25mAI&ved=0ahUKEwjB1PrTq6P3AhVPVzABHbRGDiMQ4dUDCA0&uact=5&oq=What+is+SSH+in+Linux%3F&gs_lcp=Cgdnd3Mtd2l6EAMyBggAEBYQHjIGCAAQFhAeMgYIABAWEB4yBggAEBYQHjIGCAAQFhAeMgYIABAWEB4yBggAEBYQHjIGCAAQFhAeMgYIABAWEB4yBggAEBYQHjoHCCMQsAMQJzoHCAAQRxCwAzoHCAAQsAMQQzoKCAAQ5AIQsAMYAToPCC4Q1AIQyAMQsAMQQxgCSgQIQRgASgQIRhgBUM8IWM8IYJAMaAFwAXgAgAFxiAFxkgEDMC4xmAEAoAECoAEByAERwAEB2gEGCAEQARgJ2gEGCAIQARgI&sclient=gws-wiz"><b>ssh</b></a>desde una terminal.

Instale balenEtcher y descargue la imagen Pi para escribir en la tarjeta microSD.

-   Descarga el sistema operativo Raspberry Pi:<https://www.raspberrypi.org/software/operating-systems/>

-   Descargar balenaEtcher:<https://www.balena.io/etcher/>

después de que tengas`Etcher`instalado y`Raspberry Pi OS`archivo descargado, ahora puede insertar la tarjeta SD con lector de tarjetas microSD USB en su computadora.

-   Inicie Etcher y elija la imagen del sistema operativo Raspberry Pi que descargó, seleccione su tarjeta microSD y haga clic en`Flash`.

Después de flashear, busque en "Esta PC" un nombre de disco "arranque o unidad USB" (vuelva a conectar el lector de tarjetas USB si no se ve). Vaya a ese disco, cree un nuevo archivo de texto llamado**_`ssh without 'txt' extension`_**. Deshabilite "Ocultar extensiones para tipos de archivo conocidos" en las opciones del explorador de archivos si no lo ve.

<p align="center">
 <img src="https://i.imgur.com/eV6uMbz.jpg">

<i>Coloque la tarjeta SD en la Raspberry Pi, conecte el cable Ethernet y arranque</i>

## Acceda a Pi OS con SSH

-   Espere un minuto para el primer arranque de Pi

-   Abra el navegador e inicie sesión en la página del panel de su enrutador

-   Encuentre la lista de todos los dispositivos conectados a su red y copie la dirección IP de Raspberry Pi (lo más probable es que tenga el nombre de host`raspberrypi`)

-   Abra la terminal en su máquina host. Puede usar powerShell en Windows o RaspController para Android.

Escribe el siguiente comando:

    ssh pi@pi's IP address

<i>Puede usar el botón derecho del mouse para pegar texto en Windows powerShell</i>.

Escriba "sí" para la pregunta de huellas dactilares y escriba "frambuesa" para la contraseña predeterminada (las contraseñas serán invisibles en la línea de comandos). puedes escribir**_`sudo passwd pi`_**para cambiar la contraseña después.

<p align="center">
 <img src="https://i.imgur.com/Wf30jxG.jpg">

Ejecutar en la terminal:

    sudo apt update -y && sudo apt upgrade -y

__Reiniciar cuando termine__

    sudo reboot

**[⬆ Volver a contenidos ⬆](#table-of-contents)**

# 

# <i>Instalar AdGuard Inicio</b></i>

Este script de instalación es de<a href="https://github.com/AdguardTeam/AdGuardHome/blob/master/README.md"><b>Inicio de AdGuard</b></a>proyecto principal Siga para mantenerse actualizado.

Ejecute el siguiente comando en su terminal:

    curl -s -S -L https://raw.githubusercontent.com/AdguardTeam/AdGuardHome/master/scripts/install.sh | sh -s -- -v

-   Cuando finalice la instalación, aparecerá una ventana emergente en la terminal que muestra`links`a su página de inicio de AdGuard (Comenzar)

-   `IMPORTANT:`En la opción Escuchar interfaces, elija`Eth0`y seleccione siguiente

    <p align="center">
     <img src="https://i.imgur.com/Wa00lDp.jpg" width=580px height=690px>

-   Configure el nombre de usuario y la contraseña e inicie sesión en el panel de administración

-   `IMPORTANT:`En la configuración general, establezca "Retención de registros de consultas" en`24 hours`. (Leí que para algunas personas los registros se llenan, lo que ralentiza Pi y necesita reiniciar)

## Configura tus dispositivos para que funcionen con AdGuard

-   Para Android/Apple, vaya a la configuración avanzada de WiFi y seleccione la opción estática. En`DNS 1`campo ingrese la dirección "IP de Pi"

    <p align="center">
     <img src="https://i.imgur.com/nxpiqDw.jpg" width=450px height=580px>

-   Para PC/Windows

    -   <i>Ипвч</i>

        Vaya a la configuración de red/cambie las opciones del adaptador y haga clic con el botón derecho en las propiedades y luego seleccione "Protocolo de Internet versión 4 (TCP/IPv4)". Introduzca la dirección IP de Pi en`Preferred DNS`servidor.

    -   <i>IPv6 (necesario para`DoH`&`DoT`para trabajar más adelante en la guía si usa IPv6 en su enrutador)</i>

        Vaya a "Protocolo de Internet versión 6 (TCP/IPv6)" Entrar`::1`

`OPTIONAL:`<i>Puede agregar un DNS de respaldo en los campos alternativos</i>

`BE AWARE:`<i>En Android, agregar un DNS público en el segundo campo interrumpe el bloqueo de anuncios de AdGuard</i>

<p align="center">
 <img src="https://i.imgur.com/8gsDk3z.jpg">

## Configuración de la lista de bloqueo de AdGuard

En la página de inicio de AdGuard en filtros, seleccione la sección de lista de bloqueo de DNS para agregar URL.

<p align="center">
 <img src="https://i.imgur.com/shrtJLD.png">

Mi lista de bloqueo por ejemplo[<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/main/My-Blocklist.txt"><b>haga clic aquí</b></a>]

**_Últimas fuentes de listas de bloqueo_**:</br><a href="https://github.com/T145/black-mirror"><img src="https://raw.githubusercontent.com/T145/black-mirror/master/.github/images/logo.png" width=220px height=60px></a>  
<a href="https://github.com/T145/black-mirror"><b>espejo negro</b></a>-_Listas negras de hosts maliciosos y listas blancas de falsos positivos mantenidas automáticamente_</br>👊MUCHAS GRACIAS👊 a<a href="https://github.com/T145"><b>T 145</b></a>

`IMPORTANT:`Algunas listas de bloqueo pueden bloquear algunos contenidos o sitios web importantes. Para desbloquear vaya a la sección "Query Log" y verá_desatascar_opción cuando el cursor se desplaza sobre una consulta, colocando los sitios web desbloqueados en el ejemplo de "Reglas de filtrado personalizadas":`@@||bitly.com^$important`. Busque la IP y la hora del cliente.

## Agregar/eliminar varias URL

Solo puede agregar una URL por una en la lista de bloqueo de DNS con AdGuard por ahora, pero hay una secuencia de comandos de Python para agregar varias URL a la vez.

Abra un nuevo archivo py (bulkurls.py):

    nano bulkurls.py

Luego copie y pegue configuraciones de script[<a href="https://raw.githubusercontent.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/main/bulkurls.py"><b>haga clic aquí</b></a>]. Colocar`your AdGuard credentials`y guarde (control+x luego y luego enter).

_si usa**DietPi**Instalar en pc`sudo apt-get install python3-pip -y && pip install requests`porque no se instala por defecto._

Correr :`sudo python3 bulkurls.py`

Para**retirar**necesitas cambiar`add`en<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/62ba01ed8ed3a5bc5294b9fe7ee38c3e83ae1b86/bulkurls.py#L150"><b>segunda de la última línea</b></a>para`remove`en el archivo bulkurls.py.

Ir a<https://d3ward.github.io/toolz/adblock.html>para probar si los anuncios están bloqueando<img src="https://i.imgur.com/Q5oO9EY.png" width=100px height=80px>

**[⬆ Volver a contenidos ⬆](#table-of-contents)**

# 

# <i>Instalar sin consolidar</b></i>

Ejecute el siguiente comando en su terminal:

    sudo apt install unbound -y

Para consultar recursivamente un host que no está almacenado en caché como una dirección, el resolutor debe comenzar en la parte superior del árbol de servidores y consultar los servidores raíz, para saber a dónde ir para el dominio de nivel superior para la dirección que se consulta. Unbound viene con sugerencias integradas predeterminadas.

    wget -O root.hints https://www.internic.net/domain/named.root && sudo mv root.hints /var/lib/unbound/

`IMPORTANT:`Esto necesita actualizarse cada 6 meses. Para_**actualización automática**_root.hints cada 6 meses necesita crear un trabajo cron.

Entrar en línea de comando`crontab -e`, le pedirá que seleccione un editor (elija 1) y pegue estas líneas en la parte inferior de crontab y guarde (control+x luego y luego ingrese):

    1 0 1 */6 * wget -O root.hints https://www.internic.net/domain/named.root
    2 0 1 */6 * sudo mv root.hints /var/lib/unbound/

_si usa**DietPi**debe instalar resolvconf y reiniciar unbound-resolvconf.service para configurar el servidor de nombres independiente en 127.0.0.1:_

    sudo apt-get install resolvconf -y && sudo systemctl restart unbound-resolvconf.service

<p align="center">
 <img src="https://i.imgur.com/26ro62t.jpg">

**[⬆ Volver a contenidos ⬆](#table-of-contents)**

# 

# <i>Instalar Cloudflare</b></i>

## Configuración de Cloudflared`(DoH)`

[<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/wiki/Install-Cloudflared-service-with-DNS-over-HTTPS-proxy"><b>haga clic aquí</b></a>]</h4>

## Configurar Cloudflare`(DoT)`en Sin consolidar

Cree un archivo de configuración independiente ingresando en el símbolo del sistema:

    sudo nano /etc/unbound/unbound.conf.d/unbound.conf

Y copie y pegue todo el texto de este archivo unbound.conf[<a href="https://raw.githubusercontent.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/main/unbound.conf"><b>haga clic aquí</b></a>]y guarde (control+x luego y luego enter).

## Configurar Stubby para Sin consolidar

Utilice Unbound para almacenamiento en caché y stubby como reenviador de TLS. Instalar rechoncho:

    sudo apt install stubby -y

Elimina y vuelve a crear el archivo stubby.yaml:

    cd /etc/stubby/ && sudo rm stubby.yml && sudo nano stubby.yml

Y copie y pegue todo el texto de este archivo de configuración rechoncho[<a href="https://raw.githubusercontent.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/main/stubby.yml"><b>haga clic aquí</b></a>]y guardar. (`cd`para volver a la carpeta de inicio cuando termine).

Reinicie sin vincular y rechoncho y verifique el estado:

    sudo systemctl restart unbound stubby ; systemctl status unbound stubby -l

<p align="center">
 <img src="https://i.imgur.com/7zIpWP2.jpg" width=650px height=370px>

## Configurar AdGuard con`Cloudflare(DoH&DoT)`

-   En la página de inicio de AdGuard, en la configuración, seleccione "Configuración de DNS"

-   Elimine todo desde las opciones de servidor "Upstream" y "Bootstrap DNS" e ingrese:

    -   Para`DNS over TLS(DoT)`agregar`127.0.0.1:53`en los campos de servidor "Upstream" y "Bootstrap DNS"
    -   Para`DNS over HTTPS(DoH)`agregar`127.0.0.1:5053`en los campos de servidor "Upstream" y "Bootstrap DNS"
    -   Para`TLS forwarder(stubby)`agregar`127.0.0.1:8053`en los campos de servidor "Upstream" y "Bootstrap DNS"

-   `IMPORTANT:`Tienes que comprobar "<a href="https://adguard.com/en/blog/in-depth-review-adguard-home.html#dns"><b>Solicitud paralela</b></a>" opción para que los resolutores de DNS funcionen simultáneamente.

<p align="center">
 <img src="https://i.imgur.com/Ug4Euou.jpg" width=650px height=370px>

-   Luego, en la configuración de DNS, busque la sección de configuración de caché de DNS y establezca el tamaño de caché en`0`(el almacenamiento en caché ya lo maneja Unbound) y haga clic en Aplicar.

<p align="center">
 <img src="https://i.imgur.com/8Q5Zb0M.jpg" width=650px height=370px>
 
<b>Click apply and test upstreams</b>(might get a error in the first testing only).

#### `IMPORTANT:`El sistema de Windows y los navegadores de Android necesitan algunos ajustes para`stabilize`Resolutores de DNS... Linux funciona bien<i>(probado en menta)</i>

### ventanas

-   Instale el proxy DNS acrílico:<https://mayakron.altervista.org/support/acrylic/Home.htm>

-   Ir a`C:\Program Files (x86)\Acrylic DNS Proxy`y abierto`AcrylicConfiguration.ini`expediente. Eliminar todo y copiar estos ajustes[<a href="https://raw.githubusercontent.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/main/AcrylicConfiguration.ini"><b>haga clic aquí</b></a>], solo cambio_**DirecciónServidorPrincipal**_a la dirección de tu Pi.

-   En la misma carpeta ejecutar`RestartAcrylicService.bat`&`PurgeAcrylicCacheData.bat`

    `TIP:`Solucionar problemas de comandos IP/DNS

        ipconfig /release
        ipconfig /renew
        ipconfig /flushdns

### Androide

-   En cualquier navegador que utilices, activa**apagado**`Use Secure DNS`opción.
-   Tenga en cuenta que pueden ocurrir conflictos con roms y núcleos rooteados personalizados con ajustes de DNS build.prop o aplicaciones/módulo Magisk.

#### _Eso es todo_. ahora ve a<https://1.1.1.1/help>en el navegador y debería ver que estas opciones dan como resultado 'Sí'.

-   [x] Conectado a 1.1.1.1
-   [x] DNS sobre HTTPS (DoH)
-   [x] DNS sobre TLS (DoT)
-   [ ] DNS sobre WARP
    <p align="center">
     <img src="https://i.imgur.com/2S3IH5H.jpg" width=650px height=370px>

#### Otros sitios para comprobar la seguridad

<https://browserleaks.com/dns>- debería mostrar todos los conectados a "Cloudflare"

<https://www.cloudflare.com/ssl/encrypted-sni/>- "Secure DNS / DNSSEC / TLS 1.3" debería ser una marca verde

<https://dnssec.vs.uni-due.de/>- debe decir "Sí, su sistema de resolución de DNS valida las firmas de DNSSEC"

**[⬆ Volver a contenidos ⬆](#table-of-contents)**

# 

# <i>Instalar WireGuard</b></i>

**Antes de instalar WireGuard**, si no tienes<a href="https://www.google.com/search?client=firefox-b-d&q=static+IP"><b>IP estática</b></a>necesitas obtener un gratis`Dynamic DNS Subdomain`o bien, su dirección IP externa cambia dinámicamente desde su ISP, por lo que deberá configurar un servicio de DNS dinámico[**<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/wiki/Create-a-Dynamic-DNS-Hostname-Service"><b>haga clic aquí</b></a>**]. O bien, omita el paso.

También necesita configurar<a href="https://www.google.com/search?q=What+is+port+forwarding+used+for%3F&client=firefox-b-d&sxsrf=APq-WBuwPqGlPJ6N9_l6qpQ3e5sYoUxZAQ%3A1650219365125&ei=ZVlcYo6sB6SGwbkP8tGOwA8&ved=0ahUKEwjO8ryY2pv3AhUkQzABHfKoA_gQ4dUDCA0&uact=5&oq=What+is+port+forwarding+used+for%3F&gs_lcp=Cgdnd3Mtd2l6EAMyBggAEBYQHjoHCAAQRxCwAzoHCAAQsAMQQ0oECEEYAEoECEYYAFDMAVjMAWCBBWgBcAF4AIABbIgBbJIBAzAuMZgBAKABAqABAcgBCsABAQ&sclient=gws-wiz"><b>reenvío de puertos</b></a>en su enrutador para que pueda acceder a la red WireGuard en cualquier lugar, como un punto de acceso de una cafetería e incluso desde la conexión de datos móviles.
TIPO | VALOR  
------------ \| -------------
Dispositivo | Nombre de host o IP de Raspberry Pi
Protocolo | UDP
Gama de puertos | 51820-51820
Puerto de salida | 51820
Permitir acceso a Internet (si tiene) | sí

Configuración del puerto de mi 👇router👇. El tuyo puede ser diferente, pero lo obtendrás. Recuerda que Google 🔍motor de búsqueda🔎 es tu amigo. Si no puede conectarse desde una red externa, lo que significa que el ISP ha bloqueado las conexiones salientes, puede llamarlos y pedir amablemente que funcione.

<p align="center">
 <img src="https://i.imgur.com/9LBEk1i.jpg">

* * *

👊MUCHAS GRACIAS👊 por este script de instalación de<a href="https://github.com/Nyr/wireguard-install"><b>Nyr</b></a>. Siga para mantenerse actualizado.

Ejecutar en la terminal

    wget https://git.io/wireguard -O wireguard-install.sh && sudo bash wireguard-install.sh

-   El script le pedirá IPv4/nombre de host público para la VPN._Si_tiene una IP estática, luego continúe o escriba el dominio DNS dinámico que creó a partir del<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/wiki/Create-a-Dynamic-DNS-Hostname-Service"><b>instrucciones</b></a>. Por ejemplo: trinibvpn.freeddns.org

-   Para la opción de puerto`press enter`para el valor predeterminado 51820. Para el nombre del cliente, solo ingrese el nombre que desee, y para el uso de DNS, la opción 3 (`1.1.1.1`) por ahora. vas a configurar`AdGuard/Unbound/Cloudflare`con la VPN después de que haya terminado de instalarse.

<p align="center">
 <img src="https://i.imgur.com/WUNZIK4.jpg">

-   Espere hasta que finalice la instalación y se muestre el código QR, no cierre. Pero si lo haces, para`regenerate qrcode`, ingrese en la terminal pero reemplazando solo el nombre`yourclientname.conf`archivo al tuyo:


    sudo cp /root/yourclientname.conf /home/pi && sudo qrencode -t ansiutf8 < yourclientname.conf

`IMPORTANT:`Deberá agregar un nuevo usuario/cliente para cada dispositivo que use con la VPN. Para agregar un nuevo usuario, simplemente vuelva a ejecutar el script y cree un usuario con un nombre de cliente diferente.

<b>Usar_OpenVPN_</b>[<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/wiki/Install-OpenVPN"><b>haga clic aquí</b></a>]

# 

### Conexión de VPN al teléfono Android/IOS

Instale la aplicación WireGuard desde Google Play o App Store:

Wire Guard (Google Play):<https://play.google.com/store/apps/details?id=com.wireguard.android>

WireGuard (tienda de aplicaciones):<https://apps.apple.com/us/app/wireguard/id1441195209>

Debe escanear el código QR que se muestra en el terminal con la aplicación WireGuard, seleccione el`+ button`y usa la opcion`Scan from QR code`para instalar la configuración.

`IMPORTANT`: Permitir**back-end del módulo del kernel**en la configuración de

<p align="left">
 <img src="https://i.imgur.com/R4qbiOQ.jpg" width=250px height=350px>

### Conexión de VPN a Windows

WireGuard para ventanas:<https://download.wireguard.com/windows-client/wireguard-installer.exe>

-   Crear un`new text document`con cualquier nombre en PV para copiar y pegar el texto del archivo de configuración del cliente de WireGuard.

-   Para ver el texto en el archivo de configuración del cliente, escriba en la terminal:


    sudo cat /root/yourclientname.conf

-   Resalte todo el texto, cópielo y péguelo en el archivo txt en la PC y guárdelo. Luego cambie el nombre de la extensión de`txt`para`conf`. Ahora tiene un archivo de configuración para ese cliente de WireGuard.

-   Ahora puede importar el archivo de configuración a WireGuard (opción importar desde archivo).

## Configurar WireGuard con`Adguard/Unbound/Cloudflare`

_Recuerde que esto es para cuando esté conectado a WireGuard VPN en una red externa o en casa las 24 horas del día, los 7 días de la semana porque ya tiene AdGuard/Unbound/Cloudflare configurado y ejecutándose en sus dispositivos manualmente._(no hay problema en tener ambos configurados para mi experiencia)

-   En la aplicación WireGuard, seleccione su túnel y seleccione editar (lápiz en la parte superior derecha)

-   En servidores DNS ingrese`Pi's IP`y guardar (IPv4 e IPv6)

<p align="center">
 <img src="https://i.imgur.com/UC0vWfE.jpg" width=450px height=500px>  

### Limitar el tráfico

Con WireGuard, perderá aproximadamente el 50 % de la velocidad de Internet debido al proceso de tunelización a través de Pi al enrutador y a los dispositivos\*\*

Elimine en las IP permitidas la opción "0.0.0.0/0, ::/0" porque enruta todo el tráfico a su red doméstica, que será lenta. Solo necesita enviar tráfico a través de sus direcciones.

-   Primero debe reemplazarlo con su puerta de enlace de red, pero configurando el último número en cero y<a href="https://www.google.com/search?q=prefix+length+explained&client=firefox-b-d&sxsrf=ALeKk036Jc9vJl73zVXf0yyZs5UlKRlNRQ%3A1621083125589&ei=9cOfYI66I5-qwbkPkdWxkAk&oq=prefix+length+explained&gs_lcp=Cgdnd3Mtd2l6EAMyBggAEAcQHjoHCCMQsAMQJzoHCAAQRxCwA1CUJ1iUJ2CiKmgBcAJ4AIABsAGIAdQCkgEDMC4ymAEAoAEBqgEHZ3dzLXdpesgBCcABAQ&sclient=gws-wiz&ved=0ahUKEwjOiOie3cvwAhUfVTABHZFqDJIQ4dUDCA0&uact=5"><b>longitud del prefijo</b></a>a 24. Por ejemplo:`192.168.1.1/24`para`192.168.1.0/24`o como mi enrutador ISP`192.168.100.1/24`para`192.168.100.0/24`.~~**Ahora solo pierdo un 25% de velocidad**😁 (PD. usando la red 5g)~~

`UPDATE:`Después de una actualización de WireGuard, no obtengo una velocidad más rápida al hacer esto😞... pero aún tiene sentido_no_usar`"0.0.0.0/0, ::/0`con wifi Si alguien sabe algún ajuste para obtener un impulso, hágamelo saber.

<p align="center">
 <img src="https://i.imgur.com/x4m6Pbl.jpg" width=450px height=500px>

### POR FAVOR LEE !! , TENGA EN CUENTA !!

`IMPORTANT`:_Si su red tiene direcciones IP para dispositivos que terminan con un número de 3 dígitos (más de 24), por ejemplo: 192.168.100.`254`, no podrá enrutar correctamente desde una red externa porque aplicar 24 solo permite los números del 1 al 24. En su lugar, debe poner`0`para enrutar fuera del rango de 24, por ejemplo:`192.168.100.0/0`_.

O puede cambiar el rango de IP en su enrutador (en mi experiencia, puede obtener velocidades un poco mejores porque no enrutará direcciones IP permitidas innecesarias en el rango de 24).

<p align="center">
 <img src="https://i.imgur.com/ZZ4aMUI.jpg" width=750px height=550px>

## Ипвш

Si está utilizando IPv6, cuando esté conectado a WiFi, debe ingresar las IP permitidas de WireGuard`fe80::1/0`así como. Por ejemplo`192.168.100.0/0, fe80::1/0`

Cuando se conecta al cable Ethernet en una PC con Windows, debe ingresar`::1`en la dirección IPv6 en el servidor DNS preferido de "Protocolo de Internet versión 6 (TCP/IPv6)".

Luego ve a<https://ipv6leak.com/>y deberías ver"_Su IPv6 no tiene fugas_".

# 

## Deshabilitar todo IPv6

#### Deshabilite IPv6 si no lo tiene o no lo quiere[<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/wiki/Disable-all-IPv6"><b>haga clic aquí</b></a>]. Como resultado, si tiene un Internet débil, deshabilitar IPv6 puede acelerar la solicitud de dns pero tiene menos seguridad.

# 

## Probar VPN

¿Cómo saber si WireGuard VPN realmente funciona?

Para**ventanas**descargar Wireshark:<https://www.wireshark.org/#download>

Una vez descargada, puede usar la aplicación para inspeccionar sus paquetes de datos donde el protocolo está configurado como el que usa WireGuard VPN. Cuando un tráfico de paquetes es`encrypted`, se puede leer así por ejemplo:

<p align="center">
 <img src="https://i.imgur.com/Tn4M47R.jpg">

Para**androide**puedes usar PCAPdroid:<https://play.google.com/store/apps/details?id=com.emanuelef.remote_capture&hl=en&gl=US>

Deberías ver todas las conexiones.`closed`y el estado que muestra todas las conexiones DNS y no TLS en todas las aplicaciones. (abrir y usar aplicaciones para PCAPdroid para escanear)

**[⬆ Volver a contenidos ⬆](#table-of-contents)**

* * *

<b>CUALQUIER PROBLEMA, ARREGLO O SUGERENCIA PARA MEJORAR ESTOS PROYECTOS POR FAVOR CONTRIBUYA 🤖</b>

<p align="center">
<img src="https://user-images.githubusercontent.com/73097560/115834477-dbab4500-a447-11eb-908a-139a6edaec5c.gif"
<br> 
<br> 
<br> 

<p align="center">
 <img src="https://i.imgur.com/Q07E7SW.gif" width=500px height=30px>

<p align="center">
<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/stargazers"><img src="https://reporoster.com/stars/dark/trinib/AdGuard-WireGuard-Unbound-Cloudflare"></a>

<p align="center">
<img src="https://user-images.githubusercontent.com/73097560/115834477-dbab4500-a447-11eb-908a-139a6edaec5c.gif"</p>

# 

## _Recursos del repositorio_

<h5 https://www.raspberrypi.com/documentation/

<https://github.com/AdguardTeam/AdGuardHome/wiki/Getting-Started>

<https://developers.cloudflare.com/>

<https://docs.pi-hole.net/guides/dns/cloudflared/>

<https://docs.pi-hole.net/guides/dns/unbound/>

<https://nlnetlabs.nl/documentation/unbound/unbound.conf/>

<https://dnsprivacy.org/dns_privacy_clients/>

<https://github.com/anudeepND/pihole-unbound>

<https://github.com/stong/unbound.conf.d>

<https://github.com/Nyr/wireguard-install>

<https://github.com/T145/black-mirror>
